## K 线数据引用

### AVPRICE

取得 K 线图的均价

```pascal
AVPRICE 取得K线图的均价。

注：
1、表示单根K线内的均价；
2、日线周期上收盘后与SETTLE函数一样取得当日的结算价。

例1：
A:AVPRICE;//定义变量A为均价线；

例2：
MA5:MA(AVPRICE,5);//定义五个周期均价的平均值;

例3：
C>MA(AVPRICE,5);//价格大于五个周期均价的平均值则返回1，否则返回0。
```

### CLOSE

取得 K 线图的收盘价

```pascal
CLOSE 取得K线图的收盘价。

注：
1、当盘中k线没有走完的时候，取得最新价。
2、可简写为C。

例1：
A:CLOSE;//定义变量A为收盘价（盘中k线没有走完的时候A为最新价）。
例2：
MA5:=MA(C,5);//定义收盘价的5周期均线（C为CLOSE简写）。
例3：
A:=REF(C,1);//取得前一根k线的收盘价。
```

### DUALVOLUME

多空量函数

```pascal
DUALVOLUME 多空量函数

该函数有两种用法：
1、DUALVOLUME('M')：括号中填写M，则函数返回一定周期内的（主动买量-主动卖量）的平均数值。
2、DUALVOLUME('N')：括号中填写N，则函数返回K线图上主动买量-主动卖量的差。

注：
1、用法1：“一定周期”由参数P的数值决定，如果不定义P，默认为5周期。P不能直接定义，需要在参数列表中定义。
2、主动买量比例和主动卖量比例相等或者一边是100%，不画柱。
3、在日、周、月周期上考虑交割信息（即交割后，重新挂牌，要重新计算）。
4、在日线下以周期例如1分钟、3分钟不跨日计算（即新的交易日的第一根开始重新计算）。
5、指数没有主动买和主动卖的概念，所以该函数在指数合约日线周期的比例是根据该指数的所有合约计算的；并且指数合约日线以下周期不支持该函数。

例1：
M:=DUALVOLUME('M');//5周期（主动买量-主动卖量）的平均数值。
N:=DUALVOLUME('N');//主动买量-主动卖量的差
DRAWCOLUMNCHART(N,SCALE>=0.5,M>=0);
//当主动买大于主动卖的时候，向上画柱高为N的红柱。反之向下画柱高为N的绿柱

例2：
//在参数列表中定义P的缺省值为10。
M:=DUALVOLUME('M');//10周期（主动买量-主动卖量）的平均数值。
N:=DUALVOLUME('N');//主动买量-主动卖量的差
DRAWCOLUMNCHART(N,SCALE>=0.5,M>=0);
//当主动买大于主动卖的时候，向上画柱高为N的红柱。反之向下画柱高为N的绿柱
```

### HIGH

取得 K 线图的最高价

```pascal
HIGH 取得K线图的最高价。

注：
1、可简写为H。

例1：
HH:H;//定义HH为最高价。
例2：
HH:HHV(H,5);//取的5个周期内最高价的最大值。
例3：
REF(H,1);//取的前一根K线的最高价
```

### LOW

取得 K 线图的最低价

```pascal
LOW 取得K线图的最低价。

注：
1、可简写为L。

例1：
LL:L;//定义LL为最低价。
例2：
LL:LLV(L,5);//取得5个周期内最低价的最小值。
例3：
REF(L,1);//取得前一根K线的最低价
```

### MINPRICE

数据合约的最小变动价位

```pascal
取数据合约的最小变动价位。
用法：
MINPRICE; 取加载数据合约的最小变动价位。
```

### MINPRICE1

交易合约的最小变动价位

```pascal
取交易合约的最小变动价位。
用法：
MINPRICE1; 取交易合约的最小变动价位。
```

### MINPRICED

最小变动价位

```pascal
返回某品种的最小变动价位。
用法：
MINPRICED(N); 返回N所对应合约的最小变动价位。
N可以为参数，但不可以为变量。
例1：
MINPRICED(8603); 返回参数是文华码8603所对应IF1203合约的最小变动价位。
例2：
N:=8603;
MINPRICED(N);返回8603所对应IF1203合约的最小变动价位。
```

### OPEN

取得 K 线图的开盘价

```pascal
OPEN 取得K线图的开盘价。

注：
1、可简写为O。

例1：
OO:O;//定义OO为开盘价；
例2：
NN:=BARSLAST(DATE<>REF(DATE,1));
OO:REF(O,NN);//取的当日的开盘价
例3：
MA5:MA(O,5);//定义开盘价的5周期均线（O为OPEN简写）。
```

### OPI

取得 K 线图的持仓量

```pascal
OPI 取得K线图的持仓量。

例1：
OPID:OPI;//定义OPID为持仓量。
例2：
OPI>=REF(OPI,1);//持仓量大于前一个周期的持仓量，表示持仓量增加。
例3：
NN:=BARSLAST(DATE<>REF(DATE,1))+1;
OPID:REF(OPI,NN);//取的昨天收盘时的持仓量
```

### RAWDATA

取原始数据的值

```pascal
RAWDATA 取原始数据的高开低收
注：
1、该函数与STOCKDIVD或TRADE_SMOOTHING连用
2、如未使用STOCKDIVD或TRADE_SMOOTHING，该函数返回无效值

用法：
RAWDATA('O');//取原始数据的开盘价
STOCKDIVD(1);//设置股票向后复权

//其中'OPEN'可以替换为以下
'HIGH':最高
'LOW':最低
'CLOSE'收盘价
均可为简写
```

### REF

向前引用

```pascal
引用X在N个周期前的值。

注：
1、当N为有效值，但当前的k线数不足N根，返回空值；
2、N为0时返回当前X值；
3、N为空值时返回空值。
4、N可以为变量

例1:
 REF(CLOSE,5);表示引用当前周期前第5个周期的收盘价
例2：
AA:IFELSE(BARSBK>=1,REF(C,BARSBK),C);//取最近一次买开仓信号K线的收盘价
//1）发出BK信号的当根k线BARSBK返回空值,则发出BK信号的当根k线REF(C,BARSBK)返回
空值；
//2）发出BK信号的当根k线BARSBK返回空值,不满足BARSBK>=1,则当根k线的收盘价。
//3）发出BK信号之后的k线BARSBK返回买开仓的K线距离当前K线的周期数，REF(C,BARSBK)
返回开仓k线的收盘价。
//4）例：1、2、3 三根k线，1 K线为开仓信号的当根k线，则返回当根k线的收盘价，2、3
K线返回 1 K线的收盘价。
```

### REFWH

向前引用

```pascal
引用N周期前的数据。

用法：
REFWH(X,N)引用X在N个周期前的值。
1、当N为有效值，但当前的k线数不足N根，按照实际的根数计算；
2、N为0时返回当前X值；
3、N为空值时返回空值。
4、N可以为变量
注：
算法跟REF一样，区别在于：在不足N根的时候，按照实际的根数计算；
```

### SCALE

取得 K 线图主动买占总成交量的比例

```pascal
SCALE 取得K线图主动买占总成交量的比例。

注：
指数没有主动买和主动卖的概念，所以该函数在指数合约日线周期的比例是根据该指数的所有合约计算的；并且指数合约日线以下周期不支持该函数。
例1：
AA:=SCALE*VOL;//主动买
BB:=(1-SCALE)*VOL;//主动卖
```

### SETTLE

取得 K 线图的结算价或者取得当日成交均价

```pascal
SETTLE 取得K线图的结算价或者取得当日成交均价

注：
1、日线周期，盘中返回的是全天成交均价；收盘后返回交易所公布的结算价。
2、分钟周期，返回的是截止到当前k线的全天成交均价。

例1：
SS:SETTLE;//定义SS为结算价
例2：
CROSS(C,SETTLE);//收盘价上穿结算价
```

### UNIT

取数据合约的交易单位

```pascal
取数据合约的交易单位。
用法：
UNIT 取加载数据合约的交易单位。
```

### UNIT1

取交易合约的交易单位

```pascal
取模组交易合约的交易单位。
用法：
UNIT1 取模组交易合约的交易单位。
```

### VOL

取得 K 线图的成交量

```pascal
VOL 取得K线图的成交量。

注：
可简写为V。
该函数在当根TICK上的返回值为当天所有TICK成交量的累计值。

例1：
VV:V;//定义VV为成交量
例2：
REF(V,1);//表示前一个周期的成交量
例3：
V>=REF(V,1);//成交量大于前一个周期的成交量，表示成交量增加(V为VOL的简写)。
```

### YCLOSE

取得 K 线图的昨收盘价

```pascal
取得K线图的昨收盘价。
用法：
YCLOSE求某根K线的昨收盘价。
注：
1、用在周期小于'日'的K线上如5分钟K线，一小时k线，每根K线返回的值为前一天的收盘价
2、该函数不支持跨周期或跨合约引用。
3、主要用于股票合约取昨收盘价。
4、该函数不支持公式选股。
```

### YSETTLE

取得 K 线图的昨结算价

```pascal
取得K线图的昨结算价。
用法：
YSETTLE求某根k线的昨结算价
说明：
1、用在周期小于'日'的K线上如5分钟K线，一小时k线，每根k线返回的值为前一天的结算价
2、在周期小于'日'的K线上，用跨周期或跨合约引用昨结算价无效
3、该函数不支持公式选股。
```

### #CALL

跨合约引用指标

```pascal
#CALL [CODE, FORMULA] AS VAR 引用CODE合约的指标FORMULA的数据。

注：
1、CODE为文华码，FORMULA为引用指标名，VAR为定义变量名（此变量名不能以数字开头）。
2、默认只能引用同一周期的数据。
3、支持加载到自定义周期中使用。
4、CODE的位置不可以为空。
5、
该函数支持1分钟数据逐笔回测，即该函数可以和MULTSIG_MIN、CHECKSIG_MIN函数连用；
该函数不支持TICK数据逐笔回测，即该函数不可以和MULTSIG、CHECKSIG函数连用。
6、一个模型中#IMPORT、#CALL、#CALL_PLUS、#CALL_OTHER总的语句个数不能超过6个；
7、跨合约#CALL支持如下写法#CALL[,指标名]AS VAR 表示自动获取加载合约对应的指数合约

例1：
CC:REF(C,1);//定义一个周期前的收盘价
保存指标，命名为AA
#CALL[1201,AA] AS VAR
CC:VAR.CC;//跨合约引用豆粕1501昨天的收盘价
```

### #IMPORT

跨周期引用指标

```pascal
#IMPORT [PERIOD,N,FORMULA] AS VAR 引用当前合约，PERIOD参数为N的周期，指标FORMULA的数据。

注：
1、PERIOD为周期，N为具体的参数，FORMULA为引用指标名，VAR为定义变量名（此变量名不能已数字开头）；
2、PERIOD支持如下周期：SEC（秒周期），MIN（分钟周期），HOUR（小时周期），CUSHOUR（自定义小时周期），DAY（日周期），WEEK（一周），MONTH（一月），QUARTER（一季度），YEAR（一年）；
3、支持引用自定义周期；
如#IMPORT [MIN,2,MACD] AS VAR//引用两分钟周期MACD指标数值
4、N必须为大于等于1的整数，周及以上周期，N写入大于1的数，按照1计算；
例如：#IMPORT [WEEK,2,FORMULA] AS VAR//默认引用的是一周的指标；
5、引用常规小时周期使用HOUR，引用自定义小时周期需要使用CUSHOUR。
6、主合约周期除了量能周期，TICK周期外的都支持；
7、该函数可以小周期引用大周期，也可以大周期引用小周期；
8、被引用的指标中不能存在引用；
9、FORMULA引用指标名可以为字母、汉字或数字命名的指标；
10、定义变量名不能与函数名重复；
11、一个模型中#IMPORT、#CALL、#CALL_PLUS、#CALL_OTHER总的语句个数不能超过6个；
12、使用该函数编写末尾不能编写分号。
13、跨周期被引用指标中不能含有未来函数。

例1：
CC:REF(C,1);//定义一个周期前的收盘价
保存指标，命名为AA
#IMPORT[DAY,1,AA] AS VAR
CC:VAR.CC;//跨周期引用昨天的收盘价

例2：
CC:C;//定义收盘价
保存指标，命名为CC
#IMPORT[DAY,1,CC] AS VAR
CC:=VAR.CC;//跨周期引用日周期上的收盘价
CC1:REF(CC,1);
//要引用的数据需要写在被引用的指标里，不能写在IMPORT模型中。
//例1中的CC指标引用日周期上前一个周期的收盘价，需要在被引用的指标中取一个周期前的收盘价，
例2中写在IMPORT模型中则表示取小周期上一个周期前的值

例3：
CC:=REF(C,1);//定义一个周期前的收盘价
保存指标，命名为AA
#IMPORT[CUSHOUR,6,AA]AS S
CC1:=S.CC;//跨周期引用自定义6小时周期的一个周期前的收盘价
#IMPORT[SEC,1,AA]AS R
CC2:=R.CC;//跨周期引用自定义1秒周期的一个周期前的收盘价
```

### #CALL_PLUS

跨合约跨周期引用指标

```pascal
#CALL_PLUS[CODE,PERIOD,N,FORMULA] AS VAR 引用CODE合约，PERIOD参数为N的周期，指标FORMULA的数据。

注：
1、CODE为文华码，PERIOD为周期，N为具体的参数，FORMULA为引用指标名，VAR为定义变量名（此变量名不能以数字开头）；
2、PERIOD支持如下周期：MIN（分钟周期），HOUR（小时周期），CUSHOUR（自定义小时周期），DAY（日周期），WEEK（一周），MONTH（一月），QUARTER（一季度），YEAR（一年）；
3、该函数支持与1分钟数据为基础数据的信号控制函数连用；不支持TICK数据逐笔回测。
4、支持引用自定义周期；
如#CALL_PLUS[8600,MIN,2,MACD] AS VAR//引用文华码8600的合约两分钟周期MACD指标数值
5、引用常规小时周期使用HOUR，引用自定义小时周期需要使用CUSHOUR。
6、N必须为大于等于1的整数，周及以上周期，N写入大于1的数，按照1计算；
例如：#CALL_PLUS[8600,WEEK,2,FORMULA] AS VAR//默认引用的是一周的指标；
7、不支持加载到TICK周期、秒周期、量能周期；
8、该函数可以小周期引用大周期，也可以大周期引用小周期；
9、被引用的指标中不能存在引用；
10、FORMULA引用指标名可以为字母、汉字或数字命名的指标；
11、定义变量名不能与函数名重复；
12、一个模型中#IMPORT、#CALL、#CALL_PLUS、#CALL_OTHER总的语句个数不能超过6个；
13、使用该函数编写末尾不能编写分号。
14、跨周期跨合约被引用指标中不能含有未来函数。

例：
CC:REF(C,1);//定义一个周期前的收盘价
保存指标，命名为AA
#CALL_PLUS[8600,DAY,1,AA] AS VAR
CC:VAR.CC;//跨周期引用IF加权昨天的收盘价
```

### #CALL_OTHER

跨指标引用

```pascal
#CALL_OTHER [FORMULA] AS VAR 引用当前合约，当前周期的，指标FORMULA的数据

注：
1、FORMULA为引用指标名，VAR为定义变量名（变量名不能以数字开头）。
2、默认只能引用同一周期的数据。
3、支持加载到自定义周期中使用。
4、默认引用当前合约
5、
该函数支持1分钟数据逐笔回测，即该函数可以和MULTSIG_MIN、CHECKSIG_MIN函数连用；
该函数不支持TICK数据逐笔回测，即该函数不可以和MULTSIG、CHECKSIG函数连用。
6、一个模型中#IMPORT、#CALL、#CALL_PLUS、#CALL_OTHER总的语句个数不能超过6个；

例1：
CC:REF(C,1);//定义一个周期前的收盘价
保存指标，命名为AA
#CALL_OTHER[AA] AS VAR
CC:VAR.CC;//跨指标引用当前合约的一个周期前的收盘价
```

## 行情报价引用

### GETDEALSSUM

取得某一合约的盘口分笔数据

```pascal
GETDEALSSUM 根据文华码（字符类型）取某一个合约的盘口分笔数据。

用法：
1、GETDEALSSUM('CODE','多方大单');//CODE为文华码，加载后返回指定的此合约盘口分笔窗口的多方大单百分比数值。
2、GETDEALSSUM('多方大单');//加载后返回当前主图上数据合约盘口分笔窗口的多方大单百分比数值。

注：
1、第一个参数CODE为字符类型，需要使用单引号标注。
2、在清盘时间该函数收不到数据，返回值为0。
3、该函数不支持回测。使用该函数时，加载之前的历史数据返回加载时刻该函数取到的数据。

例1：
GETDEALSSUM('1209', '多方大单');//返回文华码为1209合约的多方大单百分比数值。
例2：
GETDEALSSUM('8606', '多方均价');//返回文华码为8606合约的多方均价。

//其中'多方大单'可以替换为以下
'空方大单':空方大单
'多方散单':多方散单
'空方散单'：空方散单
'多方合计'：多方合计
'空方合计'：空方合计
'多方均价'：多方均价
'空方均价':空方均价
'多换':多换
'空换':空换
'大单多换':大单多换
'大单空换':大单空换
'双开':双开
'双平':双平
'大单双开':大单双开
'大单双平':大单双平
'多开':多开
'空开':空开
'大单多开':大单多开
'大单空开':大单空开
'空平':空平
'多平':多平
'大单空平':大单空平
'大单多平':大单多平
```

### GETPRICE

取得某一合约的行情报价数据

```pascal
GETPRICE 根据文华码取报价列表窗口某一个合约的行情报价数据。

注：
1、在清盘时间该函数收不到数据，返回值为0。
2、该函数不支持回测。使用该函数时，加载之前的历史数据返回加载时刻该函数取到的行情报价。

用法：
1、GETPRICE(CODE,'OPEN');//CODE为文华码，加载后返回指定的此文华码的合约的开盘价
2、GETPRICE('OPEN');//加载后返回当前主图上数据合约的开盘价

例1：
GETPRICE(1209, 'OPEN');//返回文华码为1209合约的开盘价。
例2：
GETPRICE(8606, 'AVPRICE');//返回文华码为8606合约的均价。

//其中'OPEN'可以替换为以下
'HIGH':最高
'LOW':最低
'NEW':最新
'AVPRICE':均价
'YCLOSE':昨收盘
'YSETTLE':昨结算
'BID1':买1价
'BID2':买2价
'BID3':买3价
'BID4':买4价
'BID5':买5价
'BIDVOL1':买1量
'BIDVOL2':买2量
'BIDVOL3':买3量
'BIDVOL4':买4量
'BIDVOL5':买5量
'ASK1':卖1价
'ASK2':卖2价
'ASK3':卖3价
'ASK4':卖4价
'ASK5':卖5价
'ASKVOL1':卖1量
'ASKVOL2':卖2量
'ASKVOL3':卖3量
'ASKVOL4':卖4量
'ASKVOL5':卖5量
'VOLUME':成交量
'OPI':持仓量
'DELTAVOL':现手
'DELTAOPI':增仓
'RISELIMIT':涨停价
'FALLLIMIT':跌停价
'TOTALBIDVOL':总买量
'TOTALASKVOL':总卖量
'TOTALBIDPRICE':总买价
'TOTALASKPRICE':总卖价
'沉淀资金':沉淀资金【持仓量*最新价*报价单位*保证金比例】注：中金所持仓量需要*2
'资金流向':资金流向【[(持仓量*收盘价)-(持仓量-日增仓*昨收)]*单位手数*保证金比例】
```

### GETPRICE1

取某一股票合约的抬头数据

```pascal
GETPRICE1 取某一股票合约的抬头数据。

用法：
GETPRICE1('震幅%');//加载后返回当前股票合约报价列表抬头中震幅的数据值

注：
1、该函数只支持加载在股票合约上，在期货合约上返回空值
2、如果用于公式选股，需要提前在报价窗口浏览股票行情

例：
GETPRICE1('量比');//返回当前股票合约上报价列表抬头中量比的数据值

//其中'量比'可以替换为以下
'震幅%'【(最高价-最低价)/昨收*100%】
'量比'【即时成交量/已开市时间(分钟)/(前5日成交均量/开市时间（分钟）)】
'委比%'【(委买数量-委卖数量)/(委买数量+委卖数量)*100%】
'换手%'【成交量/（总股本*流通比例）*100%】
'季市盈率'【最新价/季每股收益】
'年市盈率'【最新价/年每股收益】
'市净率'【最新价/每股净资产】
'总市值'【最新价*总股本】
'日强弱度'【合约收益率-指数收益率 】
'月强弱度'【计算期内日强弱度的总和(从股票上市算到当天)】
'指数贡献'【((最新价-昨收）*个股总股本/指数总市值)*指数最新价】
'季每股收益'【交易所公布】
'每股资产'【交易所公布】
'营业收入'【交易所公布】
'投资收益'【交易所公布】
'主营利润'【交易所公布】
'净利润'【每股收益*总股本】
'总股本'【交易所公布】
'流通股本'【总股本*流通比例】
'流通%'【交易所公布】
'利润%'【主营利润/主营收入】
'年收益%'【年每股收益/每股净资产*100%】
'季收益%'【交易所公布】
'负债%'【交易所公布】
'主收%'【交易所公布】
```

### GETPRICE2

取某一股票合约的财务数据

```pascal
GETPRICE2('') 取某一股票合约的财务数据。

用法：
GETPRICE2('每股收益');//加载后返回当前股票合约财务数据中每股收益的数据值。

注：
1、该函数只支持加载在股票合约上，在期货合约上返回空值
2、如果用于公式选股，需要提前在报价窗口浏览股票行情

例：
GETPRICE2('每股收益');//返回当前股票合约财务数据中每股收益的数据值。

//其中'每股收益'可以替换为以下
'每股净资产'
'净资产收益率'
'每股经营现金'
'每股公积金'
'每股未分配'
'股东权益比'
'净利润同比'
'主营收入同比'
'销售毛利率'
'调整每股净资产'
'总资产'
'流动资产'
'固定资产'
'无形资产'
'流动负债
''长期负债'
'总负债'
'股东权益'
'资本公积金'
'经营现金流量'
'投资现金流量'
'筹资现金流量'
'现金增加额'
'主营收入'
'主营利润'
'营业利润'
'投资收益'
'营业外收支'
'利润总额'
'净利润'
'未分配利润'
'总股本'
'无限售股合计'
'A股'
'B股'
'境外上市股'
'其他流通股'
'限售股合计'
'国家持股'
'国有法人股'
'境内法人股'
'境内自然人股'
'其他发起人股'
'募集法人股'
'境外法人股'
'境外自然人股'
'优先股或其他'
```

### GETSTOCKPRICE

取得某一股票合约的行情报价数据

```pascal
GETSTOCKPRICE 根据股票代码（字符类型）取报价列表窗口某一个股票合约的行情报价数据。

用法：
1、GETSTOCKPRICE('CODE','OPEN');//CODE为股票代码（字符类型），加载后返回指定的股票合约的开盘价
2、GETSTOCKPRICE('OPEN');//加载后返回当前股票合约的开盘价

注：
1、第一个参数CODE为字符类型，需要使用单引号标注。
2、在清盘时间该函数收不到数据，返回值为0。
3、该函数不支持回测。使用该函数时，加载之前的历史数据返回加载时刻该函数取到的行情报价。

例1：
GETSTOCKPRICE('600000', 'OPEN');//返回股票代码为600000合约的开盘价。
例2：
GETSTOCKPRICE('600000', 'AVPRICE');//返回股票代码为600000合约的均价。

//其中'OPEN'可以替换为以下
'HIGH':最高
'LOW':最低
'NEW':最新
'AVPRICE':均价
'YCLOSE':昨收盘
'YSETTLE':昨结算
'BID1':买1价
'BID2':买2价
'BID3':买3价
'BID4':买4价
'BID5':买5价
'BIDVOL1':买1量
'BIDVOL2':买2量
'BIDVOL3':买3量
'BIDVOL4':买4量
'BIDVOL5':买5量
'ASK1':卖1价
'ASK2':卖2价
'ASK3':卖3价
'ASK4':卖4价
'ASK5':卖5价
'ASKVOL1':卖1量
'ASKVOL2':卖2量
'ASKVOL3':卖3量
'ASKVOL4':卖4量
'ASKVOL5':卖5量
'VOLUME':成交量
'OPI':持仓量
'DELTAVOL':现手
'DELTAOPI':增仓
'RISELIMIT':涨停价
'FALLLIMIT':跌停价
'TOTALBIDVOL':总买量
'TOTALASKVOL':总卖量
'TOTALBIDPRICE':总买价
'TOTALASKPRICE':总卖价
'沉淀资金':沉淀资金
'资金流向':资金流向
```

## TICK 数据函数

### ASK1

取得 TICK 图该笔 TICK 的卖一价

```pascal
ASK1 取得TICK图该笔TICK的卖一价。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、如果没有五档行情授权，该函数返回盘口卖出价。

例：
AA:ASK1;//加载到TICK图中，定义AA为该笔TICK的卖一价；
```

### ASK2

取得 TICK 图该笔 TICK 的卖二价

```pascal
ASK2 取得TICK图该笔TICK的卖二价。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
AA:ASK2;//加载到有五档授权的TICK图中，定义AA为该笔TICK的卖二价；
```

### ASK3

取得 TICK 图该笔 TICK 的卖三价

```pascal
ASK3 取得TICK图该笔TICK的卖三价。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
AA:ASK3;//加载到有五档授权的TICK图中，定义AA为该笔TICK的卖三价；
```

### ASK4

取得 TICK 图该笔 TICK 的卖四价

```pascal
ASK4 取得TICK图该笔TICK的卖四价。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
AA:ASK4;//加载到有五档授权的TICK图中，定义AA为该笔TICK的卖四价；
```

### ASK5

取得 TICK 图该笔 TICK 的卖五价

```pascal
ASK5 取得TICK图该笔TICK的卖五价。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
AA:ASK5;//加载到有五档授权的TICK图中，定义AA为该笔TICK的卖五价；
```

### ASK1VOL

取得 TICK 图该笔 TICK 的卖一量

```pascal
ASK1VOL 取得TICK图该笔TICK的卖一量。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、如果没有五档行情授权，该函数返回盘口卖出挂单量。

例：
VV:ASK1VOL;//加载到TICK图中，定义VV为该笔TICK的卖一量；
```

### ASK2VOL

取得 TICK 图该笔 TICK 的卖二量

```pascal
ASK2VOL 取得TICK图该笔TICK的卖二量。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
VV:ASK2VOL;//加载到有五档授权的TICK图中，定义VV为该笔TICK的卖二量；
```

### ASK3VOL

取得 TICK 图该笔 TICK 的卖三量

```pascal
ASK3VOL 取得TICK图该笔TICK的卖三量。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
VV:ASK3VOL;//加载到有五档授权的TICK图中，定义VV为该笔TICK的卖三量；
```

### ASK4VOL

取得 TICK 图该笔 TICK 的卖四量

```pascal
ASK4VOL 取得TICK图该笔TICK的卖四量。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
VV:ASK4VOL;//加载到有五档授权的TICK图中，定义VV为该笔TICK的卖四量；
```

### ASK5VOL

取得 TICK 图该笔 TICK 的卖五量

```pascal
ASK5VOL 取得TICK图该笔TICK的卖五量。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
VV:ASK5VOL;//加载到有五档授权的TICK图中，定义VV为该笔TICK的卖五量；
```

### ASKBIGCOUNT

取得 TICK 图所定义数据区主动卖大单次数的和

```pascal
ASKBIGCOUNT 取得TICK图所定义数据区主动卖大单次数的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、使用该函数前，必须使用SETBIGVOL函数定义大单阈值，否则该函数返回0。
3、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
SETBIGVOL(10);//设置大单阈值为10手
VV:ASKBIGCOUNT;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的主动卖的大单次数的和
```

### ASKBIGTOTVOL

取得 TICK 图所定义数据区主动卖大单成交量的和

```pascal
ASKBIGTOTVOL 取得TICK图所定义数据区主动卖大单成交量的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、使用该函数前，必须使用SETBIGVOL函数定义大单阈值，否则该函数返回0。
3、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
SETBIGVOL(10);//设置大单阈值为10手
VV:ASKBIGTOTVOL;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的主动卖大单成交量的和
```

### ASKVOL

取得 TICK 图所定义数据区主动卖成交量的和

```pascal
ASKVOL 取得TICK图所定义数据区主动卖成交量的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
VV:ASKVOL;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的主动卖成交量的和
```

### BID1

取得 TICK 图该笔 TICK 的买一价

```pascal
BID1 取得TICK图该笔TICK的买一价。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、如果没有五档行情授权，该函数返回盘口买入价。

例：
AA:BID1;//加载到TICK图中，定义AA为该笔TICK的买一价；
```

### BID2

取得 TICK 图该笔 TICK 的买二价

```pascal
BID2 取得TICK图该笔TICK的买二价。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
AA:BID2;//加载到有五档授权的TICK图中，定义AA为该笔TICK的买二价；
```

### BID3

取得 TICK 图该笔 TICK 的买三价

```pascal
BID3 取得TICK图该笔TICK的买三价。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
AA:BID3;//加载到有五档授权的TICK图中，定义AA为该笔TICK的买三价；
```

### BID4

取得 TICK 图该笔 TICK 的买四价

```pascal
BID4 取得TICK图该笔TICK的买四价。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
AA:BID4;//加载到有五档授权的TICK图中，定义AA为该笔TICK的买四价；
```

### BID5

取得 TICK 图该笔 TICK 的买五价

```pascal
BID5 取得TICK图该笔TICK的买五价。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
AA:BID5;//加载到有五档授权的TICK图中，定义AA为该笔TICK的买五价；
```

### BID1VOL

取得 TICK 图该笔 TICK 的买一量

```pascal
BID1VOL 取得TICK图该笔TICK的买一量。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、如果没有五档行情授权，该函数返回盘口买入挂单量。

例：
VV:BID1VOL;//加载到TICK图中，定义VV为该笔TICK的买一量；
```

### BID2VOL

取得 TICK 图该笔 TICK 的买二量

```pascal
BID2VOL 取得TICK图该笔TICK的买二量。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
VV:BID2VOL;//加载到有五档授权的TICK图中，定义VV为该笔TICK的买二量；
```

### BID3VOL

取得 TICK 图该笔 TICK 的买三量

```pascal
BID3VOL 取得TICK图该笔TICK的买三量。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
VV:BID3VOL;//加载到有五档授权的TICK图中，定义VV为该笔TICK的买三量；
```

### BID4VOL

取得 TICK 图该笔 TICK 的买四量

```pascal
BID4VOL 取得TICK图该笔TICK的买四量。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
VV:BID4VOL;//加载到有五档授权的TICK图中，定义VV为该笔TICK的买四量；
```

### BID5VOL

取得 TICK 图该笔 TICK 的买五量

```pascal
BID5VOL 取得TICK图该笔TICK的买五量。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
VV:BID5VOL;//加载到有五档授权的TICK图中，定义VV为该笔TICK的买五量；
```

### BIDBIGCOUNT

取得 TICK 图所定义数据区主动买大单次数的和

```pascal
BIDBIGCOUNT 取得TICK图所定义数据区主动买大单次数的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、使用该函数前，必须使用SETBIGVOL函数定义大单阈值，否则该函数返回0。
3、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
SETBIGVOL(10);//设置大单阈值为10手
VV:BIDBIGCOUNT;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的主动买的大单次数的和
```

### BIDBIGTOTVOL

取得 TICK 图所定义数据区主动买大单成交量的和

```pascal
BIDBIGTOTVOL 取得TICK图所定义数据区主动买大单成交量的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、使用该函数前，必须使用SETBIGVOL函数定义大单阈值，否则该函数返回0。
3、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
SETBIGVOL(10);//设置大单阈值为10手
VV:BIDBIGTOTVOL;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的主动买大单成交量的和
```

### BIDVOL

取得 TICK 图所定义数据区主动买成交量的和

```pascal
BIDVOL 取得TICK图所定义数据区主动买成交量的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
VV:BIDVOL;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的主动买成交量的和
```

### BKBIGCOUNT

取得 TICK 图所定义数据区买开大单成交次数的和

```pascal
BKBIGCOUNT 取得TICK图所定义数据区买开大单成交次数的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、使用该函数前，必须使用SETBIGVOL函数定义大单阈值，否则该函数返回0。
3、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
2、
SETBIGVOL(10);//设置大单阈值为10手
VV:BKBIGCOUNT;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的买开大单的成交次数的和
```

### BKBIGTOTVOL

取得 TICK 图所定义数据区买开大单成交量的和

```pascal
BKBIGTOTVOL 取得TICK图所定义数据区买开大单成交量的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、使用该函数前，必须使用SETBIGVOL函数定义大单阈值，否则该函数返回0。
3、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
SETBIGVOL(10);//设置大单阈值为10手
VV:BKBIGTOTVOL;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的买开大单的成交量的和
```

### BKVOLUME

取得 TICK 图所定义数据区多开成交量的和

```pascal
BKVOLUME 取得TICK图所定义数据区多开成交量的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
VV:BKVOLUME;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的多开的成交量的和
```

### BPBIGCOUNT

取得 TICK 图所定义数据区买平大单成交次数的和

```pascal
BPBIGCOUNT 取得TICK图所定义数据区买平大单成交次数的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、使用该函数前，必须使用SETBIGVOL函数定义大单阈值，否则该函数返回0。
3、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
SETBIGVOL(10);//设置大单阈值为10手
VV:BPBIGCOUNT;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的买平大单的成交次数的和
```

### BPBIGTOTVOL

取得 TICK 图所定义数据区买平大单成交量的和

```pascal
BPBIGTOTVOL 取得TICK图所定义数据区买平大单成交量的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、使用该函数前，必须使用SETBIGVOL函数定义大单阈值，否则该函数返回0。
3、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
SETBIGVOL(10);//设置大单阈值为10手
VV:BPBIGTOTVOL;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的买平大单的成交量的和
```

### BPVOLUME

取得 TICK 图所定义数据区买平成交量的和

```pascal
BPVOLUME 取得TICK图所定义数据区买平成交量的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
VV:BPVOLUME;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的买平的成交量的和
```

### DEF_TICKDATA

定义五档 TICK 数据区

```pascal
DEF_TICKDATA(Type,N) 定义五档TICK数据区。
该函数不支持与指令连用。

用法：DEF_TICKDATA(Type,N);定义TICK数据区。
Type为0时，N表示多少秒（最大60秒）
Type为1时，N表示多少笔（最大200笔）

注：
1、使用五档统计函数时，必须先调用该函数定义数据区。
2、一个模型中，只能调用一次DEF_TICKDATA函数。
3、该函数必须在TICK图中使用。

例：
DEF_TICKDATA(1,10);//调用10笔TICK数据
VV:L2_SPBIGTOTVOL;//加载到TICK图中，定义VV为10笔TICK内（包含当笔TICK）所有TICK的卖平大单的成交量的和
```

### DKVOLUME

取得 TICK 图所定义数据区双开成交量的和

```pascal
DKVOLUME 取得TICK图所定义数据区双开成交量的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
VV:DKVOLUME;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的双开的成交量的和
```

### MATCHPERCENT

设置 TICK 周期买卖量按百分比撮合成交

```pascal
MATCHPERCENT(N) 设置TICK周期买卖量按百分比撮合成交
该函数不支持与指令连用。

用法：N是设置的百分比,回测时按盘口买一量、卖一量的百分比撮合成交

注：
1、该函数只能在TICK图中使用。
2、回测时，按盘口买一量、卖一量的百分比撮合成交（如BK成交手数：盘口卖一量*N/100），不足1手为0
3、模组盘中运行时，开仓手数不考虑MATCHPERCENT函数，开仓信号发出后下一笔TICK撤未成交的开仓挂单。

例：
MA1:MA(CLOSE,N1);
MA2:MA(CLOSE,N2);
CROSSUP(MA1,MA2),BPK;//5周期均线上穿10周期均线做多。
CROSSDOWN(MA1,MA2),SPK;//5周期均线下穿10周期均线做空。
MATCHPERCENT(10);//回测按盘口买一量、卖一量的百分比撮合成交
AUTOFILTER;
```

### NEW

取得 TICK 图该笔 TICK 的最新价

```pascal
NEW 取得TICK图的最新价。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数不需要有五档行情授权。

例：
NN:NEW;//加载到TICK图中，定义NN为该笔TICK的最新价；
```

### RISING

判断价格趋势

```pascal
RISING(N) 判断TICK图的价格趋势。
该函数不支持与指令连用。

用法：参数N代表周期，在N个周期内，上涨趋势返回1，下跌趋势返回0，平盘时返回空值。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数需要有五档行情授权才能取到有效值，否则返回空值。

例：
RR:RISING(N);//加载到有五档授权的TICK图中，上涨趋势返回1，反之返回0。
```

### SETBIGVOL

设置 TICK 图所定义数据区大单阈值

```pascal
SETBIGVOL 设置TICK图所定义数据区大单阈值。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、该函数必须在TICK图中使用。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
SETBIGVOL(10);//设置大单阈值为10手
VV:BPBIGTOTVOL;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的买平大单的成交量的和
```

### SKBIGCOUNT

取得 TICK 图所定义数据区卖开大单成交次数的和

```pascal
SKBIGCOUNT 取得TICK图所定义数据区卖开大单成交次数的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、使用该函数前，必须使用SETBIGVOL函数定义大单阈值，否则该函数返回0。
3、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据

SETBIGVOL(10);//设置大单阈值为10手
VV:SKBIGCOUNT;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的卖开大单的成交次数的和
```

### SKBIGTOTVOL

取得 TICK 图所定义数据区卖开大单成交量的和

```pascal
SKBIGTOTVOL 取得TICK图所定义数据区卖开大单成交量的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、使用该函数前，必须使用SETBIGVOL函数定义大单阈值，否则该函数返回0。
3、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
SETBIGVOL(10);//设置大单阈值为10手
VV:SKBIGTOTVOL;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的卖开大单的成交量的和
```

### SKVOLUME

取得 TICK 图所定义数据区卖开成交量的和

```pascal
SKVOLUME 取得TICK图所定义数据区卖开成交量的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
VV:SKVOLUME;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的卖开的成交量的和
```

### SPBIGCOUNT

取得 TICK 图所定义数据区卖平大单成交次数的和

```pascal
SPBIGCOUNT 取得TICK图所定义数据区卖平大单成交次数的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、使用该函数前，必须使用SETBIGVOL函数定义大单阈值，否则该函数返回0。
3、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
SETBIGVOL(10);//设置大单阈值为10手
VV:SPBIGCOUNT;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的卖平大单的成交次数的和
```

### SPBIGTOTVOL

取得 TICK 图所定义数据区卖平大单成交量的和

```pascal
SPBIGTOTVOL 取得TICK图所定义数据区卖平大单成交量的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、使用该函数前，必须使用SETBIGVOL函数定义大单阈值，否则该函数返回0。
3、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
SETBIGVOL(10);//设置大单阈值为10手
VV:SPBIGTOTVOL;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的卖平大单的成交量的和
```

### SPVOLUME

取得 TICK 图所定义数据区卖平成交量的和

```pascal
SPVOLUME 取得TICK图所定义数据区卖平成交量的和。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。
2、该函数必须在TICK图中使用，在K线图上返回空值。

例：
DEF_TICKDATA(0,5);//调用五秒的TICK数据
VV:SPVOLUME;//加载到TICK图中，定义VV为五秒内（包含当笔TICK）所有TICK的卖平的成交量的和
```

### TICKDATANUM

统计定义的数据区内的笔数

```pascal
TICKDATANUM 统计定义的数据区内的笔数。
该函数不支持与指令连用。

注：
1、使用该函数前，必须先调用DEF_TICKDATA函数定义TICK数据区。

例:
DEF_TICKDATA(0,5);//调用五秒的TICK数据
NUM:TICKDATANUM;//定义NUM为五秒内（包含当笔TICK）所有TICK的笔数
```

### TICK_OPI

取得 TICK 图该笔 TICK 的持仓量

```pascal
TICK_OPI 取得TICK图的持仓量。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数不需要有五档行情授权。

例：
OO:TICK_OPI;//加载到TICK图中，定义OO为该笔TICK的持仓量；
```

### TICK_SCALE

取得 TICK 图该笔 TICK 是否为主动买

```pascal
TICK_SCALE 取得TICK图该笔TICK是否为主动买。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数不需要有五档行情授权
3、该函数返回1当笔TICK为主动买，返回0当笔TICK为主动卖

例：
SS:TICK_SCALE;//加载到TICK图中，SS返回1，代表当笔TICK为主动买；SS返回0，代表当笔TICK为主动卖。
```

### TICK_VOL

取得 TICK 图该笔 TICK 的成交量

```pascal
TICK_VOL 取得TICK图的成交量。
该函数不支持与指令连用。

注：
1、该函数必须在TICK图中使用，在K线图上返回空值。
2、该函数不需要有五档行情授权。
3、该函数在当根TICK上的返回值为当天所有TICK成交量的累计值。
如果要取当根TICK的成交量，可以写为：TICK_VOL-REF(TICK_VOL,1);

//屏幕第一根TICK，REF(TICK_VOL,1)返回空值，所以TICK_VOL-REF(TICK_VOL,1)在屏幕第一根TICK上返回空值。

例：
VV:TICK_VOL;//加载到TICK图中，定义VV为该笔TICK的成交量；
```

## 金融统计函数

### ADMA

考夫曼均值

```pascal
ADMA(X,N,P,Q) 考夫曼均值

用法：ADMA(X,N,P,Q);求X在N个周期中的，快线频率参数为P，慢线频率参数为Q的考夫曼自适应均值。

注：
1、X为调用的k线数据（例如高、开、低，收）；N为调用的间隔时间；P为快线频率参数；Q为慢线频率参数。
2、当前的K线数不足N根时，函数返回空值。
3、N为0或空值的情况下，函数返回空值。

算法：
ADMA(X,N,P,Q)=REF(EMA(X,N),1)+CONSTANT*(X- REF(EMA(X,N),1));
CONSTANT是平滑系数，用麦语言函数可以表示为：
CONSTANT:=SQUARE((ABS((CLOSE-REF(CLOSE,N))/(SUM(ABS((CLOSE-REF(CLOSE,1))),N))))*(2/(P+1)-2/(Q+1))+2/(Q+1));

算法举例：计算C在9周期的，快线频率参数为2，慢线频率参数为30的考夫曼均值。
1、确定价格方向：价格方向表示整个时间段中的净价格变化。比如，使用N天的间隔（或N小时），这里N为9
2、计算方向移动：DIRECTION:=ABS(CLOSE-REF(CLOSE,9));
3、计算波动性：波动性是市场噪音的总数量，计算了时间段内价格变化的总和。
VOLATILITY:=SUM(ABS((CLOSE-REF(CLOSE,1))),9);
4、确定效率系数：
ER:=DIRECTION/VOLATILITY;
5、计算平滑系数：
FASTSC:=2/(2+1);
SLOWSC:=2/(30+1);
SMOOTH:=ER*(FASTSC-SLOWSC)+SLOWSC;
CONSTANT:=SQUARE(SMOOTH);
6、计算平滑系数为CONSTANT的自适应均线：
AMACLOSE:REF(EMA(C,9),1)+CONSTANT*(C-REF(EMA(C,9),1));
```

### BARSCOUNT

第一个有效周期到当前的周期数

```pascal
BARSCOUNT(COND) 第一个有效周期到当前的周期数。

注：
1、返回值为COND从第一个有效周期开始计算，到现在为止的周期数。
2、条件第一次成立的当根k线上BARSCOUNT(COND)的返回值为0

例：
BARSCOUNT(MA(C,4));//计算MA(C,4)第一次有返回值到当前的周期数。
```

### BARSLAST

上一次条件成立位置

```pascal
BARSLAST(COND)：上一次条件COND成立到当前的周期数

注：
1、条件成立的当根k线上BARSLAST(COND)的返回值为0

例1：
BARSLAST(OPEN>CLOSE); //上一根阴线到现在的周期数。
例2：
N:=BARSLAST(DATE<>REF(DATE,1))+1;//分钟周期，当日k线数。
//由于条件成立的当根k线上BARSLAST(COND)的返回值为0，所以“+1”才是当日k线根数。
```

### BARSLASTCOUNT

从当前周期向前计算，统计连续满足条件的周期数

```pascal
BARSLASTCOUNT(COND) 从当前周期向前计算，统计连续满足条件的周期数。

注：
1、返回值为从当前周期计算COND连续不为0的周期数
2、条件第一次成立的当根k线上BARSLASTCOUNT(COND)的返回值为1

例：
BARSLASTCOUNT(CLOSE>OPEN);
//计算当根K线在内连续为阳线的周期数
```

### BARSSINCE

第一个条件成立到当前的周期数

```pascal
BARSSINCE(COND) 第一个条件成立到当前的周期数。

注：
1、返回值为COND第一次成立到当前的周期数
2、条件第一次成立的当根k线上BARSSINCE(COND)的返回值为0

例：
BARSSINCE(CLOSE>OPEN);
//统计第一次满足阳线这个条件的K线到现在的周期数
```

### BARSSINCEN

统计 N 周期内第一次条件成立到当前的周期数

```pascal
BARSSINCEN(COND,N) 统计N周期内第一次条件成立到当前的周期数

注：
1、N包含当前k线。
2、当N为有效值，但当前的k线数不足N根，按照实际的根数计算；
3、若N为0返回无效值；
4、N可以为变量

例：
N:=BARSLAST(DATE<>REF(DATE,1))+1;//分钟周期，当日K线数。
BARSSINCEN(ISUP,N);//统计N周期内第一次满足阳线到当前的周期数
```

### CONDBARS

取得最近满足 A,B 条件的 K 线间周期数

```pascal
CONDBARS(A,B);取得最近的满足A、B条件的k线间周期数
注意：
1、该函数返回周期数不包含最后满足条件的K线
2、距离当前K线最近的满足的条件为B条件，则该函数返回值为最后一次满足A条件的K线到满足B条件的K线的周期数（A条件满足后的第一次满足B条件的K线)
距离当前K线最近的满足的条件为A条件，则该函数返回值为最后一次满足B条件的K线到满足A条件的K线的周期数（B条件满足后的第一次满足A条件的K线)

例1：
MA5:=MA(C,5);//5周期均线
MA10:=MA(C,10);//10周期均线
CONDBARS(CROSSUP(MA5,MA10),CROSSDOWN(MA5,MA10));//最近一次满足5周期均线上穿10周期均线与5周期均线下穿10周期均线之间的周期数
```

### COST

成本分布情况

```pascal
COST(X) 成本分布情况。
用法:
 COST(X) 表示X%获利盘的价格,即有X%的持仓成本在该价格下，其余(100-X)%的持仓成本在该价格以上，是套牢盘。
例如COST(1);返回10.5表示1%获利盘的价格是10.5。

注：
1、X的取值范围为(0-100)（0、100返回无效值），并且X可以为变量。
2、该函数仅对日线分析周期有效。

算法：
 根据获利盘和套牢盘的比例求得价格。
```

### COUNT

统计总数

```pascal
COUNT(COND,N)：统计N周期中满足COND条件的周期数。

注：
1、N包含当前k线。
2、若N为0则从第一个有效值算起；
3、当N为有效值，但当前的k线数不足N根，从第一根统计到当前周期。
4、N 为空值时返回值为空值 。
5、N可以为变量

例1：
N:=BARSLAST(DATE<>REF(DATE,1))+1;//分钟周期，当日k线数。
M:COUNT(ISUP,N);//统计分钟周期上开盘以来阳线的根数。
例2：
MA5:=MA(C,5);//定义5周期均线
MA10:=MA(C,10);//定义10周期均线
M:COUNT(CROSSUP(MA5,MA10),0);//统计从申请到的行情数据以来到当前这段时间内，5周期均线上穿10周期均线的次数。
```

### DAYBARPOS

当根 k 线为当天第几根 k 线

```pascal
DAYBARPOS：返回当根k线是当天的第几根k线

注：
该函数返回当根k线是当天的第几根k线，日以上周期返回空值

例：
VALUEWHEN(DAYBARPOS=1,C);//取当天第一根K线的收盘价
```

### DMA

动态移动平均

```pascal
DMA(X,A)：求X的动态移动平均，其中A必须小于1大于0。
注：
1、A可以为变量
2、如果A<=0或者A>=1，返回无效值

计算公式：DMA(X,A)=REF(DMA(X,A),1)*(1-A)+X*A

例1：
DMA3:=DMA(C,0.3);//计算结果为REF(DMA3,1)*(1-0.3)+C*0.3
```

### EMA

指数加权移动平均

```pascal
EMA(X,N)：求N周期X值的指数加权移动平均（平滑移动平均）。

注：
1、N包含当前k线。
2、对距离当前较近的k线赋予了较大的权重。
3、当N为有效值，但当前的k线数不足N根，按实际根数计算。
4、N为0或空值时返回值为空值。
5、N可以为变量

EMA(X,N)=2*X/(N+1)+(N-1)*REF(EMA(X,N),1)/(N+1)

例1：
EMA10:=EMA(C,10);//求收盘价10周期指数加权移动平均值
```

### EMA2

线性加权移动平均

```pascal
EMA2(X,N);//求N周期X值的线性加权移动平均(也称WMA)

EMA2(X,N)=[N*X0+(N-1)*X1+(N-2)*X2+...+1*X(N-1)]/[N+(N-1)+(N-2)+...+1],X0表示本周期值，X1表示上一周期值

注：
1、N包含当前k线。
2、当N为有效值，但当前的k线数不足N根，返回值为空值。
3、N为0或空值时返回值为空值。
4、N可以为变量

例1：
EMA2(H,5);//求最高价在5个周期的线性加权移动平均值。
```

### EMAWH

指数加权移动平均

```pascal
EMAWH(C,N)，指数加权移动平均，也叫平滑移动平均，采用指数加权方法，对距离当前较近的K线赋予了较大的权重。
注：
1、当N为有效值，当前的k线数不足N根时，或者前面周期的取值仍作用于当前周期时，EMAWH返回值为空值
因为EMAWH计算公式中着重考虑了当周期的权重，所以当周期较长，前面的周期取值对当前的影响越小，EMAWH从前面数据对当前周期不再影响时的取值开始显示，所以即使选择的数据起始时间不同，当前已经显示的K线的EMAWH的取值也不会发生变化
2、当N为0或空值时返回值均为空值
3、N不能为变量

EMAWH(C,N)=2*C/(N+1)+(N-1)*REF(EMAWH(C,N),1)/(N+1)

注：
EMAWH用法同EMA(C,N)
```

### HARMEAN

调和平均值

```pascal
HARMEAN(X,N) 求X在N个周期内的调和平均值。

算法举例：HARMEAN(X,5)=1/[(1/X1+1/X2+1/X3+1/X4+1/X5)/5]

注：
1、N包含当前k线。
2、调和平均值与倒数的简单平均值互为倒数。
3、当N为有效值，但当前的k线数不足N根，函数返回空值。
4、N为0或空值的情况下，函数返回空值。
5、X为0或空值的情况下，函数返回空值。
6、N可以为变量。

例：
HM5:=HARMEAN(C,5);//求5周期收盘价的调和平均值。
```

### HHV

最高值

```pascal
HHV(X,N)：求X在N个周期内的最高值。

注：
1、N包含当前k线。
2、若N为0则从第一个有效值开始算起;
3、当N为有效值，但当前的k线数不足N根，按照实际的根数计算;
4、N为空值时，返回空值。
5、N可以是变量。

例1：
HH:HHV(H,4);//求4个周期最高价的最大值，即4周期高点（包含当前k线）。
例2：
N:=BARSLAST(DATE<>REF(DATE,1))+1;//分钟周期，日内k线根数
HH1:=HHV(H,N);//在分钟周期上，日内高点
```

### HV

除当前 K 线外最高值

```pascal
HV(X,N)： 求X在N个周期内（不包含当前k线）的最高值。

注：
1、若N为0则从第一个有效值开始算起(不包含当前K线)；
2、当N为有效值，但当前的k线数不足N根，按照实际的根数计算，第一根k线返回空值；
3、N为空值时，返回空值。
4、N可以是变量。

例1：
HH:HV(H,10);//求前10根k线的最高点。
例2：
N:=BARSLAST(DATE<>REF(DATE,1))+1;
NN:=REF(N,N);
ZH:VALUEWHEN(DATE<>REF(DATE,1),HV(H,NN));//在分钟周期上，求昨天最高价。
例3：
HV(H,5) 和 REF(HHV(H,5),1) 的结果是一样的，用HV编写更加方便。
```

### HHVBARS

前一最高点位置

```pascal
HHVBARS(X,N)： 求N周期内X最高值到当前周期数

注：
1、若N为0则从第一个有效值开始算起(不包含当前K线)；
2、当N为有效值，但当前的k线数不足N根，按照实际的根数计算，第一根k线返回空值；
3、N为空值时，返回空值。
4、N可以是变量。

例1：
HHVBARS(VOL,0); 求历史成交量最大的周期到当前的周期数（最大值那根k线上HHVBARS(VOL,0);的返回值为0，最大值后的第一根k线返回值为1，依次类推）。
例2：
N:=BARSLAST(DATE<>REF(DATE,1))+1;//分钟周期，日内k线根数
ZHBARS:REF(HHVBARS(H,N),N)+N;//在分钟周期上，求昨天最高价所在的k线到当前k线之间的周期数。
```

### LLV

最低值

```pascal
LLV(X,N)： 求X在N个周期内的最小值。

注：
1、N包含当前k线。
2、若N为0则从第一个有效值开始算起;
3、当N为有效值，但当前的k线数不足N根，按照实际的根数计算;
4、N为空值时，返回空值。
5、N可以是变量。

例1：
LL:LLV(L,5);//求5根k线最低点（包含当前k线）。
例2：
N:=BARSLAST(DATE<>REF(DATE,1))+1;//分钟周期，日内k线根数
LL1:=LLV(L,N);//在分钟周期上，求当天第一根k线到当前周期内所有k线最低价的最小值。
```

### LV

除当前 K 线外最低值

```pascal
LV(X,N) 求X在N个周期内的最小值（不包含当前k线）

注：
1、若N为0则从第一个有效值开始算起;
2、当N为有效值，但当前的k线数不足N根，按照实际的根数计算;
3、N为空值时，返回空值。
4、N可以是变量。

例1：
LL:LV(L,10);//求前面10根k线的最低点。（不包含当前k线）
例2：
N:=BARSLAST(DATE<>REF(DATE,1))+1;//分钟周期，日内k线根数
NN:=REF(N,N);
ZL:VALUEWHEN(DATE<>REF(DATE,1),LV(L,NN));//在分钟周期上，求昨天最低价。
例3：
LV(L,5) 和 REF(LLV(L,5),1) 的结果是一样的，用LV编写更加方便。
```

### LLVBARS

前一个最低点位置

```pascal
LLVBARS(X,N)： 求N周期内X最低值到当前周期数

注：
1、若N为0则从第一个有效值开始算起(不包含当前K线)；
2、当N为有效值，但当前的k线数不足N根，按照实际的根数计算，第一根k线返回空值；
3、N为空值时，返回空值。
4、N可以是变量。

例1：
LLVBARS(VOL,0); 求历史成交量最小的周期到当前的周期数（最小值那根k线上LLVBARS(VOL,0);的返回值为0，最小值后的第一根k线返回值为1，依次类推）。
例2：
N:=BARSLAST(DATE<>REF(DATE,1))+1;//分钟周期，日内k线根数
ZLBARS:REF(LLVBARS(L,N),N)+N;//在分钟周期上，求昨天最低价所在的k线到当前k线之间的周期数。
```

### MA

算数移动平均

```pascal
MA(X,N) 求X在N个周期内的简单移动平均

算法：MA(X,5)=(X1+X2+X3+X4+X5)/5
注：
1、N包含当前k线。
2、简单移动平均线沿用最简单的统计学方式，将过去某特定时间内的价格取其平均值。
3、当N为有效值，但当前的k线数不足N根，函数返回空值。
4、N为0或空值的情况下，函数返回空值。
5、N可以为变量

例1：
MA5:=MA(C,5);//求5周期收盘价的简单移动平均。
例2：
N:=BARSLAST(DATE<>REF(DATE,1))+1;//分钟周期，日内k线根数
M:=IFELSE(N>10,10,N);//k线超过10根，M取10，否则M取实际根数
MA10:MA(C,M);//在分钟周期上，当天k线不足10根，按照实际根数计算MA10，超过10根按照10周期计算MA10。
```

### MV

取均值

```pascal
MV(A,...P) 取A到P的均值。

注：
1、支持取2-16个数值的均值
2、A...P可以为数字也可以为变量

例1：
MV(CLOSE,OPEN);
//取收盘价和开盘价的平均值
```

### NEWHBARS

创新高跨度

```pascal
NEWHBARS(X,N) 计算高于当前X的第N个X到现在K线的距离。

注：
1、计算距离时不包括当根K线。
2、参数N不支持写为变量。
例：
DISTH:=NEWHBARS(H,1);//上一次创新高距离当前的K线根数
HI20:=REF(H,DISTH);//上一次创新高的高点
CROSS(C,REF(HI20,1)),BK;//最新价突破上一次创新高的高点，多头开仓
C<=BKPRICE-5,SP;
AUTOFILTER;
```

### NEWLBARS

创新低跨度

```pascal
NEWLBARS(X,N) 计算低于当前X的第N个X到现在K线的距离。

注：
1、计算距离时不包括当根K线。
2、参数N不支持写为变量。
例：
DISTL:=NEWLBARS(L,1);//上一次创新低距离当前的K线根数
LI20:=REF(L,DISTL);//上一次创新低的低点
CROSS(REF(LI20,1),C),SK;//最新价跌破上一次创新低的低点，空头开仓
C>=SKPRICE+5,BP;
AUTOFILTER;
```

### NUMPOW

自然数幂方和

```pascal
NUMPOW(X,N,M);自然数幂方和
算法：
NUMPOW(x,n,m)=n^m*x+(n-1)^m*ref(x,1)+(n-2)^m*ref(x,2)+...+2^m*ref(x,n-2)+1^m*ref(x,n-1)
注意:
1、N为自然数，M为实数；且N与M不能为变量
2、X为基础变量

例：
JZ:=NUMPOW(C,5,2);
```

### PERCENTILE

百分位函数

```pascal
PERCENTILE 百分位函数。

用法：
PERCENTILE(Data,N,Per) 百分位函数
取最近N个周期Data数据处于Per百分位的数值。
Data为需要排序的数据，N为需要排序的周期数，Per是百分位数值。

注：
1、Data参数可以为变量。
2、百分位数值的有效范围为[0,100],不能整除时向上取整。


例：
HH:PERCENTILE(HIGH,50,95);//取最近50根k线最高价处于95%位置的数值
LL:PERCENTILE(LOW,50,5);//取最近50根k线最低价处于5%位置的数值
```

### SAR

抛物转向

```pascal
SAR(N,STEP,MAX) 返回抛物转向值。

根据公式SAR(n)=SAR(n-1)+AF*(EP(n-1)-SAR(n-1))计算

其中：
SAR(n-1)：上根K线SAR的绝对值
AF：加速因子，当AF小于MAX时，逐根的通过AF+STEP累加，涨跌发生转换时，AF重新计算
EP：一个涨跌内的极值，在上涨行情中为上根K线的最高价；下跌行情中为上根K线的最低价

注：
1、参数N,Step,Max均不支持变量

例1：
SAR(17,0.03,0.3);//表示计算17个周期抛物转向，步长为3%，极限值为30%
```

### SAR1

抛物转向

```pascal
SAR1(N,STEP,MAX) 返回抛物转向值。

根据公式SAR1(n)=SAR1(n-1)+AF*(EP(n-1)-SAR1(n-1))计算

其中：
SAR1(n-1)：上根K线SAR1的绝对值

AF：加速因子，当AF小于MAX时，
上涨行情，H>HV(H,N)   AF = AF+STEP; H<=HV(H,N) AF = AF;
下跌行情，L<lV(L,N)   AF = AF+STEP; L>=LV(L,N) AF = AF;
涨跌发生转换时，AF重新计算
EP：一个涨跌内的极值，在上涨行情中为前N根K线的最高价；下跌行情中为前N根K线的最低价

注：
1、参数N,Step,Max均不支持变量

例1：
SAR1(17,0.03,0.3);//表示计算17个周期抛物转向，步长为3%，极限值为30%
```

### SEEK

标签统计函数

```pascal
SEEK 标签统计函数
此函数为系统封装函数。

用法：
SEEK(Cond) 标签统计函数
Cond为需要满足的条件

注：
1、图表中加载了含有SEEK函数的模型，可以图表右键选择SEEK统计查看结果
2、一个模型中只能含有一个SEEK函数。
3、一个图表中只能加载一个含有SEEK函数的模型。

例：
SEEK(C>O);
```

### SMA

扩展指数加权移动平均

```pascal
SMA(X,N,M) 求X的N个周期内的扩展指数加权移动平均。M为权重。

计算公式：SMA(X,N,M)=REF(SMA(X,N,M),1)*(N-M)/N+X(N)*M/N
注：
1、当N为有效值，但当前的k线数不足N根，按实际根数计算。
2、 N为0或空值的情况下，函数返回空值。

例1：
SMA10:=SMA(C,10,3);//求的10周期收盘价的扩展指数加权移动平均。权重为3。
```

### SMMA

通畅移动平均

```pascal
SMMA(X,N)，X为变量,N为周期，SMMA(X,N)表示当前K线上X在N个周期的通畅移动平均线
算法：SMMA(X,N)=(SUM1-MMA+X)/N
其中SUM1=X1+X2+.....+XN
MMA=SUM1/N
例1：
SMMA(C,5);//收盘价的5周期通畅移动平均线
```

### SORT

取排序在相应位置的值

```pascal
SORT(Type,POS,N1,N2,...,N16); 按升(降)序排列，取第POS个参数对应的值

注：
1、当Type为0按升序排列，当Type为1按降序排列；
2、TYPE,POS,不支持变量
3、N1,...,N16为参数，支持常量、变量，最多支持16个参数

例：
SORT(0,3,2,1,5,3);//2、1、5、3按升序排列，取排列第三的数字3
```

### SORTPOS

取排序后数值的位置

```pascal
SORTPOS(Type,POS,N1,N2,...,N16); 按升(降)序排列，取第POS个数据的原始位置

注：
1、当Type为0按升序排列，当Type为1按降序排列；
2、TYPE,POS,不支持变量；
3、N1,...,N16为参数，支持常量、变量，最多支持16个参数
4、如存在两个或两个以上相同的值，保持原有的顺序排列。如SORTPOS(1,3,2,1,2,5,3);返回值为1，取第一个2的位置；SORTPOS(1,4,2,1,2,5,3);返回值为4，取第二个2的位置
5、返回的原始位置，从1开始

例：
SORTPOS(0,3,2,1,5,3);//2、1、5、3按升序排列，排列第三的数字3，所对应的原始位置。函数返回值为4
```

### SUM

求和

```pascal
SUM(X,N) 求X在N个周期内的总和。

注：
1、N包含当前k线。
2、若N为0则从第一个有效值开始算起。
3、当N为有效值，但当前的k线数不足N根，按照实际的根数计算。
4、N为空值时，返回空值。
5、N可以为变量。

例1：
SUM(VOL,25);表示统计25周期内的成交量总和
例2：
N:=BARSLAST(DATE<>REF(DATE,1))+1;//分钟周期，日内k线根数
SUM(VOL,N);//分钟周期上，取当天成交量总和。
```

### SUMBARS

累加到指定值的周期数

```pascal
SUMBARS(X,A)：求累加到指定值的周期数

注：
参数A支持变量

例1：
SUMBARS(VOL,20000); 将成交量向前累加直到大于等于20000，返回这个区间的周期数。
```

### TRMA

三角移动平均

```pascal
TRMA(X,N)： 求X在N个周期的三角移动平均值。

算法：三角移动平均线公式，是采用算数移动平均，并且对第一个移动平均线再一次应用算数移动平均。
TRMA(X,N) 算法如下
ma_half= MA(X,N/2)
trma=MA(ma_half,N/2)

注：
1、N包含当前k线。
2、当N为有效值，但当前的k线数不足N根，函数返回空值。
3、N为0或空值的情况下，函数返回空值。
4、N支持使用变量

例1：
TRMA5:TRMA(CLOSE,5);//计算5个周期内收盘价的三角移动平均。(N不能被2整除)
//TRMA(CLOSE,5)=MA(MA(CLOSE,(5+1)/2)),(5+1)/2);
例2:
TRMA10:TRMA(CLOSE,10);// 计算10个周期内收盘价的三角移动平均。(N能被2整除)
TRMA(CLOSE,10)=MA(MA(CLOSE,10/2),(10/2)+1));
```

### TSMA

时间序列移动平均

```pascal
TSMA(X,N)：求X在N个周期内的时间序列三角移动平均
TSMA(a,n) 算法如下：
ysum=a[i]+a[i-1]+...+a[i-n+1]
xsum=i+i-1+..+i-n+1
xxsum=i*i+(i-1)*(i-1)+...+(i-n+1)*(i-n+1)
xysum=i*a[i]+(i-1)*a[i-1]+...+(i-n+1)*a[i-n+1]
k=(xysum -(ysum/n)*xsum)/(xxsum- xsum/n * xsum) //斜率
b= ysum/n - k*xsum/n
forcast[i]=k*i+b //线性回归
tsma[i] = forcast[i]+k  //线性回归+斜率

注：
1、当N为有效值，但当前的k线数不足N根，函数返回空值。
2、N为0或空值的情况下，函数返回空值。
3、N支持使用变量
例1：
TSMA5:TSMA(CLOSE,5);//计算5个周期内收盘价的序列三角移动平均
```

### WINNER

获利盘比例

```pascal
WINNER 获利盘比例
用法:
 WINNER(CLOSE),表示以当前收市价卖出的获利盘比例,例如返回0.1表示10%获利盘;WINNER(10.5)表示10.5元价格的获利盘比例

注：
 该函数仅对日线分析周期有效

算法：
 统计小于等于当前收盘价的K线成交量之和与所有K线成交量之和的比值；
```

## 数理统计函数

### AVEDEV

平均绝对偏差

```pascal
AVEDEV(X,N)：返回X在N周期内的平均绝对偏差。

注：
1、N包含当前k线。
2、N为有效值，但当前的k线数不足N根，该函数返回空值；
3、N为0时，该函数返回空值；
4、N为空值，该函数返回空值；
5、N不能为变量

算法举例：计算AVEDEV(C,3);在最近一根K线上的值。

用麦语言函数可以表示如下：
(ABS(C-(C+REF(C,1)+REF(C,2))/3)+ABS(REF(C,1)-(C+REF(C,1)+REF(C,2))/3)+ABS(REF(C,2)-(C+REF(C,1)+REF(C,2))/3))/3;

例：
AVEDEV(C,5);//返回收盘价在5周期内的平均绝对偏差。
//表示5个周期内每个周期的收盘价与5周期收盘价的平均值的差的绝对值的平均值，判断收盘价与其均值的偏离程度
```

### COEFFICIENTR

皮尔森相关系数

```pascal
COEFFICIENTR(X,Y,N) 求X、Y在N个周期内的皮尔森相关系数。

注：
1、N包含当前k线。
2、N为有效值，但当前的k线数不足N根，该函数返回空值。
3、N为0时，该函数返回空值。
4、N为空值，该函数返回空值。
5、N可以为变量。

算法举例：计算COEFFICIENTR(O,C,3);在最近一根K线上的值。
用麦语言函数可以表示如下：
(((O-MA(O,3))*(C-MA(C,3))+(REF(O,1)-MA(O,3))*(REF(C,1)-MA(C,3))+(REF(O,2)-MA(O,3))*(REF(C,2)-MA(C,3))) /(STD(O,3)*STD(C,3)))/(3-1);

例：
CC: C;//定义文华商品的收盘价
保存指标，命名为AA
加载豆粕合约的指标为：
#CALL[7186,AA]  AS  VAR
C1:VAR.CC;//跨合约引用文华商品的收盘价
COEFFICIENTR(C1,C,10);//求文华商品和豆粕在10个周期内的皮尔森相关系数。
//皮尔森相关系数是衡量两个随机变量之间的相关程度的指标
```

### CORRELATION

相关系数

```pascal
CORRELATION(X,Y,N) 求X、Y在N个周期内的相关系数。

注：
1、N包含当前k线。
2、N为有效值，但当前的k线数不足N根，该函数返回空值。
3、N为0时，该函数返回空值。
4、N为空值，该函数返回空值。
5、N可以为变量。

算法举例：计算CORRELATION (O,C,3);在最近一根K线上的值。
用麦语言函数可以表示如下：
(((O-MA(O,3))*(C-MA(C,3))+(REF(O,1)-MA(O,3))*(REF(C,1)-MA(C,3))+(REF(O,2)-MA(O,3))*(REF(C,2)-MA(C,3))))/SQRT((SQUARE(O-MA(O,3))+SQUARE(REF(O,1)-MA(O,3))+SQUARE(REF(O,2)-MA(O,3)))*(SQUARE(C-MA(C,3))+SQUARE(REF(C,1)-MA(C,3))+SQUARE(REF(C,2)-MA(C,3))));

例：
CC: C;//定义文华商品的收盘价
保存指标，命名为AA
加载豆粕合约的指标为：
#CALL[7186,AA]  AS  VAR
C1:VAR.CC;//跨合约引用文华商品的收盘价
CORRELATION(C1,C,10);//求文华商品和豆粕在10个周期内的相关系数。
//相关系数是衡量两个随机变量之间的相关程度的指标
```

### COVAR

协方差

```pascal
COVAR(X,Y,N) 求X、Y在N个周期内的协方差。

注：
1、N包含当前k线。
2、N为有效值，但当前的k线数不足N根，该函数返回空值。
3、N为0时，该函数返回空值。
4、N为空值，该函数返回空值。
5、N可以为变量。

算法举例：计算COVAR(O,C,3);在最近一根K线上的值。
用麦语言函数可以表示如下：
(((O-MA(O,3))*(C-MA(C,3))+(REF(O,1)-MA(O,3))*(REF(C,1)-MA(C,3))+(REF(O,2)-MA(O,3))*(REF(C,2)-MA(C,3))) )/3;

例：
CC: C;//定义文华商品的收盘价
保存指标，命名为AA
加载豆粕合约的指标为：
#CALL[7186,AA]  AS  VAR
C1:VAR.CC;//跨合约引用文华商品的收盘价
COVAR(C1,C,10);//求文华商品和豆粕在10个周期内的协方差。
//两个不同变量之间的方差就是协方差，如果两个变量的变化趋势一致，那么两个变量之间的协方差就是正值；如果两个变量的变化趋势相反，那么两个变量之间的协方差就是负值。
```

### DEVSQ

取得数据偏差平方和

```pascal
DEVSQ(X,N)： 计算数据X的N个周期的数据偏差平方和。

注：
1、N包含当前k线。
2、N为有效值，但当前的k线数不足N根，该函数返回空值；
3、N为0时，该函数返回空值；
4、N为空值，该函数返回空值；
5、N不支持为变量

算法举例：计算DEVSQ(C,3);在最近一根K线上的值。

用麦语言函数可以表示如下：
SQUARE(C-(C+REF(C,1)+REF(C,2))/3)+SQUARE(REF(C,1)-(C+REF(C,1)+REF(C,2))/3)+SQUARE(REF(C,2)-(C+REF(C,1)+REF(C,2))/3);

例：
DEVSQ(C,5);计算数据收盘价5个周期的数据偏差平方和。
//表示收盘价与收盘价均值偏差分别平方之后求和，DEVSQ(C,5)表示5个周期的收盘价与收盘价均值偏差分别平方之后求和。
```

### FORCAST

线性回归值

```pascal
FORCAST(X,N)：为X的N周期线性回归预测值。

注：
1、N包含当前k线。
2、N为有效值，但当前的k线数不足N根，该函数返回空值；
3、N为0时，该函数返回空值；
4、N为空值，该函数返回空值；
5、N可以是变量

算法举例：用最小平方法计算FORCAST(C,3)在最近一根K线上的值
1、建立一元线性方程：y=a+b*i+m
2、y的估计值：y(i)^=a+b*i
3、求残差：m^=y(i)-y(i)^=y(i)-a-b*i
4、误差平方和：
Q=m(1)*m(1)+...+m(3)*m(3)=[y(1)-a-b*1]*[y(1)-a-b*1]+...+[y(3)-a-b*3]*[y(3)-a-b*3]
5、对线性方程中的参数a,b求一阶偏导:
2*{[y(1)-a-b*1]+...+[y(3)-a-b*3]}*(-1)=0
2*[y(1)-a-b*1]*(-1)+...+[y(3)-a-b*3]*(-3)=0
6、联立以上两个公式，解出a,b的值：
a=(y(1)+y(2)+y(3))/3-b(i(1)+i(2)+i(3))/3
b=(y(1)*i(1)+y(2)*i(2)+y(3)*i(3)-(3*((i(1)+i(2)+i(3))/3)*((y(1)+y(2)+y(3))/3))/((i(1)^2+i(2)^2+i(3)^2)-3*((i(1)+i(2)+i(3))/3)^2)
7、将a，b，i值带入1，求出y值

以上公式用麦语言函数可以表示如下：
BB:(3*C+2*REF(C,1)+REF(C,2)-(3*((1+2+3)/3)*MA(C,3)))/((SQUARE(1)+SQUARE(2)+SQUARE(3))-3*SQUARE((1+2+3)/3));
AA:MA(C,3)-BB*(1+2+3)/3;
YY:AA+BB*3;

例:
FORCAST(CLOSE,5);//表示求5周期线性回归预测值
```

### KURTOSIS

峰度系数

```pascal
KURTOSIS(X,N) 求X在N个周期内的峰度系数。

注：
1、N包含当前k线。
2、N为有效值，但当前的k线数不足N根，该函数返回空值。
3、N为0时，该函数返回空值。
4、N为空值，该函数返回空值。
5、N可以为变量。
6、N至少为4，少于4返回空值。

算法举例：计算KURTOSIS(C,4);在最近一根K线上的值。
用麦语言函数可以表示如下：
((POW(C-MA(C,4),4)+POW(REF(C,1)-MA(C,4),4)+POW(REF(C,2)-MA(C,4),4)+POW(REF(C,3)-MA(C,4),4)) /POW(STD(C,4),4))*(4*(4+1)/((4-1)*(4-2)*(4-3)))-3*SQUARE(4-1)/((4-2)*(4-3));

例：
KURTOSIS(C,10);
//表示收盘价的10周期峰值。峰值反映与正态分布相比某一分布的尖锐度或平坦度。正峰值表示相对尖锐的分布。负峰值表示相对平坦的分布。
```

### NORMPDF

正态分布概率密度

```pascal
NORMPDF(X,MU,SIGMA)：返回参数为MU和SIGMA的正态分布密度函数在X处的值

注：
1、MU或SIGMA为空值，该函数返回空值。
2、MU和SIGMA支持变量。

算法举例：随机变量X服从一个位置参数为MU、尺度参数为SIGMA的概率分布，其概率密度为NORMPDF(X,MU,SIGMA)。

用麦语言函数可以近似的表示如下：
(1/(SQRT(2*3.14)*SIGMA))*EXP((-SQUARE(X-MU))/(2*SQUARE(SIGMA)));

例：
TR:=MAX(MAX((HIGH-LOW),ABS(REF(CLOSE,1)-HIGH)),ABS(REF(CLOSE,1)-LOW));
ATR:=MA(TR,26);//求26个周期内的TR的简单移动平均
ZZ..NORMPDF(ATR,0,1);//定义变量ZZ，返回ATR服从标准正态分布的概率密度。
```

### SKEWNESS

偏度系数

```pascal
SKEWNESS(X,N) 求X在N个周期内的偏度系数。

注：
1、N包含当前k线。
2、N为有效值，但当前的k线数不足N根，该函数返回空值。
3、N为0时，该函数返回空值。
4、N为空值，该函数返回空值。
5、N可以为变量。
6、N至少为3，少于3返回空值。

算法举例：计算SKEWNESS(C,3);在最近一根K线上的值。
用麦语言函数可以表示如下：
((POW(C-MA(C,3),3)+POW(REF(C,1)-MA(C,3),3)+POW(REF(C,2)-MA(C,3),3)) /POW(STD(C,3),3))*3/((3-1)*(3-2));

例：
SKEWNESS(C,10);
//表示收盘价的10周期偏度。偏度反映分布的不对称度。不对称度反映以平均值为中心的分布的不对称程度。正不对称度表示不对称部分的分布更趋向正值。负不对称度表示不对称部分的分布更趋向负值。
```

### SLOPE

线性回归的斜率

```pascal
SLOPE(X,N)：得到X的N周期的线型回归的斜率。

注：
1、N包含当前k线。
2、N为有效值，但当前的k线数不足N根，该函数返回空值；
3、N为0时，该函数返回空值；
4、N为空值,该函数返回空值；
5、N可以为变量。

举例：
用最小平方法计算SLOPE(CLOSE,5)在最近一根K线上的的值：
1、建立一元线性方程：close=a+slope*i+m
2、close的估计值：close(i)^=a+slope*i
3、求残差：m^=close(i)-close(i)^=close(i)-a-slope*i
4、误差平方和：
Q=m(1)*m(1)+...+m(5)*m(5)=[close(1)-a-slope*1]*[close(1)-a-slope*1]+...+[close(5)-a-slope*5]*[close(5)-a-slope*5]
5、对线性方程中的参数a,slope求一阶偏导:
2*{[close(1)-a-slope*1]+...+[close(5)-a-slope*5]}*(-1)=0
2*{[close(1)-a-slope*1]+...+[close(5)-a-slope*5]}*(-5)=0
6、联立以上两个公式，反解出slope的值：
slope={[5*close(1))+...+1*close(5)]-[close(1)+...+close(5)]*(1+2+3+4+5)/5}/[(1*1+...+5*5)-(1+...+5)(1+...+5)/5]

以上公式用麦语言函数可以表示如下：
((5*C+4*REF(C,1)+3*REF(C,2)+2*REF(C,3)+1*REF(C,4))-SUM(C,5)*(1+2+3+4+5)/5)/((SQUARE(1)+SQUARE(2)+SQUARE(3)+SQUARE(4)+SQUARE(5))-SQUARE(1+2+3+4+5)/5);

例：
SLOPE(CLOSE,5);表示求收盘价5个周期线性回归线的斜率
```

### STD

样本标准差

```pascal
STD(X,N)：求X在N个周期内的样本标准差。

注：
1、N包含当前k线。
2、N为有效值，但当前的k线数不足N根，该函数返回空值；
3、N为0时，该函数返回空值；
4、N为空值，该函数返回空值。
5、N可以为变量

算法举例：计算STD(C,3);在最近一根K线上的值。

用麦语言函数可以表示如下：
SQRT((SQUARE(C-MA(C,3))+SQUARE(REF(C,1)-MA(C,3))+SQUARE(REF(C,2)-MA(C,3)))/2);

例：
STD(C,10)求收盘价在10个周期内的样本标准差。
//标准差表示总体各单位标准值与其平均数离差平方的算术平均数的平方根，它反映一个数据集的离散程度。STD(C,10)表示收盘价与收盘价的10周期均线之差的平方和的平均数的算术平方根。样本标准差是样本方差的平方根。
```

### STDP

总体标准差

```pascal
STDP(X,N)：为X的N周期总体标准差。

注：
1、N包含当前k线。
2、N为有效值，但当前的k线数不足N根，该函数返回空值；
3、N为0时，该函数返回空值；
4、N为空值，该函数返回空值。
5、N可以为变量

算法举例：计算STDP(C,3);在最近一根K线上的值。

用麦语言函数可以表示如下：
SQRT((SQUARE(C-MA(C,3))+SQUARE(REF(C,1)-MA(C,3))+SQUARE(REF(C,2)-MA(C,3)))/3);

例：
STDP(C,10)为收盘价的10周期总体标准差。

//总体标准差是反映研究总体内个体之间差异程度的一种统计指标，总体方差是一组资料中各数值与其算术平均数离差平方和的平均数，总体标准差则是总体方差的平方根。
```

### VAR

样本方差

```pascal
VAR(X,N)求X在N周期内的样本方差。

注：
1、N包含当前k线。
2、N为有效值，但当前的k线数不足N根，该函数返回空值；
3、N为0时，该函数返回空值；
4、N为空值，该函数返回空值；
5、N支持使用变量

算法举例：计算VAR(C,3);在最近一根K线上的值。
用麦语言函数可以表示如下：

(SQUARE(C-MA(C,3))+SQUARE(REF(C,1)-MA(C,3))+SQUARE(REF(C,2)-MA(C,3)))/(3-1);

例：
VAR(C,5)求收盘价在5周期内的样本方差。
//表示总体方差的N/(N-1)倍，VAR(C,5)表示收盘价的5周期总体样本方差的5/4倍。
```

### VARP

总体方差

```pascal
VARP(X,N)：为X的N周期总体方差

注：
1、N包含当前k线。
2、N为有效值，但当前的k线数不足N根，该函数返回空值；
3、N为0时，该函数返回空值；
4、N为空值，该函数返回空值；
5、N支持使用变量

算法举例：计算VARP(C,3);在最近一根K线上的值。
用麦语言函数可以表示如下：
(SQUARE(C-MA(C,3))+SQUARE(REF(C,1)-MA(C,3))+SQUARE(REF(C,2)-MA(C,3)))/3;

例：
VARP(C,5)为收盘价的5周期总体方差
//表示数据偏差平方和除以总周期数N，VARP(C,5)表示收盘价5个周期的数据偏差平方和除以5.
```

## 数学函数

### ABS

绝对值

```pascal
ABS(X)：取的X的绝对值。

注：
1、正数的绝对值是它本身；
2、负数的绝对值是它的相反数；
3、0的绝对值还是0；

例1：
ABS(-10);//返回10。
例2：
ABS(CLOSE-10);//返回收盘价和的10价差的绝对值。
例3：
ABS(C-O);//当前K线实体长度
```

### ACOS

反余弦值

```pascal
ACOS(X)：返回X的反余弦值。

注：
1、X取值范围[-1，1]。
2、若X不在取值范围，返回值为空值。

例1：
ACOS(-1);//求-1的反余弦值；
例2：
ACOS(1);//求1的反余弦值；
```

### ASIN

反正弦值

```pascal
ASIN(X)：返回X的反正弦值。

注：
1、X取值范围[-1，1]。
2、若X不在取值范围，返回值为空值。

例1：
ASIN(-1);//求-1的反正弦值；
例2：
ASIN(1);//求1的反正弦值；
```

### ATAN

反正切值

```pascal
ATAN(X)：返回X的反正切值。

注：X的取值为R（实数集）

例1：
ATAN(-1.75);//求-1.75的反正切值；
例2：
ATAN(1.75);//求1.75的反正切值；
```

### CEILING

向上舍入

```pascal
CEILING(X,Y) 返回指定实数(X)在沿绝对值增大的方向上第一个能整除基数(Y)的值。

注：
1、如果X和Y符号相同，则对值按远离0的方向进行舍入。
2、X和Y符号不同的情况下：
（1）如果X为负，Y为正，则对值按朝向0的方向进行向上舍入。
（2）如果X为正，Y为负，CEILING返回无效值。
3、X、Y均可以为变量。
4、若X、Y中任意一个为空值，则该函数返回空值。

例1：
CEILING(2.1,1);//求得3。
例2：
CEILING(-8.8,-2);//求得-10。
例3：
CEILING(CLOSE*1.01,1);//求收盘价的1.01倍向上取整
例4：
CEILING(-7,2);//求得-6。
例5：
CEILING(8,-2);//返回无效值。
```

### COS

余弦

```pascal
COS(X)：返回X的余弦值。

注：
1、X的取值为R（实数集）
2、值域为[-1，1]

例1：
COS(-1.57);//返回-1.57的余弦值
例2：
COS(1.57);//返回1.57的余弦值
```

### CUBE

立方函数

```pascal
CUBE(X)：返回X的三次方。

例1：
CUBE(4);//求4的立方。
```

### EXP

指数

```pascal
EXP(X)：求e的X次幂。

例1：
C*EXP(0.01);//求收盘价乘以e的0.01次幂
```

### FLOOR

向下舍入

```pascal
FLOOR(A)：向数值减小方向舍入。

注：
FLOOR(A)返回沿A数值减小方向最接近的整数，若A为整数，则返回值为A。

例1：
FLOOR(2.1);//返回值为2；
例2：
FLOOR(-8.8);//返回值为-9；
例3：
FLOOR(5);//返回值为5；
例4：
IFELSE(C-INTPART(C)>=0.5,CEILING(C),FLOOR(C));//对收盘价四舍五入后取整数部分。
```

### INTPART

取整

```pascal
INTPART(X)：取X的整数部分。

例1：
INTPART(12.3);//返回值为12；
例2：
INTPART(-3.5);//返回值为-3；
例3：
INTPART(10);//返回值为10；
例5：
INTPART(C);//求收盘价的整数部分。
```

### LN

自然对数

```pascal
LN(X)：求X的自然对数。
注：
1、X取值范围为非0自然数，即1、2、3、4、5……
2、若X取值为0或负数，返回值为空值。

例：
LN(OPEN);//求开盘价的对数。
```

### LOG

常用对数

```pascal
LOG(X) 求X的常用对数值。

注：
1、该函数中X的取值范围为X>0
2、0和负数没有对数，X为0或负数时返回值为空值。

例1：
LOG(100) 返回2.
例2：
LOG(0) 返回空值。
```

### MAX

最大值

```pascal
MAX(A,B)：取最大值。取A，B中较大者。

注：
若A=B，返回值为A或者B的值。

例1：
MAX(CLOSE,OPEN);//表示取开盘价和收盘价中较大者。
例2：
MAX(CLOSE-OPEN,0);//表示若收盘价大于开盘价返回它们的差值，否则返回0。
例3：
MAX(A,MAX(B,MAX(C,D)));//求 A B C D四者中的最大值
```

### MAX1

取最大值

```pascal
MAX1(A...P) 在A到P中取最大值。

注：
1、支持2-16个数值进行比较。
2、A...P可以为数字也可以为变量。

例1：
MAX1(CLOSE,OPEN);//表示取开盘价和收盘价中较大者。

例2：
MAX1(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16);//表示取数字1-16中的最大值。
```

### MEDIAN

求中位数

```pascal
MEDIAN(X,N) 求X在N个周期内居于中间的数值。

注：
1、N个周期内所有X排序后，若N为奇数，则选择第（N+1）/2个为中位数，若N为偶数，则中位数是（N/2以及N/2+1）的平均数。
2、N可以为变量。

例1：
豆粕1509最近3日的收盘价为2727、2754、2748，那么当前MEDIAN(C,3)的返回值是2748
例2：
豆粕1509最近4日的开盘价为2752、2743、2730、2728，那么当前MEDIAN(O,4)的返回值是2736.5
```

### MEDIAN1

求中位数

```pascal
MEDIAN1(A,...,P) 求A到P内居于中间的数值。

注：
1、支持最多16个参数进行计算。
2、A...P可以为数值也可以为变量。
3、若参数个数为N,对N个参数排序后，N为奇数，则选择第（N+1）/2个为中位数，若N为偶数，则中位数是（N/2以及N/2+1）的平均数。

例1:
AA:MEDIAN1(O,C,H);//开盘价、收盘价、最高价按数值排序，取居中的数值
例2：
BB:MEDIAN1(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16);//表示取数字1-16的中位数,BB返回8.5
```

### MIN

最小值

```pascal
MIN(A,B)：取最小值。取A，B中较小者

注：
若A=B，返回值为A或者B的值。

例1：
MIN(OPEN,CLOSE);//表示取开盘价和收盘价中的较小者。
例2：
MIN(C,MIN(O,REF(C,1)));//求当前周期的开盘价，收盘价，以及上周期的收盘价间最小的数值
```

### MIN1

取最小值

```pascal
MIN1(A...P) 在A到P中取最小值。

注：
1、支持2-16个数值进行比较。
2、A...P可以为数字也可以为变量。

例1：
MIN1(CLOSE,OPEN);//表示取开盘价和收盘价中较小者。

例2：
MIN1(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16);//表示取数字1-16中的最小值。
```

### MOD

取模

```pascal
MOD(A,B)：取模。返回A对B求模。

例1：
MOD(26,10);//返回6，26除以10所得余数为6，即26对10 的模为6。
例2：
DRAWICON(MOD(BARPOS,3)=0,H,'ICO1');//从数据开始第一根k线开始 分别在第3、6、9、
12等k线依次往后每隔3根k线标注一个笑脸图案
例3：
MOD(A,2)=0;//判断A为偶数。
```

### MODE

求众数

```pascal
MODE(X,N) 求X在N个周期内最常出现的值。

注：
1、如果N个周期内不含有重复的数值，则函数返回空值。
2、N可以为变量。
```

### POW

幂

```pascal
POW(X,Y)：求X的Y次幂。

注：
1、当X为负数时，Y必须为整数，因为底数为负时，不能进行开方运算，返回值为空值。
2、X,Y可以为数值，也可以为变量。

例1：
POW(CLOSE,2);//求得收盘价的2次方。
例2：
POW(10,2);//返回值为100
例3：
POW(1/2,-2);//返回值为4
例4：
POW(100,O-C);//返回100的O-C次方
```

### RAND

产生随机数的随机函数

```pascal
RAND(X,Y) 产生随机数的随机函数,返回范围在X到Y之间的随机数。

注：
1、X、Y参数均支持设置为变量。
2、该函数仅支持返回整数
3、当X>Y时，函数返回空值。
4、当X与Y的范围小于1时，函数返回无效值。

例1：
RAND(1,60);//返回1到60之间的随机数值
例2：
RAND(C,O);//返回收盘价到开盘价之间的随机数值
```

### RANGE

范围

```pascal
RANGE(X,Y,Z)：介于某个范围之内。表示X大于Y同时小于Z时返回1，否则返回0
例1：
RANGE(5,4,6);//返回值为1；
例2：
RANGE(8,3,6);//返回值为0；
例3：
MA5:MA(C,5);
MA10:MA(C,10);
MA20:MA(C,20);
RANGE(MA10,MA20,MA5),BK;//10周期均线在5周期均线与20周期均线之间买开仓

//RANGE(MA10,MA20,MA5)=1,BK; 与 RANGE(MA10,MA20,MA5),BK; 表达同等意义
```

### REVERSE

取相反值

```pascal
REVERSE(X)：取相反值，返回－X。

例1：
REVERSE(LOW);//返回-LOW。
例2：
REVERSE(-55);//返回值为55
例3：
REVERSE(0);//返回值为0
```

### ROUND

指定位数四舍五入

```pascal
ROUND(N,M) 对数字N进行位数为M的四舍五入。

注：
1、N支持写为变量和参数；M不支持写为变量，可以写为参数。
2、M>0，则对数字N小数点后M位小数进行四舍五入。
3、M=0，则将数字N四舍五入为整数。
4、M<0，则在数字N小数点左侧前M位进行四舍五入。

例1：
ROUND(125.345,2);//返回125.35。
例2：
ROUND(125.345,0);//返回125。
例3：
ROUND(125.345,-1);//返回130
```

### SGN

取符号

```pascal
SGN(X)：取符号。若X>0返回1,若X<0返回-1,否则返回0。

例1：
SGN(5);//返回值为1
例2：
SGN(-5);//返回值为-1
例3：
SGN(0);//返回值为0
```

### SIN

求正弦

```pascal
SIN(X)：求X的正弦值。

注：
1、X的取值为R（实数集）；
2、值域为(-1，1)。

例1：
SIN(-1.57);//返回-1.57的正弦值
例2：
SIN(1.57);//返回1.57的正弦值
```

### SQRT

平方根

```pascal
SQRT(X)：求X的平方根。

注：
X的取值为正数，X为负数时返回空值。

例1：
SQRT(CLOSE);//收盘价的平方根。
```

### SQUARE

平方

```pascal
SQUARE(X)求X的平方。

例1：
SQUARE(C);//收盘价的平方。
例2：
SQUARE(2);//2的平方。
```

### TAN

正切

```pascal
TAN(X)：返回X的正切值。
例1：
TAN(0);//返回0的正切值；
例2：
TAN(-3.14);//返回-3.14的正切值。
```

## 逻辑判断函数

### BARSTATUS

返回当前周期的位置状态

```pascal
BARSTATUS 返回当前周期的位置状态。

注：
该函数返回1表示当前周期是第一个周期，返回2表示是最后一个周期，返回0表示当前周期处于中间位置。

例:
A:=IFELSE(BARSTATUS=1,H,0);//如果当前K线是第一个周期，变量A返回K线最高值，否则取0。
```

### BETWEEN

介于

```pascal
BETWEEN(X,Y,Z) 表示X是否处于Y和Z之间，成立返回1(Yes)，否则返回0(No)。

注：
1、其中若X=Y、X=Z、或X=Y且Y=Z时函数返回值为1(Yse)。

例1：
BETWEEN(CLOSE,MA5,MA10); //表示收盘价介于5日均线与10日均线之间。
```

### CODELIKE

模糊股票代码函数

```pascal
CODELIKE('') 模糊股票代码函数。

用法：
CODELIKE('600') 判断股票代码是否以600开头。是返回1（YES）,不是返回0（NO）。

注：
1、判断的内容用单引号标注。
2、可与SELECT函数同时使用，进行公式选股对特定种类的股票进行剔除。

例：
C>O&&CODELIKE('300')=0,SELECT;//筛选出最后一根K线为阳线并且代码以300开头的股票（创业版）。
```

### CROSS

交叉函数

```pascal
CROSS(A,B) 表示A从下方向上穿过B，成立返回1(Yes)，否则返回0(No)

注：
1、满足穿越的条件必须上根k线满足A<=B，当根k线满足A>B才被认定为穿越。

例1：
CROSS(CLOSE,MA(CLOSE,5));//表示收盘线从下方向上穿过5周期均线
```

### CROSS2

二次交叉函数

```pascal
CROSS2(A,B,N) 表示N个周期内当A从下方向上穿B偶数次。

注：
1、若N为0，则从第一个有效的值开始算。
2、当N为有效值，但当前的k线数不足N根，或者N空值的情况下，代表不成立，该函数返回0
3、N可以为变量

例1：
MA5:=MA(C,5);
CROSS2(C,MA5,10) 返回值为1(Yes)，表示当前周期是10个周期内(包含当前周期)收盘价从下方向上穿过5周期均线的第偶数次；返回值为0(No)，表示当前周期不是10个周期内(包含当前周期)收盘价从下方向上穿过5周期均线的第偶数次
```

### CROSSDOWN

向下穿越

```pascal
CROSSDOWN(A,B)：表示当A从上方向下穿B，成立返回1(Yes)，否则返回0(No)

注：
1、CROSSDOWN(A,B)等同于CROSS(B,A)，CROSSDOWN(A,B)编写更利于理解

例1：
MA5:=MA(C,5);
MA10:=MA(C,10);
CROSSDOWN(MA5,MA10),SK;//MA5下穿MA10卖开仓
//CROSSDOWN(MA5,MA10),SK;  与  CROSSDOWN(MA5,MA10)=1,SK;表达同等意义
```

### CROSSUP

向上穿越

```pascal
CROSSUP(A,B) 表当A从下方向上穿过B，成立返回1(Yes)，否则返回0(No)

注：
1、CROSSUP(A,B)等同于CROSS(A,B)，CROSSUP(A,B)编写更利于理解。

例1：
MA5:=MA(C,5);
MA10:=MA(C,10);
CROSSUP(MA5,MA10),BK;//MA5上穿MA10，买开仓。
//CROSSUP(MA5,MA10),BK; 与  CROSSUP(MA5,MA10)=1,BK;表达同等意义
```

### DIVERGENCE

变量 X1 与 X2 在指定周期内是否发生背离

```pascal
DIVERGENCE(X1,X2,S,L,HL);变量X1与X2在指定周期内是否发生背离
用法：
S: 设置转折点两边需要的周期数，取值应小于L的四分之一;S不可以为变量；
L: 计算的总的范围的周期数；L不可以为变量。
HL: 可以取值为1和-1
1表示根据X1的峰值判断背离情况；
X1在L周期内波峰取值创了新高，但X2在X1峰值对应的取值没有创新高，熊背离，或称顶背离
-1表示计算波谷点，
X1在L周期内波谷取值创了新低，但X2在X1波谷对应的取值没有创新低，牛背离，或称底背离；

例1：
MA10:MA(C,10);
DIVERGENCE(C,MA10,2,20,1);//在20个周期内，收盘价与10周期均线存在顶背离
说明：收盘价峰值的判断标准--收盘价大于前2个周期的收盘价，并且大于后2个周期的收盘价，认为为收盘价的峰值；
即在当根K线前面的20个周期（不包含当根K线）内，收盘价存在两个这样的峰值，且峰值创了新高，但是在两个峰值对应K线取到的10周期均线的值未创新高
```

### EVERY

判断是否持续满足

```pascal
EVERY(COND,N)，判断N周期内，是否一直满足COND条件。若满足函数返回值为1，不满足函数返回值为0；

注：
1、N包含当前k线。
2、若N是有效数值，但前面没有那么多K线,或者N为空值，代表条件不满足，函数返回值为0。
3、N可以是变量

例1：
EVERY(CLOSE>OPEN,5);//表示5个周期内一直是阳线
例2：
MA5:=MA(C,5);//定义5周期均线
MA10:=MA(C,10);//定义10周期均线
EVERY(MA5>MA10,4),BK;//4个周期内MA5都大于MA10，则买开仓。
//EVERY(MA5>MA10,4),BK;   与   EVERY(MA5>MA10,4)=1,BK;    表达同等意义
```

### EXIST

判断是否存在满足

```pascal
EXIST(COND,N) 判断N个周期内是否有满足COND的条件

注:
1、N包含当前k线。
2、N可以是变量。
3、若N是有效数值，但前面没有那么多K线，按实际周期数计算

例1：
EXIST(CLOSE>REF(HIGH,1),10);表示10个周期中是否存在收盘价大于前一个周期的最高价，存在返回1，不存在则返回0.
例2：
N:=BARSLAST(DATE<>REF(DATE,1))+1;
EXIST(C>MA(C,5),N);// 表示当天是否有满足收盘价大于5周期均线的k线，存在返回1，不存在返回0
```

### FILTER

过滤

```pascal
FILTER(COND,N) 当COND条件成立，将其后N周期内的数据设置为0.

注：
1、N为空值，返回空值。
2、N不能为变量

例1：
FILTER(CLOSE>OPEN,3);// 查找阳线，3天内再次出现的阳线不被记录在内
```

### HASTRADEDATA

判断数据合约当根 K 线交易合约是否有数据

```pascal
HASTRADEDATA  判断数据合约当根K线交易合约是否有数据

用法：
HASTRADEDATA;
1、判断数据合约当根K线交易合约是否有数据，有数据返回1，无数据返回0。
2、若数据合约和交易合约一致返回1
```

### IF

条件函数

```pascal
IF(COND,A,B) 若COND条件成立，则返回A，否则返回B

注：
1、COND是判断条件;A、B可以是条件，也可以是数值。
2、该函数支持变量循环引用前一周期自身变量，即支持下面这样的写法Y: IF(CON,X,REF(Y,1));
例1：
IF(ISUP,H,L);//k线为阳线，取最高价，否则取最低价
例2：
A:=IF(MA5>MA10,CROSS(DIFF,DEA),IF(CROSS(D,K),2,0));//当MA5>MA10时，取是否满足DIFF上穿DEA，否则(MA5不大于MA10)，当K,D死叉时，令A赋值为2，若上述条件都不满足，A赋值为0
A=1,BPK;//当MA5>MA10，以DIFF上穿DEA作为开多仓条件
A=2,SPK;//当MA5不大于MA10，以K、D死叉作为开空仓条件
```

### IFELSE

条件函数

```pascal
IFELSE(COND,A,B) 若COND条件成立，则返回A，否则返回B

注：
1、COND是判断条件;A、B可以是条件，也可以是数值。
2、该函数支持变量循环引用前一周期自身变量，即支持下面这样的写法Y: IFELSE(CON,X,REF(Y,1));
例1：
IFELSE(ISUP,H,L);//k线为阳线，取最高价，否则取最低价
例2：
A:=IFELSE(MA5>MA10,CROSS(DIFF,DEA),IFELSE(CROSS(D,K),2,0));//当MA5>MA10时，取是否满足DIFF上穿DEA，否则(MA5不大于MA10)，当K,D死叉时，令A赋值为2，若上述条件都不满足，A赋值为0
A=1,BPK;//当MA5>MA10，以DIFF上穿DEA作为开多仓条件
A=2,SPK;//当MA5不大于MA10，以K、D死叉作为开空仓条件
```

### ISCONTRACT

当前是否为指定的合约

```pascal
ISCONTRACT() 当前是否为指定的合约。

用法：ISCONTRACT('CODE');是当前合约返回1，不是当前合约返回0。

注：
1、判断是否为指定合约时，CODE可以为合约的交易代码或者文华码
2、判断是否为指定品种时，CODE必须为品种的中文名称（只支持内盘品种）。

例1：
ISCONTRACT('CLZ5');//加载到美原油12上返回值为1，加载到非美原油12上返回值为0。
例2：
ISCONTRACT('沪铜');//加载到沪铜合约上返回值为1，加载到非沪铜合约上返回值为0。
```

### ISDOWN

阴线

```pascal
ISDOWN 判断该周期是否收阴

注：
1、ISDOWN等同于C<O

例：
ISDOWN=1&&C<REF(C,1),SK;//当根k线收阴并且收盘价小于前一周期收盘价，则开空
//ISDOWN=1&&C<REF(C,1),SK; 与 ISDOWN&&C<REF(C,1),SK; 表达同等意义
```

### ISEQUAL

平盘

```pascal
ISEQUAL 判断该周期是否平盘

注：
1、ISEQUAL等同于C=O

例1：
EVERY(ISEQUAL=1,2),CLOSEOUT;//持续2根k线都是平盘，则全平。
```

### ISDELIVERYDAY

判断该周期是不是交割日

```pascal
ISDELIVERYDAY 判断该周期是否是交割日。当前k线是交割日则返回1(Yes)，否则返回0(No)

注：
1、只能使用在日线及小于日线的周期，在周线月线等大于日线的周期使用时返回值始终为0。
2、该函数应加载在可交易合约上，在夜盘仿真合约上返回值为0。
3、该函数加载到主力合约上，把主力切换时间默认为交割时间来进行计算。由于主力的切换时间是无法确定的，该函数在主力合约上只能取到历史的主力切换日期，无法取到最新的主力切换日期。

例1：
ISDELIVERYDAY=1&&TIME>=1000,CLOSEOUT;//当根k线是交割日并且时间是10:00,全平。
```

### ISLASTKLINE

判断该周期是否收盘前最后一根 K 线

```pascal
ISLASTKLINE 判断该周期是否为每日收盘前最后一根k线，返回是1（Yes），否则返回0（No）。

注：
1、对于夜盘合约，夜盘收盘不是当日收盘，15点收盘才算作当日收盘。
2、夜盘合约只显示白盘数据时，白盘收盘前最后一根K线ISLASTKLINE返回1；只显示夜盘数据时，夜盘收盘前最后一根K线ISLASTKLINE返回1。

例1：
ISLASTKLINE=1,CLOSEOUT;//若该周期是当日收盘前最后一根k线，则全平。
```

### ISLASTBAR

判断该周期是否为最后一根 K 线

```pascal
ISLASTBAR 判断该周期是否为最后一根k线

例1：
VALUEWHEN(ISLASTBAR=1,REF(H,1));//当前k线是最后一根k线，则取前一周期的最高价。
```

### ISMAINCONTRACT

当前是否为主力合约

```pascal
ISMAINCONTRACT 当前是否为主力合约。

用法：
ISMAINCONTRACT;取当前交易合约判断是否是主力合约，是返回1，否返回0

注：
1、若交易合约不是普通合约则返回空值
2、若没有指定交易合约，则取数据合约。

例：
ISMAINCONTRACT;//当前的交易合约为主力合约，返回1，否则返回0
```

### ISMONTHEND

是否为本月最后一个交易日

```pascal
ISMONTHEND 是否为本月最后一个交易日
此函数为系统封装函数。

用法：
ISMONTHEND 是否为本月最后一个交易日

例：
CLOSE<MA(CLOSE,5) || ISMONTHEND,SP;//如果满足平仓条件或者当前为本月最后一个交易日，平仓
```

### ISNEARHOLIDAY

判断下一交易日是否是交易合约的节假日

```pascal
ISNEARHOLIDAY 判断下一交易日是否是交易合约的节假日。交易合约下一交易日是节假日，当前k线返回1（Yes）,否则返回0（N0）

注：
1、该函数不支持在外盘上使用
2、该函数依据交易合约判断。

例：
ISNEARHOLIDAY=1&&TIME>=1000,CLOSEOUT;//下一个交易日是节假日并且时间是10:00,全平。
```

### ISNULL

判断空值

```pascal
ISNULL 判断空值

用法：ISNULL(N);如果N为空值，函数返回1；如果N为非空值，函数返回0。

例：MA5:IFELSE(ISNULL(MA(C,5))=1,C,MA(C,5));//定义五周期均线，K线数量不足五根时，返回当根K线的收盘价
```

### ISTIMETOKLINEEND

判断当前 K 线时间是否满足 K 线走完前 N 秒

```pascal
ISTIMETOKLINEEND(N) 判断当前K线时间是否满足K线走完前N秒。

用法：
ISTIMETOKLINEEND(N) 判断当前K线时间是否满足K线走完前N秒,满足返回1，不满足返回0。
参数N为秒数。

注：
1、仅支持在日线及日线以下周期使用。
2、参数N不支持设置为参数或者变量。

例：
C>O&&ISTIMETOKLINEEND(5),BK;//当前K线为阳线并且满足K线走完前5秒，买开
C<O&&ISTIMETOKLINEEND(5),SP;//当前K线为阴线并且满足K线走完前5秒，卖平
AUTOFILTER;
MULTSIG(0,0,3,0);
```

### ISUP

阳线

```pascal
ISUP 判断该周期是否收阳

注：
1、ISUP等同于C>O

例：
ISUP=1&&C>REF(C,1),BK;//若当根k线收阳并且收盘价大于前一周期收盘价，则开多
//ISUP=1&&C>REF(C,1),BK; 与 ISUP&&C>REF(C,1),BK;//表达同等意义
```

### ISWEEKEND

是否为本周最后一个交易日

```pascal
ISWEEKEND 判断是否为本周最后一个交易日
此函数为系统封装函数。

用法：
ISWEEKEND 判断是否为本周最后一个交易日

例：
C<MA(C,5) || ISWEEKEND,SP;//如果满足平仓条件或者当前为本周最后一个交易日，平仓
```

### KLINESTART

判断 K 线当前状态是否是 K 线开始

```pascal
KLINESTART 判断K线当前状态是否是K线开始。

用法：
1、KLINESTART 当前K线状态为K线的开始，则返回1，否则返回0。
2、加载运行过程中，当根K线接收到第一笔数据时，判断当根K线开始；历史信号计算中该函数返回值为0。

例：
C>REF(C,1)&&KLINESTART=0,BPK;//价格大于前一周期收盘价做多，K线开始的第一笔数据不交易
C<REF(C,1)&&KLINESTART=0,SPK;//价格小于前一周期收盘价做空，K线开始的第一笔数据不交易
MULTSIG(0,0,1,0);
AUTOFILTER;
```

### K_STATE

判断 k 线形态

```pascal
K_STATE 判断k线形态

用法：
K_STATE('STATE');STATE为代表k线形态的字符串。加载到k线图后，符合该k线形态，返回1，否则返回0。

例：
K_STATE('红三兵');//判断当前k线形态是否为红三兵

该函数在k线形态源码中无参数的情况下进行判断是否满足
'STATE'可以为
'红三兵'
'跳高上扬'
'并排阳线'
'十字线'
'多方炮'
'空方炮'
'叠叠多方炮'
'叠叠空方炮'
'光头阳线'
'光头阴线'
'看跌提腰带线'
'看跌吞没线'
'看涨提腰带线'
'看涨吞没线'
'三只乌鸦'
'双飞乌鸦'
'向上跳空缺口'
'上涨分离线'
'下跌分离线'
'上涨汇合线'
'下跌汇合线'
'跳空上涨卷轴线'
'跳空下跌卷轴线'
'跳空并排阳线'
'跳空并排阴阳线'
'乌云盖顶'
'阳后双阴阳'
'阴后双阳阴'
'孕线'
```

### K_STATE1

判断 k 线形态

```pascal
K_STATE1 判断k线形态

用法：
K_STATE1(N1,'STATE');N1为k线形态源码中的参数；STATE为代表k线形态的字符串。加载到k线图后，当前k线符合该k线形态，返回1，否则返回0。

例：
K_STATE1(3,'上升三法');//上升三法为股价持续上涨中，某日出现一根大阳线，隔日后连续出现三根小阴线，被视为另一波上涨的信号。N1:=3为上升三法源码中的参数，可以根据需要自行调整。该函数为判断当前k线是否满足上升三法形态。

该函数在k线形态源码中只有一个参数的情况下进行判断是否满足
'STATE'可以为
'上升三法'：参数N1表示实体大小比例，N1=3即实体比例为3%
'下降三法'：参数N1表示实体大小比例，N1=3即实体比例为3%
'曙光初现'：参数N1表示实体大小比例，N1=3即实体比例为3%
'平底'：参数N1表示2根K线最低价的变化幅度，N1=1即变化幅度为1%
'平顶'：参数N1表示两根K线最高价的误差比例，误差百分比由品种决定，N1=1即为1%
'双飞燕'：参数N1表示两根K线成交量误差比例，误差百分比由品种决定，N1=1即为1%
'上档盘旋'：参数N1表示整理期间最高收盘价的上涨最大限度，N1=3即上涨最大限度为3%
'V形反转'：参数N1表示连续N根K线保持一个趋势
'倒V形反转'：参数N1表示连续N根K线保持一个趋势
'T形线（蜻蜓）'：参数N1表示下影线的百分比，N1=1即下影线占比1%
'长上影线'：参数N1表示上影线占K线全长的比例，N1=667即上影线占k线全长的667/1000
'长下影线'：参数N1表示下影线占K线全长的比例，N1=667即下影线占k线全长的667/1000
'倒锤线'：参数N1表示(MAX(O,C)-L)的倍数
'射击之星'：参数N1表示(MAX(O,C)-L)的倍数
'吊颈线'：参数N1表示(H-MIN(O,C))的倍数
```

### K_STATE2

判断 k 线形态

```pascal
K_STATE2 判断k线形态

用法：
K_STATE2(N1,N2,'STATE');N1,N2为k线形态源码中的参数；STATE为代表k线形态的字符串。加载到k线图后，符合该k线形态，返回1，否则返回0。

例：
K_STATE2(3,5,'早晨之星');//早晨之星为启示后市见底回升的阴阳烛组合形态，3和5分别为早晨之星源码中的两个默认参数，可以根据需要自行调整。该函数为判断当前k线是否满足早晨之星形态。

该函数在k线形态源码中有两个参数的情况下进行判断是否满足
'STATE'可以为
'早晨之星'：参数N1为两侧K线K线实体比例，参数N2为星线涨跌幅。N1=3即收盘价相当于开盘价上涨或下跌3%，N2=5即星线涨跌幅为5%
'黄昏之星'：参数N1为两侧K线K线实体比例，参数N2为星线涨跌幅。N1=5即收盘价相当于开盘价上涨或下跌5%，N2=3即星线涨跌幅为3%
'大阳线'：参数N1为K线实体比例，参数N2为高低价比值与收开价比值的差值上线。N1=5即收盘价相当于开盘价上涨或下跌5%，N2=18即高低价比值 与收开价比值的差值上线18/1000
'大阴线':参数N1为K线实体比例，参数N2为高低价比值与收开价比值的差值上线。N1=5即收盘价相当于开盘价上涨或下跌5%，N2=18即高低价比值与收开价比值的差值上线18/1000
```

### K_STATE3

判断 k 线形态

```pascal
K_STATE3 判断k线形态

用法：
K_STATE3(N1,N2,,N3'STATE');N1,N2,N3为k线形态源码中的参数；STATE为代表k线形态的字符串。加载到k线图后，符合该k线形态，返回1，否则返回0。

例：
K_STATE3(5,10,20,'出水芙蓉');//一根大阳线上穿三条均线，均线为多头排列称为出水芙蓉。5,10,20分别为出水芙蓉源码中的三个默认参数，可以根据需要自行调整。该函数为判断当前k线是否满足出水芙蓉形态

该函数在k线形态源码中有三个参数的情况下进行判断是否满足
'STATE'可以为
'出水芙蓉'：参数N1、N2、N3为三条均线周期
'东方红大阳升'：参数N1、N2、N3为三条均线周期
'断头铡刀'：参数N1、N2、N3为三条均线周期
'金蜘蛛'：参数N1、N2、N3为三条均线周期
'死蜘蛛'：参数N1、N2、N3为三条均线周期
```

### K_STATE4

判断 k 线形态

```pascal
K_STATE4 判断k线形态

用法：
K_STATE4(N1,N2,,N3,,N4,'STATE');N1,N2,N3,N4为k线形态源码中的参数；STATE为代表k线形态的字符串。加载到k线图后，符合该k线形态，返回1，否则返回0。

例：
K_STATE4(5,5,10,20,'九阴白骨爪')：参数N1为连续N根K线满足阴线，参数N2、N3、N4为三条均线的周期
```

### LAST

判断函数

```pascal
LAST(COND,N1,N2) 判断过去N1到N2周期内，是否一直满足COND条件。

注：
1、若N1与N2只相差一个周期（如N1=3，N2=2），则函数判断距离当前K线最近的那个周期上是否满足条件（即判断过去N2个周期的那根K线上是否满足条件）
2、当N1/N2为有效值，但当前的k线数不足N1/N2根，或者N1/N2空值的情况下，代表不成立，该函数返回0
3、N1、N2不可以是变量。

例1：
LAST(CLOSE>OPEN,10,5);//表示从过去第10个周期到第5个周期内一直是阳线
例2：
MA5:=MA(C,5);
LAST(C>MA5,4,3);//判断距离当前k线3个周期的那根k线上是否满足C大于MA5.
```

### LONGCROSS

维持交叉函数

```pascal
LONGCROSS(A,B,N) 表示A在N个周期内都小于B，本周期A从下向上穿越B

注：
1、当N为有效值，但当前的k线数不足N根时，LONGCROSS函数返回空值
2、N不支持变量。

例1：
LONGCROSS(CLOSE,MA(CLOSE,10),20);//表示收盘线在10日均线之下持续20周期后从下向上穿过10日均线
```

### NAMELIKE

模糊股票名称函数

```pascal
NAMELIKE('') 模糊股票名称函数。

用法：
NAMELIKE('ST') 判断股票名称是否以ST开头。是返回1（YES）,不是返回0（NO）。

注：
1、判断的内容用单引号标注。
2、可与SELECT函数同时使用，进行公式选股对特定种类的股票进行剔除。

例：
C>O&&NAMELIKE('ST')=0,SELECT;//筛选出最后一根K线为阳线并且名称不是以ST开头的股票。
```

### NOT

非

```pascal
NOT(X)：取非。当X＝0时返回1，否则返回0。
例1：
 NOT(ISLASTBK);如果上一个信号不是BK信号，则NOT(ISLASTBK)返回值为1；上一个信号是BK信号，则NOT(ISLASTBK)返回值为0。
例2：
NOT(BARSBK>=1)=1;//BK信号发出的当根K线上满足条件。
//NOT(BARSBK>=1)=1 与 NOT(BARSBK>=1) 表达同等意义。
```

### NULL

返回空值

```pascal
返回空值
用法：
MA5:=MA(C,5);
MA10:=MA(C,10);
A:IFELSE(MA5>MA10,MA5,NULL),COLORRED;//当MA5>MA10时，画五日均线MA5，不满足MA5>MA10时，返回空值，不画线。
```

### STKTYPE

取市场类型

```pascal
STKTYPE 取市场类型。

注：
1、STKTYPE取当前交易合约的市场类型。
2、返回值1为国内股票、6为外汇、7为国内期货、5为其它。

例：
A:STKTYPE;//加载到期货合约上，A返回值为7。
```

### TREND

获取 K 线趋势

```pascal
TREND 获取K线趋势。

用法：
TREND  K线的形成过程中最高价先出现，则返回值为3；最低价先出现，则返回值为2；若最高和最低一起出现，则返回值为1；默认为0。
```

### VALUEWHEN

取值

```pascal
VALUEWHEN(COND,X) 当COND条件成立时，取X的当前值。如COND条件不成立，则取上一次COND条件成立时X的值。

注：
X可以是数值也可以是条件。

例1
VALUEWHEN(HIGH>REF(HHV(HIGH,5),1),HIGH);表示当前最高价大于前五个周期最高价的最大值时返回当前最高价
例2：
VALUEWHEN(DATE<>REF(DATE,1),O);表示取当天第一根k线的开盘价（即当天开盘价）
例3：
VALUEWHEN(DATE<>REF(DATE,1),L>REF(H,1));//表示在当天第一根k线上判断当前最低价是否大于昨天最后一根K线的最高价。返回1，说明当天跳空高开。返回0，说明当天不满足跳空高开条件。
```

## 循环执行函数

### LOOP1

循环统计函数

```pascal
LOOP1(X,N,TYPE);循环统计函数 对X在N个周期进行TYPE相应的操作

注：
TYPE取值：
MAX_VALUE 最大值；
MIN_VALUE 最小值；
MAX_POS 最大值位置；
MIN_POS 最小值位置；
MAX1_VALUE 最大值（不包括自身周期）；
MIN1_VALUE 最小值（不包括自身周期）；
MAX1_POS 最大值位置(不包括自身周期)；
MIN1_POS 最小值位置（不包括自身周期）；
SECONDMAX_VALUE 次大值；
SECONDMIN_VALUE 次小值；
SECONDMAX_POS 次大值位置；
SECONDMIN_POS 次小值位置；
SECONDMAX1_VALUE 次大值（不包括自身周期）；
SECONDMIN1_VALUE 次小值（不包括自身周期）；
SECONDMAX1_POS 次大值位置（不包括自身周期）；
SECONDMIN1_POS 次小值位置（不包括自身周期）；
TIMES 满足表达式的次数；
ADD 加和；
AVERAGE 均值。

例1：
HH:VALUEWHEN(CROSS(C,MA(C,5)),H);//取收盘价上穿五周期均线时的最高价
HH1:LOOP1(HH,50,SECONDMAX_VALUE);//50周期内收盘价上穿均线时的最高价的次高值
含义说明：
1、取包含当根K线内的50根K线内的收盘价上穿均线时的最高价
2、对最高价从大到小进行排序
3、当根K线的HH1返回值为排序中第二大的值

注：如果50个周期最高值为唯一值，即50个周期的HH取值相同，则最高值与次高值相等，HH1返回对应的HH值

例2：
HH1:LOOP1(H,10,SECONDMAX1_POS);
说明：不包含当根K线的前面10根K线的最高价中第二大的取值对应K线，距离当前K线的位置

例3：
POS1:LOOP1(H,30,SECONDMAX1_POS);
POS2:LOOP1(H,30,MAX1_POS);
POS1<POS2&&REF(VOL,POS1)<REF(VOL,POS2)&&C<LV(L,30)&&VOL>REF(VOL,1),SK;
说明：
30周期内次高点的位置比最高点的位置靠近当前位置，并且次高点的成交量比最高点的成交量低，当前价格跌破了30周期内的最低点并且成交量增加，M头形成反转形态，做空入场。

替代编写方法说明：
LOOP1(X,N,MAX_VALUE)=HHV(X,N)
LOOP1(X,N,MIN_VALUE)=LLV(X,N)
LOOP1(X,N, MAX_POS)=HHVBARS(X,N)
LOOP1(X,N, MIN_POS)=LLVBARS(X,N)
LOOP1(X,N, MAX1_VALUE)=HV(X,N)
LOOP1(X,N, MIN1_VALUE)=LV(X,N)
LOOP1(X,N, TIMES)=COUNT(X,N)
LOOP1(X,N, ADD)=SUM(X,N)
LOOP1(X,N, AVERAGE)=MA(X,N)
```

### LOOP2

循环条件函数

```pascal
LOOP2(COND,A,B);循环条件函数 若COND条件成立，则返回A，否则返回B

注：
1、COND是判断条件;A、B可以是条件，也可以是数值。
2、该函数支持变量循环引用前一周期自身变量，即支持下面这样的写法Y: LOOP2(CON,X,REF(Y,1));

例1：
X:  LOOP2(ISUP,H,REF(X,1));//k线为阳线，取当根K线的最高价，否则取上一次是阳线的K线的最高价;若之前未出现过阳线时，X返回为空值

例2：
BB:LOOP2(BARSBK=1,LOOP2(L>LV(L,4),L,LV(L,4)),LOOP2(L>REF(BB,1),L,REF(BB,1)));//持有多单时，开多单那根的前面4个周期内的最低价为起始止损点BB，后续K线最低价比前一个最低价高，取当前最低价为止损点，否则取前一个低点为止损点，
SS:LOOP2(BARSSK=1,LOOP2(H<HV(H,4),H,HV(H,4)),LOOP2(H<REF(SS,1),H,REF(SS,1)));//持有空单时，开空单那根的前面4个周期内的最高价为起始止损点SS，最高价比前一个最高价低，取当前最高价为止损点，否则取前一个高点为止损点
H>HV(H,20),BK;
L<LV(L,20),SK;
C<BB,SP;
C>SS,BP;
AUTOFILTER;
```

## 时间函数

### BARPOS

取 K 线的位置

```pascal
BARPOS，返回从第一根K线开始到当前的周期数。

注：
1、BARPOS返回本地已有的K线根数，从本机上存在的数据开始算起。
2、本机已有的第一根K线上返回值为1。

例1：LLV(L,BARPOS);//求本地已有数据的最小值。

例2：IFELSE(BARPOS=1,H,0);//当前K线是本机已有的第一根K线取最高值，否则取0。
```

### CLOSEMINUTE

距收盘前时间

```pascal
CLOSEMINUTE，返回K线开始时间距离收盘前的分钟数。

注：
1、该函数只能用于收盘价模型。
2、该函数返回当根K线开始时间距离收盘的分钟数。
3、该函数需要在分钟，小时周期使用；不支持在TICK周期，秒周期，量能周期，日线及以上周期使用。
4、该函数的返回值包含小结和午休的时间。
5、CLOSEMINUTE返回的是交易所的时间，不是本机的时间。
6、对于夜盘合约，夜盘收盘不是当日收盘，15点收盘才算作当日收盘。
7、CLOSEMINUTE在合约交割日，返回实际收盘时间。
8、CLOSEMINUTE加载到主力合约上，主力换月和合约交割在同一天，则按照交割日的收盘时间计算，主力换月和合约交割不在同一天，那么按照正常的非交割日进行计算。
9、该函数不支持和CLOSESEC同时使用。

例：
CROSS(C,MA(C,5))&&CLOSEMINUTE>5,BK;//五分钟周期上，收盘价上穿五周期均线，开仓，当天最后一根K线不交易
CLOSEMINUTE<=5,SP;//五分钟周期上，最后一根K线尾盘平仓
CLOSEKLINE(1,10);//收盘前最后一根K线提前10秒判断K线走完
AUTOFILTER;
```

### CLOSEMINUTE1

距收盘前时间

```pascal
CLOSEMINUTE1，返回距离收盘前的分钟数。

注：
1、该函数只能用于指令价模型。
2、
历史K线：该函数返回K线结束时间距离收盘的分钟数。
盘中：该函数返回K线当前时间距离收盘的分钟数。
3、该函数需要在分钟，小时，日线周期使用；不支持在TICK周期，秒周期，量能周期，周线及以上周期使用。
4、该函数返回值包含小结和午休的时间。
5、CLOSEMINUTE1返回的是交易所的时间，不是本机的时间。
6、对于夜盘合约，夜盘收盘不是当日收盘，15点收盘才算作当日收盘。
7、CLOSEMINUTE1在合约交割日，返回实际收盘时间。
8、CLOSEMINUTE1加载到主力合约上，主力换月和合约交割在同一天，则按照交割日的收盘时间计算，主力换月和合约交割不在同一天，那么按照正常的非交割日进行计算。
9、该函数不支持和CLOSESEC1同时使用。
10、CLOSEMINUTE1与逐分钟回测函数CHECKSIG_MIN 、MULTSIG_MIN、PANZHONG_MIN连用，想实现日内闭式前及时平仓，CLOSEMINUTE1的参数取值需大于1，即CLOSEMINUTE1需<=大于1 的值。

例：
CROSS(C,MA(C,5)),BK;//最新价上穿五周期均线，买开
MULTSIG(0,0,1,0);//使用TICK数据回测，出信号立即下单，不复核
CLOSEMINUTE1<=1,CLOSEOUT;//收盘前1分钟，清仓
AUTOFILTER;
```

### CLOSEMINUTEEVERY

距小节结束时间

```pascal
CLOSEMINUTEEVERY(N)，返回K线开始时间距离小节结束的分钟数。

用法：
CLOSEMINUTEEVERY(N),返回K线开始时间距离第N个小节结束的分钟数。N为参数，表示第几个小节（交易时间段）
以沪金合约为例。N=1,第一小节为21：00到次日2点30;N=2，第二小节为上午9:00-10：15；N=3,第三小节为上午10：30到11:30；N=4,第四小节为13:00-15:00

注：
1、该函数只能用于收盘价模型。
2、该函数返回当根K线开始时间距离小节结束的分钟数。
3、该函数需要在分钟，小时周期使用；不支持在TICK周期，秒周期，量能周期，日线及以上周期使用。
4、CLOSEMINUTEEVERY返回的是交易所的时间，不是本机的时间。
5、对于夜盘合约，第一个小节时间指加载合约的夜盘交易时间段
6、该函数不支持和CLOSESECEVERY同时使用。

例：
CROSS(C,MA(C,5)),BK;//五分钟周期上，收盘价上穿五周期均线，开仓
CLOSEMINUTEEVERY(1)<=10,SP;//当前K线开始时间距离第一个小节结束小于等于10分钟时，平仓
AUTOFILTER;
```

### CLOSEMINUTEEVERY1

距小节结束时间

```pascal
CLOSEMINUTEEVERY1(N),返回距离小节结束的分钟数

用法：
CLOSEMINUTEEVERY1(N),返回距离第N个小节结束的分钟数。N为参数，表示第几个小节（交易时间段）
以沪金合约为例。N=1,第一小节为21：00到次日2点30;N=2，第二小节为上午9:00-10：15；N=3,第三小节为上午10：30到11:30；N=4,第四小节为13:00-15:00

注：
1、该函数只能用于指令价模型。
2、
历史K线：该函数返回K线结束时间距离小节结束的分钟数。
盘中：该函数返回K线当前时间距离小节结束的分钟数。
3、该函数需要在分钟，小时，日线周期使用；不支持在TICK周期，秒周期，量能周期，周线及以上周期使用。
4、CLOSEMINUTEEVERY1返回的是交易所的时间，不是本机的时间。
5、对于夜盘合约，第一个小节时间指加载合约的夜盘交易时间段
6、该函数不支持和CLOSESECEVERY1同时使用。
7、CLOSEMINUTEEVERY1与逐分钟回测函数CHECKSIG_MIN 、MULTSIG_MIN、PANZHONG_MIN连用，想实现小节结束前及时平仓，CLOSEMINUTEEVERY1的取值需大于1，即CLOSEMINUTEEVERY1(N)需<=大于1 的值。

例：
CROSS(C,MA(C,5)),BK;//最新价上穿五周期均线，买开
MULTSIG(0,0,1,0);//使用TICK数据回测，出信号立即下单，不复核
CLOSEMINUTEEVERY1(2)<=1,SP;//第二小节结束前平仓
AUTOFILTER;
```

### CLOSESEC

距收盘前时间（秒数）

```pascal
CLOSESEC，返回K线开始时间距离收盘前的秒数。

注：
1、该函数只能用于收盘价模型。
2、该函数返回当根K线开始时间距离收盘的秒数。
3、该函数需要加载到秒周期使用；不支持在TICK周期，量能周期，分钟及以上周期使用。
4、该函数的返回值包含小结和午休的时间。
5、CLOSESEC返回的是交易所的时间，不是本机的时间。
6、对于夜盘合约，夜盘收盘不是当日收盘，15点收盘才算作当日收盘。
7、CLOSESEC在合约交割日，返回实际收盘时间。
8、CLOSESEC加载到主力合约上，主力换月和合约交割在同一天，则按照交割日的收盘时间计算，主力换月和合约交割不在同一天，那么按照正常的非交割日进行计算。
9、该函数不支持和CLOSEMINUTE同时使用。

例：
CROSS(C,MA(C,5))&&CLOSESEC>15,BK;//十五秒周期上，收盘价上穿五周期均线，开仓，当天最后一根K线不交易
CLOSESEC<=15,SP;//15秒周期上，最后一根K线尾盘平仓
CLOSEKLINE(1,5);//收盘前最后一根K线提前5秒判断K线走完
AUTOFILTER;
```

### CLOSESEC1

距收盘前时间（秒数）

```pascal
CLOSESEC1，返回距离收盘前的秒数。

注：
1、该函数只能用于指令价模型。
2、
历史K线：该函数返回K线结束时间距离收盘的秒数。
盘中：该函数返回K线当前时间距离收盘的秒数。
3、该函数不支持在TICK周期，量能周期使用。
4、该函数返回值包含小结和午休的时间。
5、CLOSESEC1返回的是交易所的时间，不是本机的时间。
6、对于夜盘合约，夜盘收盘不是当日收盘，15点收盘才算作当日收盘。
7、CLOSESEC1在合约交割日，返回实际收盘时间。
8、CLOSESEC1加载到主力合约上，主力换月和合约交割在同一天，则按照交割日的收盘时间计算，主力换月和合约交割不在同一天，那么按照正常的非交割日进行计算。
9、该函数不支持和CLOSEMINUTE1同时使用。

例：
CROSS(C,MA(C,5)),BK;//最新价上穿五周期均线，买开
MULTSIG(0,0,1,0);//使用TICK数据回测，出信号立即下单，不复核
CLOSESEC1<=5,CLOSEOUT;//收盘前五秒钟，清仓。
AUTOFILTER;
```

### CLOSESECEVERY

距小节结束时间（秒）

```pascal
CLOSESECEVERY(N) 返回K线开始时间距离小节结束的秒数

用法：
CLOSESECEVERY(N)，返回K线开始时间距离第N个小节结束的秒数。N为参数，表示第几个小节（交易时间段）
以沪金合约为例。N=1,第一小节为21：00到次日2点30;N=2，第二小节为上午9:00-10：15；N=3,第三小节为上午10：30到11:30；N=4,第四小节为13:00-15:00

注：
1、该函数只能用于收盘价模型。
2、该函数返回当根K线开始时间距离小节结束的秒数。
3、该函数需要加载到秒周期使用；不支持在TICK周期，量能周期，分钟及以上周期使用。
4、CLOSESECEVERY返回的是交易所的时间，不是本机的时间。
5、对于夜盘合约，第一个小节时间指加载合约的夜盘交易时间段
6、该函数不支持和CLOSEMINUTEEVERY同时使用。

例：
CROSS(C,MA(C,5)),BK;//十五秒周期上，收盘价上穿五周期均线，开仓
CLOSESECEVERY(1)<=15,SP;//15秒周期上，第一小节结束前平仓
CLOSEKLINE(1,5);//以收盘时间为结束时间的K线提前5秒判断K线走完
AUTOFILTER;
```

### CLOSESECEVERY1

距小节结束时间（秒）

```pascal
CLOSESECEVERY1(N) 返回距离小节结束前的秒数

用法：
CLOSESECEVERY1(N),返回距离第N个小节结束的秒数。N为参数，表示第几个小节（交易时间段）
以沪金合约为例。N=1,第一小节为21：00到次日2点30;N=2，第二小节为上午9:00-10：15；N=3,第三小节为上午10：30到11:30；N=4,第四小节为13:00-15:00

注：
1、该函数只能用于指令价模型。
2、
历史K线：该函数返回K线结束时间距离小节结束的秒数。
盘中：该函数返回K线当前时间距离小节结束的秒数。
3、该函数不支持在TICK周期，量能周期使用。
4、CLOSESECEVERY1返回的是交易所的时间，不是本机的时间。
5、对于夜盘合约，第一个小节时间指加载合约的夜盘交易时间段
6、该函数不支持和CLOSEMINUTEEVERY1同时使用。

例：
CROSS(C,MA(C,5)),BK;//最新价上穿五周期均线，买开
MULTSIG(0,0,1,0);//使用TICK数据回测，出信号立即下单，不复核
CLOSESECEVERY1(1)<=5,CLOSEOUT;//第一小节结束前五秒钟，清仓。
AUTOFILTER;
```

### DATE

取得某周期的日期数

```pascal
DATE,返回某周期的日期数。

注：
1：DATE的取值范围为700101-331231(即1970年1月1日—2033年12月31日)。
2：DATE返回六位数字，YYMMDD，
3：DATE支持上海夜盘的使用，例如：2013年7月8日 21:00夜盘开盘，DATE返回值即为130709，返回的为收盘时对应的日期 ,即数据所属的交易的日期（周五周六晚上的数据返回的日期为下周一的日期）

例1：
BARSLAST(DATE<>REF(DATE,1))+1;//当天开盘以来共有多少根K线。
例2：
AA:DATE=130507&&TIME=1037;
HH:VALUEWHEN(AA=1,H);// 取201305071037分钟位置，同时取201305071037分钟k线位置最高价
```

### DAY

取得某周期的日数

```pascal
DAY,返回某一周期的日数。

注：
DAY取值范围为1-31。

例1：
DAY=3&&TIME=0915，BK;//当日起为3日，时间为9点15分时，买开。
例2：
N:BARSLAST(DATE<>REF(DATE,1))+1;
CC:IFELSE(DAY=1,VALUEWHEN(N=1,O),0);//当日期为1时，取开盘价，否则取值为0.
```

### DAYSTOEXPIRED

期货合约距最后交易日的天数

```pascal
DAYSTOEXPIRED(CODE) 期货合约距最后交易日的天数。

用法：DAYSTOEXPIRED(CODE);取得合约的到期剩余天数。CODE为文华码。

注：
1、该函数返回期货合约距最后交易日的天数，其中包括最后交易日。
2、CODE如果不写的话，写入''默认取当前合约。
3、该函数只能加载在日线及以下周期使用，在日周期以上的周期该函数返回值为0。
4、该函数应加载在可交易合约上，在夜盘仿真合约上返回值为0。
5、该合约加载到主力合约上，把主力切换时间默认为交割时间来进行计算。由于主力的切换时间是无法确定的，该函数在主力合约上只能取到历史的主力切换日期，无法取到最新的主力切换日期。
6、该函数加载在连续合约上，将合约换月日期默认为交割日期来进行计算。

例1：
A:DAYSTOEXPIRED('');//A返回当前加载合约的到期剩余天数。

例2：
A:=DAYSTOEXPIRED('')=1&&CLOSEMINUTE=5;//定义变量A为最后交易日收盘前五分钟。
```

### HOUR

小时

```pascal
HOUR，返回某周期的小时数。

注：
HOUR的取值范围为0—23

例1：
NX:BARSLAST(CROSS(HOUR=9,0.5));
DRAWLINE3(CROSSDOWN(HOUR=14,0.5),REF(H,NX),NX,CROSSDOWN(HOUR=14,0.5),REF(H,1),1,0),COLORGREEN;
//连接9点到收盘前最后一根k线高点的连线。
例2：
HOUR=10;//在10:00的K线上返回值为1，其余K线上返回值为0。
```

### MINUTE

分钟

```pascal
MINUTE,返回某个周期的分钟数。

注：
1：MINUTE的取值范围为0—59
2：该函数只能加载在分钟周期上，返回当根K线开始的分钟数。
例1：
MINUTE=0；//在整点时刻的分钟K线上返回值为1，其余K线返回值为0。
例2：
TIME>1400&&MINUTE=50,SP;//在14:50的时候卖平仓。
```

### MONTH

取月份

```pascal
MONTH，返回某个周期的月份。

注：
MONTH的取值范围为1—12.

例1：
VALUEWHEN(MONTH=3&&DAY=1,C);//在K线日期为三月一日时取其收盘价。
例2：
C>=VALUEWHEN(MONTH<REF(MONTH,1),O),SP;
```

### NEXTDELIVERYDAY

最近交割日期函数

```pascal
NEXTDELIVERYDAY,返回当前品种往后最近的交割日期。

注：
1、该函数只能加载在日周期及日周期以下的周期上，在日周期以上的周期该函数返回值为0。
2、该函数应加载在可交易合约上，在夜盘仿真合约上返回值为0。
3、该合约加载到主连合约上，把主力切换时间默认为交割时间来进行计算。由于主力的切换时间是无法确定的，该函数在主连合约上只能取到历史的主力切换日期，无法取到最新的主力切换日期。

例1：
当NEXTDELIVERYDAY加载在沪铜1309上时，返回值为130923.
例2：
DATE=NEXTDELIVERYDAY&&CLOSEMINUTE=5,CLOSEOUT；//距交割日收盘前五分钟时清仓。
```

### OPENMINUTE

开盘后经过的分钟数

```pascal
OPENMINUTE，返回开盘后经过的分钟数。

注：
1、该函数只能用于收盘价模型。
2、该函数返回开盘时间距离当根K线开始时间的分钟数。
3、该函数需要在分钟，小时周期使用；不支持在TICK周期，秒周期，量能周期，日线及以上周期使用。
4、该函数的返回值包含小结和午休的时间。
5、OPENMINUTE返回的是交易所的时间，不是本机的时间。
6、对于夜盘合约，白盘开盘不是当日开盘，夜盘开盘才算作当日开盘。

例：
CROSS(C,MA(C,5))&&OPENMINUTE>5,BPK;//当天开盘后五分钟内不开仓
CROSS(MA(C,5),C)&&OPENMINUTE>5,SPK;
AUTOFILTER;
```

### OPENMINUTE1

开盘后经过的分钟数

```pascal
OPENMINUTE1，返回开盘后经过的分钟数。

注：
1、该函数只能用于指令价模型。
2、
历史K线：该函数返回K线结束时间距离开盘的分钟数。
盘中：该函数返回K线当前时间距离开盘的分钟数。
3、该函数需要在分钟，小时，日线周期使用；不支持在TICK周期，秒周期，量能周期，周线及以上周期使用。
4、该函数返回值包含小结和午休的时间。
5、OPENMINUTE1返回的是交易所的时间，不是本机的时间。
6、对于夜盘合约，白盘开盘不是当日开盘，夜盘开盘才算作当日开盘。

例：
CROSS(C,MA(C,5))&&OPENMINUTE1>5,BPK;//当天开盘后五分钟内不开仓
CROSS(MA(C,5),C)&&OPENMINUTE1>5,SPK;
MULTSIG(0,0,1,0);//出信号立即下单，不复核
AUTOFILTER;
```

### PERIOD

自动读取当前技术分析图表周期

```pascal
PERIOD，返回当前技术分析图表的周期。

注：
1：该函数支持自定义周期。
2：返回数字为1—11分别表示，1分钟，3分钟，5分钟，10分钟，15分钟，30分钟，1小时，1天，1周，1月，1年。
3：返回数字为12—25分别表示,TICK、量能、5秒、10秒、15秒、30秒、2小时、3小时、4小时、1季、自定义秒、自定义分、自定义小时、自定义日
例:
N:=BARSLAST(DATE<>REF(DATE,1))+1;
OO:VALUEWHEN(N=1,O);
IFELSE(PERIOD=1,OO,NULL);//取当天一分钟周期的开盘价。
```

### QUARTER

取得某周期的季度数

```pascal
QUARTER,返回某周期的季度数。

注：
当前周期的月份为1~3月返回1，4~6月返回2，7~9月返回3，10~12月返回4。

例1：
CROSS(C,MA(C,5))&&QUARTER<3,BK;//在一二季度，最新价上穿5周期均线做多
CROSS(MA(C,5),C)&&QUARTER<3,SP;//在一二季度，最新价下穿5周期均线平多
TRADE_OTHER('AUTO');//交易合约为主力合约
AUTOFILTER;
```

### TIME

取 K 线的时间

```pascal
TIME，取K线时间。

注：
1、该函数在盘中实时返回，在K线走完后返回K线的起始时间。
2、该函数返回的是交易所数据接收时间，也就是交易所时间。
3、TIME函数在秒周期使用时返回六位数的形式，即：HHMMSS，在其他周期上显示为四位数的形式，即：HHMM.
4、TIME函数只能加载在日周期以下的周期中，在日周期及日周期以上的周期中该函数返回值始终为1500。
5、使用TIME函数进行尾盘平仓的操作需要注意
（1）尾盘平仓设置的时间建议设置为K线返回值中实际可以取到的时间（如：螺纹指数 5分钟周期 最后一根K线返回时间为1455，尾盘平仓设置为TIME>=1458,CLOSEOUT;则效果测试中不能出现尾盘平仓的信号）
（2）使用TIME函数作为尾盘平仓的条件的，建议开仓条件也要做相应的时间限制（如设置尾盘平仓条件为TIME>=1458,CLOSEOUT;则相应的开仓条件中需要添加条件TIME<1458；避免平仓后再次开仓的情况）

例1:
C>O&&TIME<1450,BK;
C<O&&TIME<1450,SK;
TIME>=1450,SP;
TIME>=1450,BP;
AUTOFILTER;
//在14:50后平仓。
例2：
ISLASTSK=0&&C>O&&TIME>=0915,SK;
```

### VOLTIME

取 K 线形成的时间（秒）

```pascal
量能周期返回这根K线形成的时间，单位：秒。
用法：
VOLTIME 量能周期时，返回当前K线形成的时间。
```

### VOLTICK

返回 K 线是由多少笔 TICK 生成

```pascal
量能周期返回这根K线形成的TICK笔数，单位：笔。
用法：
VOLTICK 量能周期时，返回当前K线形成的TICK笔数。
```

### WEEKDAY

取得星期数

```pascal
WEEKDAY,取得星期数。

注：
1：WEEKDAY的取值范围是0—6。
2：该函数在周周期上显示的值始终为5，在月周期上返回K线结束当天的星期数。

例1：
N:=BARSLAST(MONTH<>REF(MONTH,1))+1;
COUNT(WEEKDAY=5,N)=3&&TIME>=1450,BP;
COUNT(WEEKDAY=5,N)=3&&TIME>=1450,SP;
AUTOFILTER;//每个月交割日尾盘自动平仓。
例2：
C>VALUEWHEN(WEEKDAY<REF(WEEKDAY,1),O)+10,BK;
AUTOFILTER;
```

### YEAR

年份

```pascal
YEAR，取得年份。

注：
YEAR的取值范围为1970—2033。

例1：
N:=BARSLAST(YEAR<>REF(YEAR,1))+1;
HH:=REF(HHV(H,N),N);
LL:=REF(LLV(L,N),N);
OO:=REF(VALUEWHEN(N=1,O),N);
CC:=REF(C,N);//取上一年的最高价，最低价，开盘价，收盘价。
例2：
NN:=IFELSE(YEAR>=2000 AND MONTH>=1,0,1);
```

## 绘图函数

### ALIGN

设置文字对齐方式（左中右）

```pascal
设置文字对齐方式（左中右）。

用法：DRAWTEXT(COND,PRICE,TEXT),ALIGNX;

COND条件满足时，在PRICE的位置，标注TEXT，文字按照ALIGNX写入的方式对齐。ALIGN0，ALIGN1，ALIGN2，分别表示左对齐，居中对齐，右对齐。

例：
DRAWTEXT(C>O,H,'涨'),ALIGN1,VALIGN1,FONTSIZE20,COLORGREEN;//在阳线的最高价标注文字“涨”，文字居中对齐，字体大小为20，颜色为绿色。
```

### BACKGROUNDSTYLE

背景的样式

```pascal
BACKGROUNDSTYLE函数    设置背景的样式。

用法：
BACKGROUNDSTYLE(i)设置背景的样式。
i = 0 或1或2。

注：
1.
0 是保持本身坐标不变。
1 是将坐标固定在0到100之间。
2 是将坐标以0为中轴的坐标系。
2、参数i的选择根据想要显示的指标数据范围而定。
3、不支持将该函数直接定义为变量，即不支持下面的写法：A:BACKGROUNDSTYLE(i);

例1：
MA5:MA(C,5);
MA10:MA(C,10);
BACKGROUNDSTYLE(0);
例2：
DIFF : EMA(CLOSE,12) - EMA(CLOSE,26);
DEA  : EMA(DIFF,9);
2*(DIFF-DEA),COLORSTICK;
BACKGROUNDSTYLE(2)
```

### CIRCLEDOT

小圆点线

```pascal
画小圆点线。
用法：
CIRCLEDOT 画小圆点线。

注：
1、该函数支持设置颜色。
2、不支持将函数定义为变量，即不支持下面的写法：A:CIRCLEDOT；

例：MA5:MA(C,5),CIRCLEDOT,COLORCYAN;//用小圆点线画5周期均线，圆点线显示为青色。
```

### COLORSTICK

画柱线

```pascal
COLORSTICK 画柱线。

用法：X,COLORSTICK;画柱线，柱高为X的值，X大于0为红色柱线，X小于0为青色柱线。

注：不支持将该函数定义为变量，即不支持下面的写法：A:COLORSTICK；

例：
C-O,COLORSTICK;//画柱线，阳线时画红色向上柱线，阴线时画青色的向下柱线。
```

### CROSSDOT

小圆圈线

```pascal
小圆圈线。
用法：
CROSSDOT 画小圆圈线。

注：
1、该函数支持设置颜色。
2、不支持将函数定义为变量，即不支持下面的写法：A:CROSSDOT；

例：MA5:MA(C,5),CROSSDOT,COLORCYAN;//用小圆圈线画5周期均线，圆圈线显示为青色。
```

### DASH

画虚线

```pascal
画虚线。
用法：
DASH 画虚线。

注：
1、该函数支持设置颜色。
2、不支持将函数定义为变量，即不支持下面的写法：A:DASH；

例：MA5:MA(C,5),DASH,COLORCYAN;//用虚线画5周期均线，显示为青色。
```

### DASHDOT

画点虚线

```pascal
画点虚线。
用法：
DASHDOT 画点虚线。

注：
1、该函数支持设置颜色。
2、不支持将函数定义为变量，即不支持下面的写法：A:DASHDOT；

例：MA5:MA(C,5),DASHDOT,COLORCYAN;//用点虚线画5周期均线，显示为青色。
```

### DASHDOTDOT

画双点虚线

```pascal
画双点虚线。
用法：
DASHDOTDOT 画双点虚线。

注：
1、该函数支持设置颜色。
2、不支持将函数定义为变量，即不支持下面的写法：A:DASHDOTDOT；

例：MA5:MA(C,5),DASHDOTDOT,COLORCYAN;//用双点虚线画5周期均线，显示为青色。
```

### DOT

画点线

```pascal
画点线。
用法：
DOT 画点线。
注：
不支持将该函数直接定义为变量，即不支持下面的写法：A:DOT;
例：MA5:MA(C,5),DOT;用点线画5日均线。
```

### DRAWBARLINE

绘制 BAR 线（美国线）

```pascal
DRAWBARLINE(H1,O1,L1,C1);绘制BAR线（美国线）
用法：
在L1到H1之间绘制柱线，在O1位置绘制左侧横线，在C1位置绘制右侧横线。
注：
不支持将该函数直接定义为变量，即不支持下面的写法：
A:DRAWBARLINE(H1,O1,L1,C1);

例：
DRAWBARLINE(H,O,L,C); //在最高价和最低价之间绘制BAR线，在开盘价位置绘制左侧横线，在收盘价位置绘制右侧横线。
```

### DRAWBKBMP

设置背景图片

```pascal
DRAWBKBMP(COND,IMAGE) 设置背景图片。

用法：
DRAWBKBMP(COND,IMAGE);
当最后一根K线满足COND条件时，将图片IMAGE设置为背景。

注：
1、IMAGE指定的图片必须位于程序安装目录的Formula\Image目录下(Image文件夹需要用户自己建立)
2、图片格式必须为.BMP格式。
3、不支持将函数定义为变量，即不支持下面的写法：
A:DRAWBKBMP(COND,IMAGE);

例1：
DRAWBKBMP(CLOSE>OPEN,'壁纸20140410112435');//当最后一根K线为阳线时，将Formula\Image目录下的壁纸20140410112435图片设置为背景。
```

### DRAWBMP

输出图片

```pascal
输出图片。

用法：
DRAWBMP(COND,DATA,IMAGE);
当满足COND条件时，在DATA位置，输出图片IMAGE。

注：
1、IMAGE指定的图片必须位于程序安装目录的Formula\Image目录下(Image文件夹需要用户自己建立)
2、图片格式必须为.BMP格式
3、图片路径同时支持写.BMP后缀和不写后缀两种形式
4、不支持将函数定义为变量，即不支持下面的写法：
A:DRAWBMP(COND,DATA,IMAGE);
5、输出的图片不能过大，否则会影响显示速度。

例1：
DRAWBMP(CLOSE>OPEN,H,'壁纸20140410112435.BMP');//当K线为阳线时，在K线最高价位置显示Formula\Image目录下的壁纸20140410112435图片。
```

### DRAWCOLORLINE

根据条件画相应颜色的线

```pascal
DRAWCOLORLINE（COND,DATA,COLOR1,COLOR2）;根据条件画相应颜色的线
用法：当满足COND时，DATA为COLOR1颜色的线，不满足COND时，DATA为COLOR2颜色的线
注：
1、不支持将该函数直接定义为变量，即不支持下面的写法：
A:DRAWCOLORLINE（COND,DATA,COLOR1,COLOR2）;
2、该函数支持在函数后设置线型（LINETHICK1 - LINETHICK7、POINTDOT、DOT），即支持下面的写法：
DRAWCOLORLINE(COND,DATA,COLOR1,COLOR2),LINETHICK;

例1：
MA1:=MA(C,5);
DRAWCOLORLINE(MA1>REF(MA1,1),MA1,COLORRED,COLORGREEN); //如果当根5日均线的值大于前一根5日均线的值，MA1画红线，否则画绿线
```

### DRAWCOLORKLINE

绘制 K 线

```pascal
DRAWCOLORKLINE 绘制K线

用法：
DRAWCOLORKLINE(Cond,Color,Empty);
满足Cond条件时，按照Color颜色绘制K线，根据Empty标志判断是空心还是实心。COLOR代表颜色，Empty非0为空心。

注：
不支持将该函数定义为变量，即不支持下面的写法：
A:DRAWCOLORKLINE(Cond,Color,Empty);

例：
DRAWCOLORKLINE(C>O,COLORBLUE,0);//收盘价大于开盘价，用蓝色绘制实心K线
```

### DRAWCOLUMNCHART

画双向柱形图

```pascal
DRAWCOLUMNCHART 画柱形图。

用法：
DRAWCOLUMNCHART(X,C1,C2);
X表示柱高，C1条件满足时从0轴向上画柱，不满足时从0轴向下画柱，C2条件满足时柱为红色，不满足时柱为青色

注：
1、C1、C2是判断条件。
2、不支持将该函数定义为变量，即不支持下面的写法：
A:DRAWCOLUMNCHART(X,C1,C2);
3、该函数画图为独立坐标显示，0轴为画面中央。
例1：
DRAWCOLUMNCHART(10,C>O,C>O);//满足收阳条件从0轴向上10个高度画红色柱，不满足条件从0轴向下10个高度画青色柱。
```

### DRAWGBK

设置渐变背景色

```pascal
DRAWGBK(COND,C1,C2,D) 设置渐变背景色。

用法：
DRAWGBK(COND,C1,C2,D);
当最后一根K线满足COND条件时，以C1至C2的渐变色填充背景。

注：
1、C1,C2可以用颜色函数定义，即可以支持下面的写法：
DRAWGBK(CLOSE>0,COLORRED,COLORGREEN,0);//用户可以在插入-插入颜色中选择
2、C1，C2也支持直接使用自定义颜色，即支持下面的写法：
DRAWGBK(CLOSE>0,RGB(0,255,255),RGB(128,128,255),0);//用户可以在插入-插入颜色中选择
3、D指定渐变方向，0表示从左到右，1表示从上到下。
4、不支持将函数定义为变量，即不支持下面的写法：
A:DRAWGBK(COND,C1,C2,D);

例1：
DRAWGBK(CLOSE>OPEN,COLORRED,COLORGREEN,1);//当最后一根K线为阳线时，将背景设置为从上到下，红色到绿色的渐变。
```

### DRAWGBK1

设置满足条件 K 线的背景颜色

```pascal
DRAWGBK1(COND,COLOR) 设置满足条件K线的背景颜色。

用法：
DRAWGBK1(COND,COLOR);
当条件COND成立时，以K线宽度、COLOR颜色填充背景区域，高度为整个显示区域的最高到最低。

注：
1、COLOR可以用颜色函数定义，即可以支持下面的写法：
DRAWGBK1(C>O,COLORRED);//用户可以在颜色中选择
2、COLOR也支持直接使用自定义颜色，即支持下面的写法：
DRAWGBK1(C>O,RGB(252,209,218));//用户可以在颜色中选择

例1：
MA5:=MA(C,5);
DRAWGBK1(C>MA5,COLORRED);//表示在收盘价大于5周期均线的k线对应背景颜色设置为红色。
```

### DRAWICON

画图标

```pascal
DRAWICON：绘制小图标。

用法：
DRAWICON(COND,PRICE,ICON);
当COND条件满足时,在PRICE位置画图标ICON。

注：
1、该函数可以指定位置PRICE标注图标ICON
2、ICON位置可以写成'ICON'的形式，也可以写为数字的形式，即DRAWICON(COND,PRICE,'ICON1');等价于DRAWICON(COND,PRICE,1);
3、该函数可以用ALIGN，VALIGN设置图标的对齐方式。
4、不支持将该函数定义为变量，即不支持下面的写法：
A:DRAWICON(COND,PRICE,ICON);

例1：
DRAWICON(CLOSE<OPEN,LOW,'ICO1'),ALIGN2,VALIGN2;//在阴线的最低价上画出图标ICON1。图标右下对齐。
写完“DRAWICON(CLOSE<OPEN,LOW,” 以后，点击插入图标按钮，再单击选中的图标插入到函数中，图标用'ICO1'~'ICO105'（或1~105）表示。

例2：
MA5:=MA(C,5);
DRAWICON(C>MA5,MA5,2),ALIGN0,VALIGN0;//表示在收盘价大于5周期均线的k线对应的MA5数值位置上画出图标ICON2，图标左上对齐。
写完“DRAWICON(C>MA5,MA5,” 以后，点击插入图标按钮，再单击选中的图标插入到函数中，图标用ICO1~ICO105（或1~105）表示。
```

### DRAWKLINE

画 K 线

```pascal
DRAWKLINE 自定义K线颜色，实空心及宽度。

用法：
DRAWKLINE(WidthRatio,COLOR1,EMPTY1,COLOR2,EMPTY2);
按照宽度比例WidthRatio画线，阳线以COLOR1和EMPTY1判断，阴线以COLOR2和EMPTY2判断。WidthRadio从0到1，COLOR1、COLOR2代表颜色，Empty非0为空心。

注：
1、不支持将该函数定义为变量，即不支持下面的写法：
A:DRAWKLINE(WidthRatio,COLOR1,EMPTY1,COLOR2,EMPTY2);

例1：
DRAWKLINE(0.75,COLORRED,1,COLORCYAN,0);//绘制K线宽度比例为0.75,阳线为红色空心，阴线为绿色实心。
例2：
DRAWKLINE(0.5,COLORYELLOW,0,COLORBLUE,1);//绘制K线宽度比例为0.5,阳线为黄色实心，阴线为蓝色空心。
```

### DRAWKLINE1

绘制 K 线

```pascal
DRAWKLINE1(H1,O1,L1,C1) 绘制K线。

用法：DRAWKLINE1(H1,O1,L1,C1);以H1为最高价，L1为最低价，O1为开盘价，C1为收盘价绘制K线。

注：
1、写入的参数要符合逻辑，即H1大于等于O1，L1，C1；L1小于等于H1，O1，C1。
2、参数写好后，系统会根据写入的高开低收绘制K线，阳线显示为红色空心，阴线显示为青色实心。
3、不支持将该函数定义为变量，即不支持下面的写法：
A:DRAWKLINE1(H1,O1,L1,C1);

例：
DRAWKLINE1(H,O,L,C);
//按照高开低收为H,O,L,C绘制K线。
```

### DRAWKLINE2

绘制 K 线

```pascal
DRAWKLINE2 绘制K线。

用法：
DRAWKLINE2(WidthRatio,COLOR1,EMPTY1,COLOR2,EMPTY2);
1、绘制K线，黑色背景下，盘整时K线显示为黄色；白色背景下，盘整时K线显示为蓝色。
2、按照宽度比例WidthRatio画线，阳线以COLOR1和EMPTY1判断，阴线以COLOR2和EMPTY2判断。WidthRadio从0到1，COLOR1、COLOR2代表颜色，Empty非0为空心。

注：
1、绘制盘整K线的区间，根据函数PANZHENG进行计算
2、不支持将该函数定义为变量，即不支持下面的写法：
A:DRAWKLINE2(WidthRatio,COLOR1,EMPTY1,COLOR2,EMPTY2);

例：
DRAWKLINE2(0.75,COLORRED,1,COLORCYAN,0);//绘制K线宽度比例为0.75,阳线为红色空心，阴线为绿色实心。盘整时K线显示为黄色。
```

### DRAWLINE

画线

```pascal
DRAWLINE 绘制直线段。

用法：
DRAWLINE(C1,P1,C2,P2,COLOR);
满足条件C1时及C2时从P1向P2画线。颜色为COLOR。

注：
1、画线所在的k线须C1、C2同时满足。
2、绘制的直线段是在满足的k线上从P1到P2位置画COLOR颜色的线段。
3、该函数支持在函数后设置线型（LINETHICK1 - LINETHICK7、POINTDOT、DOT），即支持下面的写法：
DRAWLINE(C1,P1,C2,P2,COLOR),LINETHICK;
4、不支持将该函数定义为变量，即不支持下面的写法：
A:DRAWLINE(C1,P1,C2,P2,COLOR);

例1：
MA5:=MA(C,5);
MA10:=MA(C,10);
DRAWLINE(MA10<CLOSE,OPEN,MA5>CLOSE,CLOSE,COLORCYAN);//表示当收盘价大于10日均线并且小于5日均线时，从开盘价画青色直线到收盘价。
例2：
DRAWLINE(ISUP,C,ISUP,H,COLORRED),LINETHICK7;//表示当前k线收阳时，从收盘价价画红色直线到最高价，线型粗细为7。
```

### DRAWLINE1

画线

```pascal
DRAWLINE1 绘制直线段。

用法：
DRAWLINE1(C1,P1,C2,P2,EXP);
满足条件C1时及该K线后最近一个满足C2时从P1向P2画线。EXP为0表示画线不延伸，EXP不为0表示画线延伸。

注：
1、画线连接的是满足C1条件的K线的P1位置，和该K线后最近一个满足C2条件的K线的P2位置。
2、EXP为0，画线不延伸，即画线段；EXP不为0，画线延伸，即画射线
3、该函数支持在函数后设置颜色、线型（LINETHICK1 - LINETHICK7、POINTDOT、DOT），即支持下面的两种写法：
DRAWLINE1(C1,P1,C2,P2,EXP),LINETHICK,COLOR;
DRAWLINE1(C1,P1,C2,P2,EXP),COLOR,LINETHICK;
4、不支持将该函数定义为变量，即不支持下面的写法：
A:DRAWLINE1(C1,P1,C2,P2,EXP);

例：
DRAWLINE1(ISUP,H,ISDOWN,L,0),COLORBLUE,LINETHICK7;//表示在阳线的最高价处到距离该阳线最近的一根阴线的最低价处画线，画线不延伸，画线颜色为蓝色，线型粗细为7。
```

### DRAWLINE2

画线

```pascal
DRAWLINE2 绘制直线段。

用法：
DRAWLINE2(C1,P1,C2,P2,EXP);
满足条件C1时及之后最后一次满足C2时从P1向P2画线。EXP为画线0不延伸，EXP不为0画线延伸。

注：
1、画线连接的是满足C1条件的K线的P1位置，和该K线后最后一个满足C2条件的K线的P2位置。
2、EXP为0，画线不延伸，即画线段；EXP不为0，画线延伸，即画射线
3、该函数支持在函数后设置颜色、线型（LINETHICK1 - LINETHICK7、POINTDOT、DOT），即支持下面的两种写法：
DRAWLINE2(C1,P1,C2,P2,EXP),LINETHICK,COLOR;
DRAWLINE2(C1,P1,C2,P2,EXP),COLOR,LINETHICK;
4、不支持将该函数定义为变量，即不支持下面的写法：
A:DRAWLINE2(C1,P1,C2,P2,EXP);

例：
DRAWLINE2(ISUP,H,ISDOWN,L,0),COLORBLUE,LINETHICK7;//表示在阳线的最高价处到距离该阳线之后连续出现阴线中最远的一根阴线的最低价处画线，画线不延伸，画线颜色为蓝色，线型粗细为7。
```

### DRAWLINE3

偏移周期画线

```pascal
DRAWLINE3 偏移周期绘制直线段

用法：
DRAWLINE3(C1,P1,X1,C2,P2,X2,EXP);
满足条件C1时向左偏移X1个周期及满足条件C2时向左偏移X2个周期从P1向P2画线。EXP为0表示画线不延伸，EXP不为0表示画线延伸。

注：
1、画线连接的是满足C1条件的K线向左偏移X1个周期的P1位置，和满足C1条件后最近一个满足C2条件的k线向左偏移X2个周期的P2位置。
2、EXP为0，画线不延伸，即画线段；EXP不为0，画线延伸，即画射线
3、X1,X2支持变量
4、该函数支持在函数后设置颜色、线型（LINETHICK1 - LINETHICK7、POINTDOT、DOT），即支持下面的两种写法：
DRAWLINE3(C1,P1,X1,C2,P2,X2,EXP),LINETHICK,COLOR;
DRAWLINE3(C1,P1,X1,C2,P2,X2,EXP),COLOR,LINETHICK;
5、不支持将该函数定义为变量，即不支持下面的写法：
A:DRAWLINE3(C1,P1,X1,C2,P2,X2,EXP);

例1：
DRAWLINE3(ISUP,REF(H,3),3,ISDOWN,REF(L,3),3,0),COLORBLUE,LINETHICK7;//表示在阳线向左偏移3个周期的最高价处到距离该阳线最近的一根阴线向左偏移3个周期的最低价处画线，画线不延伸，画线颜色为蓝色，线型粗细为7。

例2：
COD1:=C<REF(C,2)&&REF(C,2)>REF(C,4);
COD2:=C>REF(C,2)&&REF(C,2)<REF(C,4);
DRAWLINE3(COD1,REF(H,2),2,COD2,REF(L,2),2,0),COLORGREEN;//满足COD1时向左偏移2个周期的最高价到满足COD2时向左偏移个2周期的最低价画绿色的线，画线不延伸
DRAWLINE3(COD2,REF(L,2),2,COD1,REF(H,2),2,0),COLORRED;//满足COD2时向左偏移2个周期的最低价到满足COD1时向左偏移个2周期的最高价画红色的线，画线不延伸
```

### DRAWNUMBER

写数字

```pascal
DRAWNUMBER：输出数值。

用法：
DRAWNUMBER(COND,DATA,NUMBER,PRECISION,COLOR);
当条件满足时在DATA位置写数字NUMBER。PRECISION为精度（小数点后有几位数字）。COLOR为颜色。

注：
1、该函数可以用ALIGN，VALIGN设置文字的对齐方式。
2、可以用FONTSIZE设置文字显示的字体大小。

例1：
DRAWNUMBER(CLOSE/OPEN>1.08,HIGH,(CLOSE-OPEN)/OPEN*100,2,COLORRED);//表示当日涨幅大于8%时在最高价位置红色显示涨幅数值(相对开盘价的百分比，精确2位小数)。
例2：
DRAWNUMBER(DATE<>REF(DATE,1),L,REF(C,1),2,COLORRED),ALIGN0,VALIGN0;//表示在当天第一根k线的最低价处以红色显示昨收盘价数值(精确2位小数)，标注文字居左，居上对齐。
```

### DRAWNUMBER1

写数字

```pascal
DRAWNUMBER1：输出数值。

用法：
DRAWNUMBER1(COND,DATA,NUMBER,PRECISION);
当条件满足时在DATA位置写数字NUMBER。PRECISION为精度（小数点后有几位数字）。

注：
该函数支持在函数后设置文字的颜色、文字的大小和文字对齐方式。即支持下面的写法：
DRAWNUMBER1(COND,DATA,NUMBER,PRECISION),COLOR,ALIGN,VALIGN;

例1：
DRAWNUMBER1(CLOSE/OPEN>1.08,HIGH,(CLOSE-OPEN)/OPEN*100,2),COLORRED;//表示当日涨幅大于8%时在最高价位置红色显示涨幅数值(相对开盘价的百分比，精确2位小数)。

例2：
DRAWNUMBER1(DATE<>REF(DATE,1),L,REF(C,1),2),COLORRED,ALIGN0,VALIGN0;//表示在当天第一根k线的最低价处以红色显示昨收盘价数值(精确2位小数)，标注文字居左，居上对齐。
```

### DRAWSL

画线（段）

```pascal
DRAWSL 绘制直线（段）。

用法：
DRAWSL(COND,DATA,SLOPE,LEN,EXPAND,COLOR);
当条件COND满足时，在DATA数据处以每个周期相差SLOPE个价位作为斜率画LEN个周期长的线段。
EXPAND为画线延长方式0:不延伸；1:向左延伸；2:向右延伸；3:双向延伸。

注：
1、每根k线与每根k线（每个周期）的纵向高度差为SLOPE。
2、当SLOPE为0时,画的是水平线。
3、该函数支持在函数后设置线型（LINETHICK1 - LINETHICK7、POINTDOT、DOT），即支持下面的写法：
DRAWSL(COND,DATA,SLOPE,LEN,EXPAND,COLOR),LINETHICK;
4、不支持将该函数定义为变量，即不支持下面的写法：
A:DRAWSL(COND,DATA,SLOPE,LEN,EXPAND,COLOR);

例1：
DRAWSL(C>O,H,0,2,0,COLORYELLOW);//表示当前k线为阳线时，从最高价开始画长度为2个周期的水平线，颜色为黄色。

例2：
DRAWSL(LOW=LLV(LOW,50),LOW,5,3,2,COLORRED),LINETHICK5;//表示当前最低价等于50周期内的最小值时，从当前最低价开始以每隔5个点的斜率画长度为3个周期向右延伸的斜线，颜色为红色，线型粗细为5。
```

### DRAWSL1

画线（段）

```pascal
DRAWSL1 绘制直线（段）。

用法：
DRAWSL1(COND,DATA,SLOPE,LEN,EXPAND);
当COND条件满足时，在DATA数据处以每个周期相差SLOPE个价位作为斜率画LEN个周期长的线段。
EXPAND为延伸方向：0为向右，1为向左，2为双向。

注：
1、每根k线与每根k线（每个周期）的纵向高度差为SLOPE。
2、当SLOPE为0时,画的是水平线,LEN为负值或0则直线无限延伸。
3、该函数支持在函数后设置颜色、线型（LINETHICK1 - LINETHICK7、POINTDOT、DOT），即支持下面的两种写法：
DRAWSL1(COND,DATA,SLOPE,LEN,EXPAND),LINETHICK,COLOR;
DRAWSL1(COND,DATA,SLOPE,LEN,EXPAND),COLOR,LINETHICK;
4、不支持将该函数定义为变量，即不支持下面的写法：
A:DRAWSL1(COND,DATA,SLOPE,LEN,EXPAND);

例1：
DRAWSL1(C>O,H,0,2,0),COLORYELLOW;//表示当前k线为阳线时，从最高价开始画长度为2个周期的水平线，颜色为黄色。

例2：
DRAWSL1(LOW=LLV(LOW,50),LOW,5,3,1),COLORRED,LINETHICK5;//表示当前最低价等于50周期内的最小值时，从当前最低价开始以每隔5个点的斜率画长度为3个周期向左延伸的斜线，颜色为红色，线型粗细为5。
```

### DRAWTEXT

显示文字

```pascal
DRAWTEXT：显示文字。

用法：
1、DRAWTEXT(COND,PRICE,TEXT);
当COND条件满足时,在PRICE位置书写文字TEXT。
2、DRAWTEXT(COND,PRICE,TEXT,COLOR);
当COND条件满足时,在PRICE位置书写文字TEXT,文字颜色为COLOR。

注：
1、显示的汉字用单引号标注
2、该函数可以用ALIGN，VALIGN设置文字的对齐方式。
3、该函数可以用FONTSIZE设置文字显示的字体大小
4、该函数可以用COLOR设置文字的颜色，即该函数支持如下写法：DRAWTEXT(COND,PRICE,TEXT),COLOR;

例1：
DRAWTEXT(CLOSE<OPEN&&REF(CLOSE,1)<REF(OPEN,1)&&REF(VOL,1)*1.1<VOL,LOW,'注');//
表示连续两日收阴并且成交量比前一日至少多10%时，在最低价上写"注"字。
例2：
DRAWTEXT(L<=LLV(L,10),LOW,'新低'),ALIGN0,FONTSIZE16,COLORRED;//表示当根k线创10周期新低时，在最低价写"新低"字，文字左对齐，字体大小为16，文字颜色为红色。
```

### FILLRGN

填充函数

```pascal
FILLRGN 条件满足时，填充某一区域。

用法：
FILLRGN(COND, DATA1, DATA2, COLOR);
当条件COND满足时，以颜色COLOR填充DATA1及DATA2之间形成的区域。

注：
不支持将该函数定义为变量，即不支持下面的写法：
A:FILLRGN(COND,DATA1,DATA2,COLOR);

例1：
FILLRGN(ISUP,10,20,COLORRED);//当K线为阳线时，填充10到20之间的区域。
例2：
MA5:MA(C,5);
MA10:MA(C,10);
FILLRGN(MA5>MA10,MA5,MA10,COLORRED);//表示MA5>MA10时以红色填充MA5和MA10之间的区域。
```

### FILLRGN1

填充函数

```pascal
FILLRGN1 条件满足时，填充某一区域。

用法：
FILLRGN1(COND, DATA1, DATA2);
当条件COND满足时，填充DATA1及DATA2之间形成的区域。

注：
1、该函数支持在函数后设置颜色，即支持下面的写法：
FILLRGN1(COND, DATA1, DATA2), COLOR;
2、不支持将该函数定义为变量，即不支持下面的写法：
A:FILLRGN1(COND,DATA1,DATA2);

例1：
FILLRGN1(ISUP,10,20),COLORRED;//K线为阳线时，用红色填充10到20之间的区域。

例2：
MA5:MA(C,5);
MA10:MA(C,10);
FILLRGN1(MA5>MA10,MA5,MA10),COLORRED;//表示MA5>MA10时以红色填充MA5和MA10之间的区域。
```

### FONTSIZE

设置字体大小

```pascal
设置字体大小。
用法：
FONTSIZEX，X为8至72，表示字体由小到大。
注：
不支持将该函数直接定义为变量，即不支持下面的写法：A:FONTSIZE9;

例1：
DRAWTEXT(C>O,H,'阳线'),FONTSIZE10;//收盘价大于开盘价，则在K线最高价处以10的字体大小标注阳线。
例2：
DRAWTEXT(C<O,L,'阴线'),ALIGN0,VALIGN2,FONTSIZE30;//收盘价小于开盘价，则在K线最低价处以30的字体大小，居左居上标注阴线。
```

### ICON

显示图标

```pascal
ICON函数 在k线图上，显示小图标。

用法：ICON(TYPE,ICON);
当TYPE为1，则在K线最高价位置显示图标ICON，当TYPE为0，则在最低价位置显示图标ICON。

注：
1、该函数与判断条件连用，如：COND,ICON(TYPE,ICON);
2、不支持将函数定义为变量，即不支持下面的写法：A:ICON(TYPE,ICON);
3、该函数支持在函数后设置设置文字垂直对齐方式：VALIGN0（上对齐）、VALIGN1（中对齐）、VALIGN2（下对齐）
即可以写为如下格式：
CLOSE<OPEN,WORD(1,'阴'),VALIGN0

例1：
CLOSE>OPEN,ICON(1,'ICO1');//表示K线收盘大于开盘时，在最高价上显示图标1。
写完“ICON(1,” 以后，点击插入图标按钮，再单击选中的图标插入到函数中，图标用'ICO1'~'ICO105'表示
```

### KTEXT

在 K 线附近标注文字

```pascal
KTEXT函数 在k线上标注文字。

用法：
KTEXT(COND,POSITION,PRICE,LCR,COLOR,TEXT);
当COND条件满足时,移动POSITION根K线,在PRICE位置书写COLOR色文字TEXT。LCR是文字占K线左(0)中(1)右(2)位置。

注：
1、POSITION 参数负数代表向前移动 0代表满足条件当根K线 正数代表向后移动。LCR代表显示在字符位置的左右中位置，0为左，1为中，2为右
2、显示的汉字用单引号标注。
3、不支持将该函数直接定义为变量，即不支持下面的写法：
A:KTEXT(COND,POSITION,PRICE,LCR,COLOR,TEXT);

例1：
KTEXT(O>C,2,H,1,COLORYELLOW,'注');//在阴线的后两根K线处，在最高价位置中心上写"注"字。
例2：
MA5:=MA(C,5);
KTEXT(CROSS(C,MA5),-3,MA5,2,COLORRED,'买入');//在收盘价金叉5周期均线的前三根K线处，在MA5位置右侧上写"买入"字。
```

### LINETHICK

线型粗细控制

```pascal
添加线型粗细控制。
用法：
LINETHICK1  LINETHICK2————LINETHICK7 线型由细至粗。
注：
1、不支持将该函数直接定义为变量，即不支持下面的写法：A:LINETHICK1;
2、该函数可以和颜色函数一起使用，即支持下面的写法：AA:C,COLORBLUE,LINETHICK5;
例：MA5:MA(C,5),COLORRED,LINETHICK4; 给5日均线中度加粗,颜色为红色。
```

### NODRAW

不画线

```pascal
NODRAW 只显示返回数值，不画线。
注：
不支持将该函数直接定义为变量，即不支持下面的写法：A:NODRAW;

例：
 MA5:MA(C,5), NODRAW;显示5周期均线的返回值，K线图上不显示均线。
```

### NOTEXT

不显示数值

```pascal
NOTEXT 只显示画线，不显示数值。

注：
不支持将该函数直接定义为变量，即不支持下面的写法：A:NOTEXT;

例：
 MA5:MA(C,5), NOTEXT;K线图上显示5周期均线，不显示均线的数值。
```

### PARTLINE

画线段

```pascal
PARTLINE 画线段。

用法：
PARTLINE(COND, DATA, COLOR);
条件COND满足时，以COLOR颜色的直线连接DATA各点

注：
1、该函数是将满足条件的DATA以线段形式连接起来，连线并不连续。
2、该函数支持在函数后设置线型（LINETHICK1 - LINETHICK7、POINTDOT、DOT），即支持下面的写法：
PARTLINE(COND, DATA, COLOR),LINETHICK;
3、不支持将该函数定义为变量，即不支持下面的写法：
A:PARTLINE(COND,DATA,COLOR);

例1：
PARTLINE(HIGH>REF(HIGH,1),HIGH,COLORRED);//表示当期最高价大于前期最高价时用红色绘制最高价线段。
例2：
PARTLINE(LOW<REF(LOW,1),LOW,COLORBLUE),LINETHICK5;//表示当期最低价小于前期最低价时用蓝色绘制最低价线段，线型粗细为5。
```

### PARTLINE1

画线段

```pascal
PARTLINE1 画线段。

用法：
PARTLINE1(COND,DATA);
条件COND满足时，用线段连接DATA各点。

注：
1、该函数是将满足条件的DATA以线段形式连接起来，连线并不连续。
2、该函数支持在函数后设置颜色、线型（LINETHICK1 - LINETHICK7、POINTDOT、DOT），即支持下面的两种写法：
PARTLINE1(COND,DATA),COLOR,LINETHICK;
PARTLINE1(COND,DATA),LINETHICK,COLOR;
3、不支持将该函数定义为变量，即不支持下面的写法：
A:PARTLINE1(COND,DATA);

例：
PARTLINE1(HIGH>REF(HIGH,1),HIGH),COLORRED,LINETHICK5;//表示当期最高价大于前期最高价时用红色绘制最高价线段，线型粗细为5。
```

### PLAYSOUND

声音函数

```pascal
PLAYSOUND 条件满足时，播放指定声音。

用法：
PLAYSOUND(COND, 'N') 当条件满足时，播放声音'N'

注：
1、点击设置声音按钮，在弹出来的界面中设置声音，声音用字符'A'~'J'表示。
2、自定义声音可以在设置菜单的设置声音文件中设置
3、条件一直满足，则只播放一次，不重复播放。
4、不支持将该函数直接定义为变量，即不支持下面的写法：
A:PLAYSOUND(COND, 'N');
5、当前k线满足时才会播放声音，历史满足不会播放

例：
PLAYSOUND(CLOSE>OPEN,'A');表示CLOSE>OPEN时播放自定义声音'A'。
```

### POINTDOT

画点线

```pascal
画点线。
用法：
POINTDOT 画点线。
注：
不支持将该函数直接定义为变量，即不支持下面的写法：A:POINTDOT;
例：MA5:MA(C,5),POINTDOT;用点线画5日均线。
```

### POLYLINE

画折线

```pascal
POLYLINE函数 画折线。

用法：
POLYLINE(COND,DATA,COLOR);
条件COND满足时，用颜色COLOR的折线连接DATA的值。

注：
1、该函数是将满足条件的DATA以折线形式连接起来，连线连续
2、该函数支持在函数后设置线型（LINETHICK1 - LINETHICK7、POINTDOT、DOT），即支持下面的写法：POLYLINE(COND,DATA,COLOR),LINETHICK;
3、不支持将该函数定义为变量，即不支持下面的写法：
A:POLYLINE(COND,DATA,COLOR);

例1：
POLYLINE(CLOSE>=HHV(CLOSE,10),CLOSE,COLORRED);//表示在收盘价创10天新高点之间画折线。折线显示为红色。

例2：
POLYLINE(CLOSE<=LLV(CLOSE,10),CLOSE,COLORBLUE),LINETHICK7;//表示在收盘价创10天新低点之间画折线。折线显示为蓝色,线型粗细为7。
```

### POLYLINE1

画折线

```pascal
POLYLINE1 画折线。

用法：
POLYLINE1(COND,DATA);
条件COND满足时，用折线连接DATA的值。

注：
1、该函数是将满足条件的DATA以折线形式连接起来，连线连续
2、该函数支持在函数后设置颜色、线型（LINETHICK1 - LINETHICK7、POINTDOT、DOT），即支持下面的两种写法：
POLYLINE1(COND,DATA),LINETHICK,COLOR;
POLYLINE1(COND,DATA),COLOR,LINETHICK;

3、不支持将该函数定义为变量，即不支持下面的写法：
A:POLYLINE1(COND,DATA);

例1：
POLYLINE1(CLOSE>=HHV(CLOSE,10),CLOSE),COLORRED;//表示在收盘价创10天新高点之间画折线。折线显示为红色。

例2：
POLYLINE1(CLOSE<=LLV(CLOSE,10),CLOSE),COLORBLUE,LINETHICK7;//表示在收盘价创10天新低点之间画折线。折线显示为蓝色,线型粗细为7。
```

### PRECIS

指定数值的输出精度（小数位数）

```pascal
指定数值的输出精度（小数位数）。
用法：
PRECISX，X为0至6，表示小数位数从0到6。
注：
不支持将该函数直接定义为变量，即不支持下面的写法：A:PRECIS0;

例1：
MA(C,5),PRECIS4;//计算五周期均线，数值精度为4位小数。
```

### PRECISION

设置小数位数

```pascal
PRECISION(N) 设置小数位数，N为位数范

注：
1、当N设置为具体数值是，N范围可以为0-6

例1：
C,PRECISION(3); //设置小数点位数为3位，即返回收盘价显示三位小数

例2：
C,PRECISION(PRICEPRECISION); //返回收盘价，设置小数点位数为当前合约的小数位数
```

### PRICEPRECISION

取当前合约小数点位数

```pascal
PRICEPRECISION 取当前合约小数点位数

用法：
返回当前合约设置的小数点位数

例：
C,PRECISION(PRICEPRECISION); //返回收盘价，设置小数点位数为当前合约的小数位数
```

### PRICEPRECISION1

取指定合约设置的小数点位数

```pascal
PRICEPRECISION1('CODE') 取指定合约设置的小数点位数

注：
1、CODE可以为文华码或合约名

例：
PRICEPRECISION1('8608');//返回文华码8608合约设置的小数点位数
C,PRECISION(PRICEPRECISION1('8608')); //返回收盘价，设置小数点位数为指定文华码8608的合约的小数位数
```

### REFLINE

设定指标参考线

```pascal
设定指标参考线。

用法：
REFLINE:A,B,C...;
在A,B,C的位置画出指标参考线。

注：
1、A、B、C等均为常数。
2、最多支持16个参数,如果超过16个参数，自动截取前16个参数。
3、该函数连写，则只会显示最后一次设定的指标线。
4、不支持将函数定义为变量，即不支持下面的写法：A:REFLINE;
5、该指标参考线完全根据设置的坐标显示，不随其他指标值的最值调整坐标范围

例1：
REFLINE:-100,0,100;//在-100,0,100的位置画出指标参考线。
```

### REFLINE1

设定指标参考线

```pascal
设定指标参考线。

用法：
REFLINE1:A,B,C...;
在A,B,C的位置画出指标参考线。

注：
1、A、B、C等均为常数。
2、最多支持16个参数,如果超过16个参数，自动截取前16个参数。
3、该函数连写，则只会显示最后一次设定的指标线。
4、不支持将函数定义为变量，即不支持下面的写法：A:REFLINE1;
5、该函数编写指标参考线会与指标中最值取交集调整坐标范围显示

例1：
REFLINE1:-100,0,100;//在-100,0,100的位置画出指标参考线。
```

### SETSTYLECOLOR

线型的粗细和颜色控制

```pascal
SETSTYLECOLOR函数 设置线型的粗细和颜色。

用法：
SETSTYLECOLOR(STYLE,COLOR);

注：
1、参数STYLE可以使用LINETHICK1——LINETHICK7,数值越大，线型越粗;
2、参数STYLE可以使用DOT,设置线形为虚线。
3、参数STYLE可以使用NODRAW，不画线只显示数值
4、参数COLOR可以使用插入颜色中的所有颜色和颜色函数。(如:COLORRED或RGB(255,255,0));
5、不支持将该函数直接定义为变量，即不支持下面的写法：A:SETSTYLECOLOR(LINETHICK5,COLORGREEN);

例1：
 A:C,SETSTYLECOLOR(LINETHICK5,COLORGREEN);//以绿色LINETHICK5的粗细大小画收盘价连线。
```

### SOLID

实心显示

```pascal
SOLID 实心显示。

用法：
用在VOLSTICK、VOLUMESTICK函数后面，表示柱线实心显示。

注：
仅支持与VOLSTICK、VOLUMESTICK函数连用。

例：
VOL,VOLUMESTICK,SOLID;//画成交量柱状线，柱线实心显示。
```

### SOUND

播放声音

```pascal
SOUND 播放声音。

用法：SOUND(NAME)，播放NAME

注：
1、点击设置声音按钮，在弹出来的界面中设置声音，声音用字符'A'~'J'表示。
2、自定义声音可以在设置菜单的设置声音文件中设置
3、条件一直满足，则只播放一次，不重复播放。
4、不支持将函数定义为变量，即不支持下面的写法：A:SOUND(NAME);
5、当前k线满足时才会播放声音，历史满足不会播放

例：
CLOSE>OPEN,SOUND('A');表示K线收盘大于开盘时，播放声音"A"
```

### STICK

画指定粗细的柱线

```pascal
STICK(COND,P1,P2,N,COLOR,Empty);画不同粗细的柱线
用法：当满足COND时，在P1与P2之间画一条粗细为N、颜色为COLOR的柱状图；若Empty不为0，则为空心柱；Empty为 0，则为实心柱。。用法和STICKLINE函数类似。
注：
1、参数N取值在0~9之间，为3时和主图K线宽度一致；
2、不支持将该函数直接定义为变量，即不支持下面的写法：A:STICK(OPEN-CLOSE>0,OPEN,CLOSE,3,COLORCYAN,0);

例1：
STICK(OPEN-CLOSE>0,OPEN,CLOSE,3,COLORCYAN,0);//表示当开盘价大于收盘价时，从开盘价到收盘价画宽度为3的青色的实心柱，即K线阴线的实体部分。
```

### STICKLINE

画柱线

```pascal
STICKLINE 在图形上画柱线。

用法：
STICKLINE(COND,P1,P2,Color,Empty);
当COND条件满足时，从P1到P2画柱,颜色为Color。若Empty不为0，则为空心柱；Empty为0，则为实心柱，其中Empty不支持设置为变量。

注：
不支持将该函数定义为变量，即不支持下面的写法：
A:STICKLINE(COND,P1,P2,Color,Empty);

例1：
STICKLINE(OPEN-CLOSE>0,OPEN,CLOSE,COLORCYAN,0);//表示当开盘价大于收盘价时，从开盘价到收盘价画青色的实心柱，即K线阴线的实体部分。
```

### STICKLINE1

画柱线

```pascal
STICKLINE1 在图形上画柱线。

用法：
STICKLINE1(COND,P1,P2,Width,Empty);
当COND条件满足时，从P1到P2画柱,宽度为Width。若Empty不为0，则为空心柱；Empty为0，则为实心柱。

注：
1、该函数支持在函数后设置颜色，即支持下面的写法：
STICKLINE1(COND,P1,P2,Width,Empty),COLOR;
2、不支持将该函数定义为变量，即不支持下面的写法：
A:STICKLINE1(COND,P1,P2,Width,Empty);

例：
STICKLINE1(OPEN-CLOSE>0,OPEN,CLOSE,4,0),COLORCYAN;//表示当开盘价大于收盘价时，从开盘价到收盘价画青色的实心柱，宽度为4，即K线阴线的实体部分。
```

### VALIGN

设置文字对齐方式（上中下）

```pascal
设置文字对齐方式（上中下）。

用法：DRAWTEXT(COND,PRICE,TEXT),VALIGNX;

COND条件满足时，在PRICE的位置，标注TEXT，文字按照VALIGNX写入的方式对齐。VALIGN0，VALIGN1，VALIGN2，分别表示上对齐，居中对齐，下对齐。

例：
DRAWTEXT(C>O,H,'涨'),ALIGN1,VALIGN1,FONTSIZE20,COLORGREEN;//在阳线的最高价标注文字“涨”，文字居中对齐，字体大小为20，颜色为绿色。
```

### VERTLINE

画垂直线

```pascal
VERTLINE 画垂直线。

用法：
VERTLINE(COND,COLOR);
条件COND满足时，以颜色COLOR画垂直线。

注：
1、该函数支持在函数后设置线型（LINETHICK1 - LINETHICK7、POINTDOT、DOT），即支持下面的写法：
VERTLINE(COND,COLOR),LINETHICK;
2、不支持将该函数定义为变量，即不支持下面的写法：
A:VERTLINE(COND,COLOR);

例1：
VERTLINE(HIGH>=HHV(HIGH,30),COLORRED);//表示在价格创30天新高时画红色垂直线

例2：
VERTLINE(LOW<=LLV(LOW,30),COLORBLUE),LINETHICK3;//表示在价格创30天新低时画蓝色垂直线，线型粗细为3。
```

### VERTLINE1

画垂直线

```pascal
VERTLINE1 画垂直线。

用法：
VERTLINE1(COND);
条件COND满足时，画垂直线。

注：
1、该函数支持在函数后设置颜色、线型（LINETHICK1 - LINETHICK7、POINTDOT、DOT），即支持下面的两种写法：
VERTLINE1(COND),LINETHICK,COLOR;
VERTLINE1(COND),COLOR,LINETHICK;
2、不支持将该函数定义为变量，即不支持下面的写法：
A:VERTLINE1(COND);

例1：
VERTLINE1(HIGH>=HHV(HIGH,30)),COLORRED;//表示在价格创30天新高时画红色垂直线。
例2：
VERTLINE1(LOW<=LLV(LOW,30)),COLORBLUE,LINETHICK3;//表示在价格创30天新低时画蓝色垂直线,线型粗细为3。
```

### VOLSTICK

画柱线

```pascal
VOLSTICK 画柱线，K线为阳线画红色空心柱，K线为阴线画青色实心柱。

注：
1、柱高表示数值大小。
2、K线为阳线，则对应的柱显示为红色空心，K线为阴线，则对应的柱显示为青色实心。
3、默认红柱为空心柱，画实心柱需要加入SOLID函数。

例1：
VOL,VOLSTICK;//画成交量柱状线，柱高表示成交量大小，阳线对应红色空心柱，阴线对应青色实心柱。

例2：
VOL,VOLSTICK,SOLID;//画成交量柱状线，柱线实心显示。
```

### VOLUMESTICK

画柱线

```pascal
VOLUMESTICK 画柱线，K线为阳线画红色空心柱，K线为阴线画青色实心柱。

注：
1、柱高表示数值大小。
2、K线为阳线，则对应的柱显示为红色空心，K线为阴线，则对应的柱显示为青色实心。
3、默认红柱为空心柱，画实心柱需要加入SOLID函数。

例1：
VOL,VOLUMESTICK;//画成交量柱状线，柱高表示成交量大小，阳线对应红色空心柱，阴线对应青色实心柱。

例2：
VOL,VOLUMESTICK,SOLID;//画成交量柱状线，柱线实心显示。
```

### WORD

显示文字

```pascal
WORD,显示文字。

用法：WORD(TYPE,TEXT) 当TYPE为1，则在K线最高价位置书写文字TEXT；不为1则在最低价位置书写文字TEXT。
注：
1：该函数与判断条件连用，如COND,WORD(TYPE,TEXT)。
2、该函数可以用ALIGN，VALIGN设置文字的对齐方式。
3、该函数可以用FONTSIZE设置文字显示的字体大小。
4、该函数可以用COLOR来设置文字显示的颜色。

例1：
CLOSE>OPEN,WORD(1,'阳'),ALIGN0,VALIGN0,FONTSIZE54,COLORRED;//表示K线收盘大于开盘时，在最高价上写"阳"字，文字左上对齐，字体大小为54，颜色为红色。
```

## 未来函数

### BACKSET

向前赋值

```pascal
BACKSET将当前位置到若干周期前的数据设为1。

用法：
BACKSET(X,N),若X非0,则将包含当前位置在内的一共N周期的数值设为1。

注：
1、N包含当前k线。
2、当N为有效值，但当前的k线数不足N根，按照实际的根数计算；
3、N为0或空值的情况下，返回空值。
4、N可以为变量
5、该函数不支持与指令连用（即该函数不支持与BK\SK\BP\SP\BPK\SPK\CLOSEOUT\STOP\STOP1出现在同一个模型里）
6、含有该函数时，定义变量的语句中不能使用该变量本身。

例：BACKSET(CLOSE>OPEN,2);表示当K线收阳时，将该周期及前一周期数值设为 1,否则为 0
该函数参数支持变量计算如BACKSET(CLOSE>OPEN,VAR1);//VAR1是变量
```

### PEAK

取之字转向的前 M 个波峰的值

```pascal
PEAK 取之字转向的前M个波峰的值。
用法：

PEAK(X,P,M,C) X满足条件P形成之字转向的前M个波峰的值。C是标记量，取1表示P是百分比数值；取0表示P是绝对数值。

注：
1、该函数不支持与指令连用（即该函数不支持与BK\SK\BP\SP\BPK\SPK\CLOSEOUT\STOP\STOP1出现在同一个模型里）
2、含有该函数时，定义变量的语句中不能使用该变量本身。

例1：PEAK(HIGH,10,1,1);表示最高价的10%的之字转向的上一个波峰的数值；PEAK(MA(HIGH,34),100,1,0);表示34个周期内最高价均线的100个价位的之字转向的上一个波峰的数值。
```

### PEAKBARS

取之字转向的前 M 个波峰的位置

```pascal
PEAKBARS取之字转向的前M个波峰的位置。

用法：
PEAKBARS(X,P,M,C) 取得X满足条件P形成之字转向的前M个波峰的位置。C是标记量，取1表示P是百分比数值；取0表示P是绝对数值。

注：
1、该函数不支持与指令连用（即该函数不支持与BK\SK\BP\SP\BPK\SPK\CLOSEOUT\STOP\STOP1出现在同一个模型里）
2、含有该函数时，定义变量的语句中不能使用该变量本身。

例1：
PEAKBARS(HIGH,10,1,1);表示最高价的10%的之字转向的上一个波峰到当前的周期数；
PEAKBARS(MA(HIGH,34),100,1,0);表示34个周期内最高价均线的100个价位的之字转向的上一个波峰到当前的周期数
例2：
10%的之字转向的上一个波峰波谷的位置标注相应的值（日线周期）。
P1:=PEAK(H,10,1,1);
N1:=PEAKBARS(H,10,1,1);
T2:=TROUGH(L,10,1,1);
N2:=TROUGHBARS(L,10,1,1);
DRAWNUMBER(N1=0,H,P1,2,COLORYELLOW);
DRAWNUMBER(N2=0,L,T2,2,COLORYELLOW);
例3:
根据10%的之字转向的上一个波峰波谷位置，确定价格形态（日线周期）。
P1:=PEAK(H,10,1,1);
N1:=PEAKBARS(H,10,1,1);
T1:=TROUGH(L,10,1,1);
M1:=TROUGHBARS(L,10,1,1);
DRAWTRENDLINE(N1=0,P1,N1=0,P1,COLORRED);
DRAWTRENDLINE(M1=0,T1,M1=0,T1,COLORGREEN);
```

### REFX

向后引用

```pascal
REFX引用后N个周期的数据。

用法：
REFX(X,N)引用X在N个周期后的值。

注：
1、当N为有效值，但当前的k线数不足N根，按实际根数计算；
2、N为0时返回当前X值；N为空值时返回空值。
3、N不能为变量
4、该函数不支持与指令连用（即该函数不支持与BK\SK\BP\SP\BPK\SPK\CLOSEOUT\STOP\STOP1出现在同一个模型里）
5、含有该函数时，定义变量的语句中不能使用该变量本身。

例：REFX(CLOSE,5);表示引用自当前周期后第5个周期的收盘价
```

### REFX1

向后引用

```pascal
REFX1引用后N个周期的数据。

用法：
REFX1(X,N)引用X在N个周期后的值，不足N周期取最后一根的值

注：
1、当N为有效值，但当前的k线数不足N根，按照实际的根数计算，取最后一根的值；
2、N为0时返回当前X值；N为空值时返回空值。
3、N不能为变量
4、该函数不支持与指令连用（即该函数不支持与BK\SK\BP\SP\BPK\SPK\CLOSEOUT\STOP\STOP1出现在同一个模型里）
5、含有该函数时，定义变量的语句中不能使用该变量本身。

例：REFX1(CLOSE,5);表示引用自当前周期后第5个周期的收盘价，如此时未来只有二根k线，返回最后一根的收盘价
```

### TROUGH

取之字转向的前 M 个波谷的值

```pascal
TROUGH求之字转向的前M个波谷的值。

用法：
TROUGH(X,P,M,C) X满足条件P形成之字转向的前M个波谷的值。C是标记量，取1表示P是
百分比数值；取0表示P是绝对数值。

注：
1、该函数不支持与指令连用（即该函数不支持与BK\SK\BP\SP\BPK\SPK\CLOSEOUT\STOP\STOP1出现在同一个模型里）
2、含有该函数时，定义变量的语句中不能使用该变量本身。

例1：
 TROUGH(LOW,10,1,1);表示最低价的10%的之字转向的上一个波谷的数值；
TROUGH (MA(LOW,34),100,1,0);表示34个周期内最低价均线的100个价位的之字转向的上一个
波谷的数值
```

### TROUGHBARS

取之字转向的前 M 个波谷的位置

```pascal
TROUGHBARS 求之字转向的前M个波谷的位置。

用法：
TROUGHBARS(X,P,M,C) 求X满足条件P形成之字转向的前M个波谷的位置。C是标记量，取
1表示P是百分比数值；取0表示P是绝对数值。

注：
1、该函数不支持与指令连用（即该函数不支持与BK\SK\BP\SP\BPK\SPK\CLOSEOUT\STOP\STOP1出现在同一个模型里）
2、含有该函数时，定义变量的语句中不能使用该变量本身。

例1：
TROUGHBARS(LOW,10,1,1);表示最低价的10%的之字转向的上一个波谷到当前的周期数；
TROUGHBARS (MA(LOW,34),100,1,0);表示34个周期内最低价均线的100个价位的之字转向的
上一个波谷到当前的周期数
```

### WAVEPEAK

判断 K 线图波峰

```pascal
WAVEPEAK函数 返回K线图波峰位置。

用法：
WAVEPEAK(N) 如果当前K线最高价大于前后N根K线的最高价返回1，否则返回0。N
支持变量。

注：
1、当N为有效值，但当前的k线数不足N根，或者N为空值的情况下，代表不成立，该函数返回0。
2、本函数有未来函数性质。
3、该函数不支持与指令连用（即该函数不支持与BK\SK\BP\SP\BPK\SPK\CLOSEOUT\STOP\STOP1出现在同一个模型里）
4、含有该函数时，定义变量的语句中不能使用该变量本身。

例1：
WAVEPEAK(10); //如果当前K线最高价大于前10根K线最高价且大于后10根K线最高
价返回1，否则返回0。
例2:
K线价格与MACD的DIFF发生顶背离时，标注“顶背离”。
DIFF :=EMA(CLOSE,12) - EMA(CLOSE,26);
TMP:=WAVEPEAK(5);
DIFF1:VALUEWHEN(TMP=1,DIFF),NODRAW;
H1:VALUEWHEN(TMP=1,H),NODRAW;
TMP1:=H1<REF(H1,1)&&DIFF1>REF(DIFF1,1);
DRAWTEXT(TMP1,H,'顶背离');
例3：
HH:=VALUEWHEN(WAVEPEAK(5),H);//取满足最高价大于前后5根k线最高价k线的最高
价格
```

### WAVEPEAK1

判断变量的波峰

```pascal
WAVEPEAK1(DATA, N)判断当前K线是否为DATA变量的波峰位置。

用法：
WAVEPEAK1(DATA, N) 当前K线的变量DATA值大于前后N根K线上的值，则返回1，否则返回0。N
支持变量。

注：
1、当N为有效值，但当前的k线数不足N根，或者N为空值的情况下，代表不成立，该函数返回0。
2、本函数有未来函数性质。
3、该函数不支持与指令连用（即该函数不支持与BK\SK\BP\SP\BPK\SPK\CLOSEOUT\STOP\STOP1出现在同一个模型里）
4、含有该函数时，定义变量的语句中不能使用该变量本身。

例1：
WAVEPEAK1(MA(C,5),10); //如果当前K线上的5周期均线的值大于前10根K线的5周期均线的值且大于后10根K线的5周期均线的值，返回1，否则返回0。
例2:
//10周期均线与MACD的DIFF发生顶背离时，标注“顶背离”。
DIFF :=EMA(CLOSE,12) - EMA(CLOSE,26);
TMP:=WAVEPEAK1(MA(C,10),5);
DIFF1:VALUEWHEN(TMP=1,DIFF),NODRAW;
H1:VALUEWHEN(TMP=1,MA(C,10)),NODRAW;
TMP1:=H1<REF(H1,1)&&DIFF1>REF(DIFF1,1);
DRAWTEXT(TMP1,H,'顶背离');
例3：
HH:=VALUEWHEN(WAVEPEAK1(H,5),H);//取满足最高价大于前后5根k线最高价k线的最高
价格
```

### WAVEVALLEY

判断 K 线图波谷

```pascal
WAVEVALLEY函数 返回K线图波谷位置。

用法：
WAVEVALLEY(N) 如果当前K线最低价小于前后N根K线的最低价返回1，否则返回0。
N支持变量。

注：
1、当N为有效值，但当前的k线数不足N根，或者N为空值的情况下，代表不成立，
该函数返回0。
2、本函数有未来函数性质。
3、该函数不支持与指令连用（即该函数不支持与BK\SK\BP\SP\BPK\SPK\CLOSEOUT\STOP\STOP1出现在同一个模型里）
4、含有该函数时，定义变量的语句中不能使用该变量本身。

例1：
WAVEVALLEY(10); //如果当前K线最低价小于前10根K线最低价且小于后10根K线最
低价返回1，否则返回0。
例2：
K线价格与MACD的DIFF发生底背离时，标注“底背离”。
DIFF :=EMA(CLOSE,12) - EMA(CLOSE,26);
TMP:=WAVEVALLEY(5);
DIFF1:=VALUEWHEN(TMP=1,DIFF);
L1:=VALUEWHEN(TMP=1,L);
TMP1:=L1>REF(L1,1)&&DIFF1<REF(DIFF1,1);
DRAWTEXT(TMP1,L,'底背离');
例3：
 LL:=VALUEWHEN(WAVEVALLEY(5),L);//取满足最低价小于前后5根k线最低价k线的最低
价格
```

### WAVEVALLEY1

判断变量的波谷

```pascal
WAVEVALLEY1(DATA, N)函数 判断当前K线是否为DATA变量的波谷位置。

用法：
WAVEVALLEY1(DATA, N) 当前K线DATA变量的值小于前后N根K线的DATA变量的值返回1，否则返回0。
N支持变量。

注：
1、当N为有效值，但当前的k线数不足N根，或者N为空值的情况下，代表不成立，
该函数返回0。
2、本函数有未来函数性质。
3、该函数不支持与指令连用（即该函数不支持与BK\SK\BP\SP\BPK\SPK\CLOSEOUT\STOP\STOP1出现在同一个模型里）
4、含有该函数时，定义变量的语句中不能使用该变量本身。

例1：
 WAVEVALLEY1(MA(C,5),10); //如果当前K线上的5周期均线的值小于前10根K线的5周期均线的值且小于后10根K线的5周期均线的值，返回1，否则返回0。
例2：
10周期均线与MACD的DIFF发生底背离时，标注“底背离”。
DIFF :=EMA(CLOSE,12) - EMA(CLOSE,26);
TMP:=WAVEVALLEY1(MA(C,10),5);
DIFF1:=VALUEWHEN(TMP=1,DIFF);
L1:=VALUEWHEN(TMP=1,MA(C,10));
TMP1:=L1>REF(L1,1)&&DIFF1<REF(DIFF1,1);
DRAWTEXT(TMP1,L,'底背离');
例3：
LL:=VALUEWHEN(WAVEVALLEY1(L,5),L);//取满足最低价小于前后5根k线最低价k线的最低
价格
```

### ZIGZAG

之字转向

```pascal
ZIGZAG 求之字转向。

用法：
ZIGZAG(X,N,Type)求X的在条件N下的之字转向值。
Type为0时，为具体数值转向。N表示X满足前一转向点处X值+N或X值-N时形成新的转向点
Type为1时，为百分比转向。N表示X满足前一转向点处X值*（1+N%）或X值*（1-N%）时形成新的转向点

注：
1、参数N不支持变量
2、该函数不支持与指令连用（即该函数不支持与BK\SK\BP\SP\BPK\SPK\CLOSEOUT\STOP\STOP1出现在同一个模型里）
3、含有该函数时，定义变量的语句中不能使用该变量本身。

函数取值具体说明：
以HH:ZIGZAG(HIGH,100,0);为例
1、从第一根K线的最高价A做为起点开始取值，即A为之字转向的初始值
2、后续K线的最高价如果一直小于(A+100)并且大于(A-100)，那么第二个点一直为最新K线上最高价HIGH的取值，随着后续K线上之字转向第二个点的变动，之前K线上HH的取值也会发生改变，因为之前k线上HH的取值为A点与当前k线最高价连成的趋势线上对应的取值
3、例如当前K线的最高价大于A+100，当根K线最高价的取值为B，那么后续的K线如果延续上升趋势，大于B的取值，则取代B成为第二点（此时前面K线HH的取值发生变化，理由同第2点）；后续的K线未延续上升取值，均小于B的取值，则B值确定为第二个点
4、确定第二个点之后，寻找后续最高价小于B-100K线，若未小于B-100，则第三个点为当前最新K线的最高价(取值规则重复第2点)
5、后续HH的取值重复此规律

例1：
ZIGZAG(HIGH,10,1);//表示最高价的10%的之字转向
例2：
ZIGZAG(MA(HIGH,34),100,0);//表示34个周期内最高价均线的100个价位的之字转向
```

## 计算控制函数

### AUTOFILTER

启用一开一平信号过滤机制

```pascal
AUTOFILTER 启用一开一平信号过滤机制。

用法：
模型中含有AUTOFILTER函数，则启用一开一平信号过滤机制。
模型中不写入该函数，则每个指令都有效，支持加减仓。

模型的过滤规则：
1、连续的同方向指令只有第一个有效，其他的将被过滤；
2、交易指令必须先开仓后平仓，一开一平配对出现：
出现BK指令，下一个指令只允许出现SP\SPK指令；
出现SK指令，下一个指令只允许出现BP\BPK指令；
出现SP/BP/CLOSEOUT等平仓指令，下一个可以是BK/SK/SPK/BPK指令任一个；
反手指令SPK和BPK交叉出现。

例：
CLOSE>OPEN,BK;
CLOSE<OPEN,SP;
AUTOFILTER; //启用一开一平信号过滤机制
```

### AUTOFINANCING

启用按需自动入金方式

```pascal
AUTOFINANCING 启用按需自动入金方式

用法：模型中含有AUTOFINANCING函数，则启用按需自动入金方式。

按需自动入金方式规则：
1、模型中含有该函数，回测和模组中资金使用量按需自动入金，参数设置中设置的资金分配量无效。
2、首次账户入金为首次开仓所需要的资金，如下次开仓时可用资金不足，则账户再次入金，按所需补齐不足部分资金。
3、如模型中不含该函数
1）回测时：则按回测参数中设置的资金分配量进行回测
2）实盘中：则实盘运行按子账户参数中设置的信号计算资金分配量进行计算

注：
按需自动入金中，回测报告中显示的资金分配量为账户总入金

例：
MA5:MA(C,5);
MA10:MA(C,10);
CROSSUP(MA5,MA10),BK(100);
CROSSDOWN(MA5,MA10),SP(100);
AUTOFINANCING;//启用自动入金方式
//该模型加载在股票合约上
```

### CONDITION_ORDER

公式条件单模型关键字

```pascal
公式条件单模型关键字

用法：
编写公式条件单模型时，将“CONDITION_ORDER”函数放到代码最后一句，表示该模型为公式条件单模型

注：
所有指令发完一次后，盒子信号作用方式自动切换为显示信号不下单。

例：
MA5:=MA(C,5);//5周期均线
MA10:=MA(C,10);//10周期均线
CROSSUP(MA5,MA10),BK;//5周期上穿10周期均线，做多
CONDITION_ORDER;//公式条件单关键字
```

### CONDITION_ORDER1

公式条件单模型关键字

```pascal
公式条件单模型关键字

用法：
编写公式条件单模型时，将“CONDITION_ORDER1”函数放到代码最后一句，表示该模型为公式条件单模型

注：
1、含CONDITION_ORDER1的模型加载到盒子成功后每行指令重新开始计算信号，并且出信号立即下单不复核，该根K线不再出信号。
2、所有指令发完一次后，盒子信号作用方式自动切换为显示信号不下单。
3、主图按收盘价模型计算信号

例：
MA5:=MA(C,5);//5周期均线
MA10:=MA(C,10);//10周期均线
CROSSUP(MA5,MA10),BK;//5周期上穿10周期均线，做多
CONDITION_ORDER1;//公式条件单关键字
```

### DAYTRADE

日内交易函数

```pascal
DAYTRADE 日内交易函数。

用法：
DAYTRADE 模型中写入该函数，信号和资金每天重新初始化进行计算，与历史割裂。

注：
1、该函数适用于小时、分钟以下周期，不支持日、自定义N日、周、月、季、年周期。
2、回测报告的出金/入金为日内的出金/入金的和。
3、模型中不能同时使用DAYTRADE1\DAYTRADE\WEEKTRADE\WEEKTRADE1\MONTHTRADE\QUARTERTRADE\YEARTRADE函数。
4、（1）历史回测中，当日K线走完持仓大于0，会对持仓进行全清处理。
   （2）模组运行中，当日K线走完持仓大于0，信号和资金会重新初始化进行计算，但不会自动对持仓进行全清处理，需要在模型中编写实现全清。

例：
MA5^^MA(C,5);
MA10^^MA(C,10);
CROSSUP(MA5,MA10),BK;//5周期均线上穿10周期均线，买开仓
CROSSDOWN(MA5,MA10),SK;//5周期均线下穿10周期均线，卖开仓
C<BKPRICE-10*MINPRICE,SP;//亏损10点平多
C>SKPRICE+10*MINPRICE,BP;//亏损10点平空
CLOSEMINUTE<=1,CLOSEOUT;//收盘前一分钟，清仓。
AUTOFILTER;//一开一平信号过滤模型
DAYTRADE;//只用日内数据进行计算
```

### DAYTRADE1

日内交易函数

```pascal
DAYTRADE1 日内交易函数。

用法：
DAYTRADE1 模型中写入该函数，信号和资金每天重新初始化进行计算，与历史割裂，并且每一个函数只使用当日K线数据进行计算，历史数据不参与计算。

注：
1、该函数适用于小时、分钟以下周期，不支持日、自定义N日、周、月、季、年周期。
2、回测报告的出金/入金为日内的出金/入金的和。
3、不同函数对当天数据的引用不同，使用时需注意函数用法，如：
MA(X,N)函数N的取值：当天如果k线小于N根，则返回空值。如果k线为大于等于N根，则取N。
HHV(X,N)函数N的取值：当天如果k线小于N根，则返回实际根数，如果k线为大于等于N根，则取N。
4、模型中不能同时使用DAYTRADE1\DAYTRADE\WEEKTRADE\WEEKTRADE1\MONTHTRADE\QUARTERTRADE\YEARTRADE函数。
5、（1）历史回测中，当日K线走完持仓大于0，会对持仓进行全清处理。
   （2）模组运行中，当日K线走完持仓大于0，信号和资金会重新初始化进行计算，但不会自动对持仓进行全清处理，需要在模型中编写实现全清。

例：
MA5^^MA(C,5);
MA10^^MA(C,10);
CROSSUP(MA5,MA10),BK;//5周期均线上穿10周期均线，买开仓
CROSSDOWN(MA5,MA10),SK;//5周期均线下穿10周期均线，卖开仓
C<BKPRICE-10*MINPRICE,SP;//亏损10点平多
C>SKPRICE+10*MINPRICE,BP;//亏损10点平空
CLOSEMINUTE<=1,CLOSEOUT;//收盘前一分钟，清仓。
AUTOFILTER;//一开一平信号过滤模型
DAYTRADE1;//只用日内数据进行计算
```

### MONTHTRADE

月内交易函数

```pascal
MONTHTRADE 月内交易函数。

用法：
MONTHTRADE 模型中写入该函数，信号和资金每月重新初始化进行计算，与历史割裂。

注：
1、该函数不支持自定义N日、月、季、年周期，其他周期均支持。
2、回测报告中的出金/入金，为每月出金/入金的和。
3、模型中不能同时使用DAYTRADE1\DAYTRADE\WEEKTRADE\WEEKTRADE1\MONTHTRADE\QUARTERTRADE\YEARTRADE函数。
4、（1）历史回测中，当月K线走完持仓大于0，会对持仓进行全清处理。
   （2）模组运行中，当月K线走完持仓大于0，信号和资金会重新初始化进行计算，但不会自动对持仓进行全清处理，需要在模型中编写实现全清。

例：
MA5^^MA(C,5);
MA10^^MA(C,10);
CROSSUP(MA5,MA10),BK;//5周期均线上穿10周期均线，买开仓
CROSSDOWN(MA5,MA10),SK;//5周期均线下穿10周期均线，卖开仓
C<BKPRICE-10*MINPRICE,SP;//亏损10点平多
C>SKPRICE+10*MINPRICE,BP;//亏损10点平空
CLOSEMINUTE<=1,CLOSEOUT;//收盘前一分钟，清仓。
AUTOFILTER;//一开一平信号过滤模型
MONTHTRADE;//使用每月数据计算
```

### MONTHTRADE1

月内交易函数

```pascal
MONTHTRADE1 月内交易函数。

用法：
MONTHTRADE1 模型中写入该函数，信号和资金每月重新初始化进行计算，与历史割裂，并且每一个函数只使用当月K线数据进行计算，历史数据不参与计算。

注：
1、该函数不支持自定义N日、月、季、年周期，其他周期均支持。
2、回测报告中的出金/入金，为每月出金/入金的和。
3、模型中不能同时使用DAYTRADE1\DAYTRADE\WEEKTRADE\WEEKTRADE1\MONTHTRADE\MONTHTRADE1\QUARTERTRADE\QUARTERTRADE1\YEARTRADE\YEARTRADE1函数。
4、（1）历史回测中，当月K线走完持仓大于0，会对持仓进行全清处理。
   （2）模组运行中，当月K线走完持仓大于0，信号和资金会重新初始化进行计算，但不会自动对持仓进行全清处理，需要在模型中编写实现全清。

例：
MA5^^MA(C,5);
MA10^^MA(C,10);
CROSSUP(MA5,MA10),BK;//5周期均线上穿10周期均线，买开仓
CROSSDOWN(MA5,MA10),SK;//5周期均线下穿10周期均线，卖开仓
C<BKPRICE-10*MINPRICE,SP;//亏损10点平多
C>SKPRICE+10*MINPRICE,BP;//亏损10点平空
CLOSEMINUTE<=1,CLOSEOUT;//收盘前一分钟，清仓。
AUTOFILTER;//一开一平信号过滤模型
MONTHTRADE1;//使用每月数据计算
```

### QUARTERTRADE

季内交易函数

```pascal
QUARTERTRADE 季内交易函数。

用法：
QUARTERTRADE 模型中写入该函数，信号和资金每季度重新初始化进行计算，与历史割裂。

注：
1、该函数不支持自定义N日、季、年周期，其他周期均支持。
2、回测报告中的出金/入金，为每季度出金/入金的和。
3、模型中不能同时使用DAYTRADE1\DAYTRADE\WEEKTRADE\WEEKTRADE1\MONTHTRADE\QUARTERTRADE\YEARTRADE函数。
4、（1）历史回测中，当季K线走完持仓大于0，会对持仓进行全清处理。
   （2）模组运行中，当季K线走完持仓大于0，信号和资金会重新初始化进行计算，但不会自动对持仓进行全清处理，需要在模型中编写实现全清。

例：
MA5^^MA(C,5);
MA10^^MA(C,10);
CROSSUP(MA5,MA10),BK;//5周期均线上穿10周期均线，买开仓
CROSSDOWN(MA5,MA10),SK;//5周期均线下穿10周期均线，卖开仓
C<BKPRICE-10*MINPRICE,SP;//亏损10点平多
C>SKPRICE+10*MINPRICE,BP;//亏损10点平空
CLOSEMINUTE<=1,CLOSEOUT;//收盘前一分钟，清仓。
AUTOFILTER;//一开一平信号过滤模型
QUARTERTRADE;//使用每季度数据计算
```

### QUARTERTRADE1

季内交易函数

```pascal
QUARTERTRADE1 季内交易函数。

用法：
QUARTERTRADE1 模型中写入该函数，信号和资金每季重新初始化进行计算，与历史割裂，并且每一个函数只使用当季K线数据进行计算，历史数据不参与计算。

注：
1、该函数不支持自定义N日、季、年周期，其他周期均支持。
2、回测报告中的出金/入金，为每季度出金/入金的和。
3、模型中不能同时使用DAYTRADE1\DAYTRADE\WEEKTRADE\WEEKTRADE1\MONTHTRADE\MONTHTRADE1\QUARTERTRADE\QUARTERTRADE1\YEARTRADE\YEARTRADE1函数。
4、（1）历史回测中，当季K线走完持仓大于0，会对持仓进行全清处理。
   （2）模组运行中，当季K线走完持仓大于0，信号和资金会重新初始化进行计算，但不会自动对持仓进行全清处理，需要在模型中编写实现全清。

例：
MA5^^MA(C,5);
MA10^^MA(C,10);
CROSSUP(MA5,MA10),BK;//5周期均线上穿10周期均线，买开仓
CROSSDOWN(MA5,MA10),SK;//5周期均线下穿10周期均线，卖开仓
C<BKPRICE-10*MINPRICE,SP;//亏损10点平多
C>SKPRICE+10*MINPRICE,BP;//亏损10点平空
CLOSEMINUTE<=1,CLOSEOUT;//收盘前一分钟，清仓。
AUTOFILTER;//一开一平信号过滤模型
QUARTERTRADE1;//使用每季度数据计算
```

### TRADE_AGAIN

限制信号函数

```pascal
TRADE_AGAIN(N) 同一指令行可以连续出N个信号。

用法：
TRADE_AGAIN(N) 含有该函数的加减仓模型中,同一指令行可以连续出N个信号。

注：
1、该函数只适用于加减仓模型
2、模型中写入该函数，一根K线只支持一个信号。不可以和MULTSIG、MULTSIG_MIN、PANZHONG_MIN函数同时使用。
3、N个信号必须连续执行，如果期间出现其他信号，则N从新计算。
4、N不可以写为变量。

例：
C>O,BK(1);//K线为阳线，买开1手
C<O,SP(BKVOL);//K线为阴线，卖平多头持仓
TRADE_AGAIN(3);//同一指令行可以连续执行3次（如果连续三根阳线，则连续三次买开仓）
```

### WEEKTRADE

周内交易函数

```pascal
WEEKTRADE 周内交易函数。

用法：
模型中写入该函数，信号和资金每周重新初始化进行计算，与历史割裂。

注：
1、该函数不支持自定义N日、周、月、季、年周期，其他周期均支持。
2、回测报告中的出金/入金，为每周出金/入金的和。
3、模型中不能同时使用DAYTRADE1\DAYTRADE\WEEKTRADE\WEEKTRADE1\MONTHTRADE\QUARTERTRADE\YEARTRADE函数。
4、（1）历史回测中，当周K线走完持仓大于0，会对持仓进行全清处理。
   （2）模组运行中，当周K线走完持仓大于0，信号和资金会重新初始化进行计算，但不会自动对持仓进行全清处理，需要在模型中编写实现全清。

例：
MA5^^MA(C,5);
MA10^^MA(C,10);
CROSSUP(MA5,MA10),BK;//5周期均线上穿10周期均线，买开仓
CROSSDOWN(MA5,MA10),SK;//5周期均线下穿10周期均线，卖开仓
C<BKPRICE-10*MINPRICE,SP;//亏损10点平多
C>SKPRICE+10*MINPRICE,BP;//亏损10点平空
CLOSEMINUTE<=1,CLOSEOUT;//收盘前一分钟，清仓。
AUTOFILTER;//一开一平信号过滤模型
WEEKTRADE;//使用每周数据计算
```

### WEEKTRADE1

周内交易函数

```pascal
WEEKTRADE1 周内交易函数。

用法：
WEEKTRADE1 模型中写入该函数，信号和资金每周重新初始化进行计算，与历史割裂，并且每一个函数只使用当周K线数据进行计算，历史数据不参与计算。

注：
1、该函数适用于周以下周期，不支持自定义日、周、月、季、年周期。
2、回测报告的出金/入金为周内的出金/入金的和。
3、不同函数对当周数据的引用不同，使用时需注意函数用法，如：
MA(X,N)函数N的取值：当周如果k线小于N根，则返回空值。如果k线为大于等于N根，则取N。
HHV(X,N)函数N的取值：当天如果k线小于N根，则返回实际根数，如果k线为大于等于N根，则取N。
4、模型中不能同时使用DAYTRADE1\DAYTRADE\WEEKTRADE\WEEKTRADE1\MONTHTRADE\QUARTERTRADE\YEARTRADE函数。
5、（1）历史回测中，当周K线走完持仓大于0，会对持仓进行全清处理。
   （2）模组运行中，当周K线走完持仓大于0，信号和资金会重新初始化进行计算，但不会自动对持仓进行全清处理，需要在模型中编写实现全清。

例：
MA5^^MA(C,5);
MA10^^MA(C,10);
CROSSUP(MA5,MA10),BK;//5周期均线上穿10周期均线，买开仓
CROSSDOWN(MA5,MA10),SK;//5周期均线下穿10周期均线，卖开仓
C<BKPRICE-10*MINPRICE,SP;//亏损10点平多
C>SKPRICE+10*MINPRICE,BP;//亏损10点平空
CLOSEMINUTE<=1,CLOSEOUT;//收盘前一分钟，清仓。
AUTOFILTER;//一开一平信号过滤模型
WEEKTRADE1;//只用周内数据进行计算
```

### YEARTRADE

年内交易函数

```pascal
YEARTRADE 年内交易函数。

用法：
YEARTRADE 模型中写入该函数，信号和资金每年重新初始化进行计算，与历史割裂。

注：
1、该函数不支持年周期，其他周期均支持。
2、回测报告中的出金/入金，为每年出金/入金的和。
3、模型中不能同时使用DAYTRADE1\DAYTRADE\WEEKTRADE\WEEKTRADE1\MONTHTRADE\QUARTERTRADE\YEARTRADE函数。
4、（1）历史回测中，当年K线走完持仓大于0，会对持仓进行全清处理。
   （2）模组运行中，当年K线走完持仓大于0，信号和资金会重新初始化进行计算，但不会自动对持仓进行全清处理，需要在模型中编写实现全清。

例：
MA5^^MA(C,5);
MA10^^MA(C,10);
CROSSUP(MA5,MA10),BK;//5周期均线上穿10周期均线，买开仓
CROSSDOWN(MA5,MA10),SK;//5周期均线下穿10周期均线，卖开仓
C<BKPRICE-10*MINPRICE,SP;//亏损10点平多
C>SKPRICE+10*MINPRICE,BP;//亏损10点平空
CLOSEMINUTE<=1,CLOSEOUT;//收盘前一分钟，清仓。
AUTOFILTER;//一开一平信号过滤模型
YEARTRADE;//使用每年数据计算
```

### YEARTRADE1

年内交易函数

```pascal
YEARTRADE1 年内交易函数。

用法：
YEARTRADE1 模型中写入该函数，信号和资金每年重新初始化进行计算，与历史割裂，并且每一个函数只使用当年K线数据进行计算，历史数据不参与计算。

注：
1、该函数不支持年周期，其他周期均支持。
2、回测报告中的出金/入金，为每年出金/入金的和。
3、模型中不能同时使用DAYTRADE1\DAYTRADE\WEEKTRADE\WEEKTRADE1\MONTHTRADE\MONTHTRADE1\QUARTERTRADE\QUARTERTRADE1\YEARTRADE\YEARTRADE1函数。
4、（1）历史回测中，当年K线走完持仓大于0，会对持仓进行全清处理。
   （2）模组运行中，当年K线走完持仓大于0，信号和资金会重新初始化进行计算，但不会自动对持仓进行全清处理，需要在模型中编写实现全清。

例：
MA5^^MA(C,5);
MA10^^MA(C,10);
CROSSUP(MA5,MA10),BK;//5周期均线上穿10周期均线，买开仓
CROSSDOWN(MA5,MA10),SK;//5周期均线下穿10周期均线，卖开仓
C<BKPRICE-10*MINPRICE,SP;//亏损10点平多
C>SKPRICE+10*MINPRICE,BP;//亏损10点平空
CLOSEMINUTE<=1,CLOSEOUT;//收盘前一分钟，清仓。
AUTOFILTER;//一开一平信号过滤模型
YEARTRADE1;//使用每年数据计算
```

## 信号记录函数

### AVAILABLE_OPI

可用手数

```pascal
AVAILABLE_OPI 可用手数

用法：
该函数取值为股票合约的当前可用手数

注：
1、该函数只支持股票市场
2、当日买入手数不计入该函数取值

例1
MA5:MA(C,5);
MA10:MA(C,10);
CROSSUP(MA5,MA10),BK(100);
AVAILABLE_OPI>0&&CROSSDOWN(MA5,MA10),SP(AVAILABLE_OPI);//当前可用手数大于0，并且5日均线下穿10日均线，卖出全部可用手数
```

### BARSBK

上一次买开信号位置

```pascal
BARSBK 上一次买开信号位置

用法：
BARSBK返回上一次买开仓的K线距离当前K线的周期数（不包含出现BK信号的那根K线）
取包含BK信号出现的那根K线到当前K线的周期数，则需要在此函数后+1，即BARSBK+1；由于发出BK信号的当根k线BARSBK返回空值，则BARSBK+1在发出BK信号当根k线返回空值。

注：
1、若当前K线之前无BK信号，则函数返回值为空值
2、BK信号固定后BARSBK返回为空值。
（1）设置信号执行方式为K线走完确认信号下单
BARSBK返回值为上一个BK信号距离当前的K线根数（包含当前K线）
（2）设置信号执行方式为出信号立即下单，不复核（例如：在模型中写入MULTSIG或MULTSIG_MIN;）
    a.历史信号计算中，出现BK信号的当根K线，BARSBK返回空值
    b.加载运行过程中,信号固定后BARSBK返回空值
（3）设置信号执行方式为K线走完复核（例如：在模型中写入CHECKSIG(BK,'A',N,'D',0,0);）
BARSBK返回值为上一个BK信号距离当前的K线根数（包含当前K线）

例：
1、BARSBK>10,SP;//上一次买开仓（不包含出现买开信号的那根K线）距离当前K线的周期数大于10，卖平；
2、HHV(H,BARSBK+1);//上一次买开仓（包含开仓信号出现的当根k线）到当前的最高价的最大值。
当根K线出现BK信号，AA返回为空值，需要返回当根K线上最高价，模型需要修改为:
AA:IFELSE(BARSBK>=1,HHV(H,BARSBK+1),H);
（1）当根K线出现BK信号，BARSBK返回为空值，不满足BARSBK>=1的条件，则取值为当根K线的最高价H
（2）发出BK信号之后K线BARSBK返回买开仓的K线距离当前K线的周期数，满足BARSBK>=1的条件，则取值为HHV(H,BARSBK+1)，即买开仓（包含开仓信号出现的当根k线）到当前的最高价的最大值。
修改后如果平仓条件中用到了AA的值，当根K线满足了平仓条件，可以出现平仓信号
3、AA:IFELSE(BARSBK>=1,REF(C,BARSBK),C);//取最近一次买开仓K线的收盘价
（1）发出BK信号的当根k线BARSBK返回空值,则当根K线不满足BARSBK>=1的条件，AA返回当根k线的收盘价；
（2）发出BK信号之后的k线BARSBK返回买开仓的K线距离当前K线的周期数，则AA返回REF(C,BARSBK)，即开仓k线的收盘价；
（3）例：1、2、3三根k线，1 K线为开仓信号的当根k线，则返回当根k线的收盘价，2、3 K线AA返回值为 1 K线的收盘价。
```

### BARSBP

上一次买平信号位置

```pascal
BARSBP 上一次买平信号位置

用法：
BARSBP返回上一次买平仓的K线距离当前K线的周期数（不包含出现BP信号的那根K线）
取包含BP信号出现的那根K线到当前K线的周期数，则需要在此函数后+1，即BARSBP+1。由于发出BP信号的当根k线BARSBP返回空值，则BARSBP+1在发出BP信号当根k线返回空值。

注：
1、若当前K线之前无BP信号，则函数返回值为空值
2、BP信号固定后BARSBP返回为空值。
（1）设置信号执行方式为K线走完确认信号下单
BARSBP返回值为上一个BP信号距离当前的K线根数（包含当前K线）
（2）设置信号执行方式为出信号立即下单，不复核（例如：在模型中写入MULTSIG或MULTSIG_MIN;）
    a.历史信号计算中，出现BP信号当根K线，BARSBP返回空值
    b.加载运行过程中，BP信号当根K线,信号固定后BARSBP返回空值
（3）设置信号执行方式为K线走完复核（例如：在模型中写入CHECKSIG(BP,'A',N,'D',0,0);）
BARSBP返回值为上一个BP信号距离当前的K线根数（包含当前K线）

例：
1、BARSBP>10,BK;//上一次买平仓（不包含出现买平信号的那根K线）距离当前K线的周期数大于10，买开。
2、AA:HHV(H,BARSBP+1);//上一次买平仓（包含平仓信号出现的当根k线）到当前的最高价的最大值。
当根K线出现BP信号，AA返回为空值，如果需要返回当根K线上最高价，模型需要修改为:
AA:IFELSE(BARSBP>=1,HHV(H,BARSBP+1),H);
（1）当根K线出现BP信号，BARSBP返回为空值，不满足BARSBP>=1的条件，则取值为当根K线的最高价H
（2）发出BP信号之后K线BARSBP返回买平仓的K线距离当前K线的周期数，满足BARSBP>=1的条件，则取值为HHV(H,BARSBP+1)，即买平仓（包含平仓信号出现的当根k线）到当前的最高价的最大值。
3、AA:IFELSE(BARSBP>=1,REF(C,BARSBP),C);//取最近一次买平仓K线的收盘价
（1）发出BP信号的当根k线BARSBP返回空值,则当根K线不满足BARSBP>=1的条件，AA返回当根k线的收盘价；
（2）发出BP信号之后的k线BARSBP返回买平仓的K线距离当前K线的周期数，则AA返回REF(C,BARSBP)，即平仓k线的收盘价；
（3）例：1、2、3三根k线，1 K线为平仓信号的当根k线，则返回当根k线的收盘价，2、3 K线AA返回值为 1 K线的收盘价。
```

### BARSSK

上一次卖开信号位置

```pascal
BARSSK 上一次卖开信号位置

用法：
BARSSK返回上一次卖开仓的K线距离当前K线的周期数（不包含出现SK信号的那根K线）
取包含SK信号出现的那根K线到当前K线的周期数，需要在此函数后+1，即BARSSK+1；由于发出SK信号的当根k线BARSSK返回空值，则BARSSK+1在发出SK信号当根k线返回空值。

注：
1、若当前K线之前无SK信号，则函数返回值为空值
2、SK信号固定后BARSSK返回为空值。
（1）设置信号执行方式为K线走完确认信号下单
BARSSK返回值为上一个SK信号距离当前的K线根数（包含当前K线）
（2）设置信号执行方式为出信号立即下单，不复核（例如：在模型中写入MULTSIG或MULTSIG_MIN;）
    a.历史信号计算中，出现SK信号当根K线，BARSSK返回空值
    b.加载运行过程中，SK信号当根K线,信号固定后BARSSK返回空值
（3）设置信号执行方式为K线走完复核（例如：在模型中写入CHECKSIG(SK,'A',N,'D',0,0);）
BARSSK返回值为上一个SK信号距离当前的K线根数（包含当前K线）

例：
1、BARSSK>10,BP;//上一次卖开仓（不包含出现买开信号的那根K线）距离当前K线的周期数大于10，买平；
2、LLV(L,BARSSK+1);//上一次卖开仓（包含开仓信号出现的当根k线）到当前的最低价的最小值。
当根K线出现SK信号，AA返回为空值，如果需要返回当根K线上最低价，模型需要修改为:
AA:IFELSE(BARSSK>=1,LLV(L,BARSSK+1),L);
（1）当根K线出现SK信号，BARSSK返回为空值，不满足BARSSK>=1的条件，则取值为当根K线的最低价L
（2）发出SK信号之后K线SARSBK返回卖开仓的K线距离当前K线的周期数，满足BARSSK>=1的条件，则取值为LLV(L,BARSSK+1)，即卖开仓（包含开仓信号出现的当根k线）到当前的最低价的最小值。
修改后如果平仓条件中用到了AA的值，当根K线满足了平仓条件，可以出现平仓信号。
3、AA:IFELSE(BARSSK>=1,REF(C,BARSSK),C);//取最近一次卖开仓K线的收盘价
（1）发出SK信号的当根k线BARSSK返回空值,则当根K线不满足BARSSK>=1的条件，AA返回当根k线的收盘价；
（2）发出SK信号之后的k线BARSSK返回卖开仓的K线距离当前K线的周期数，则AA返回REF(C,BARSSK)，即开仓k线的收盘价；
（3）例：1、2、3三根k线，1K线为开仓信号的当根k线，则返回当根k线的收盘价，2、3K线AA返回值为1K线的收盘价。
```

### BARSSP

上一次卖平信号位置

```pascal
BARSSP 上一次卖平信号位置

用法：
BARSSP返回上一次卖平仓的K线距离当前K线的周期数（不包含出现SP信号的那根K线）
取包含SP信号出现的那根K线到当前K线的周期数，则需要在此函数后+1，即BARSSP+1。由于发出SP信号的当根k线BARSSP返回空值，则BARSSP+1在发出SP信号当根k线返回空值。

注：
1、若当前K线之前无SP信号，则函数返回值为空值
2、SP信号固定后BARSSP返回为空值。
（1）设置信号执行方式为K线走完确认信号下单
BARSBP返回值为上一个BP信号距离当前的K线根数（包含当前K线）
（2）设置信号执行方式为出信号立即下单，不复核（例如：在模型中写入MULTSIG或MULTSIG_MIN;）
    a.历史信号计算中，出现SP信号当根K线，BARSSP返回空值
    b.加载运行过程中，SP信号当根K线,信号固定后BARSSP返回空值
（3）设置信号执行方式为K线走完复核（例如：在模型中写入CHECKSIG(SP,'A',N,'D',0,0);）
BARSSP返回值为上一个SP信号距离当前的K线根数（包含当前K线）

例：
1、BARSSP>10,BK;//上一次卖平仓（不包含出现卖平信号的那根K线）距离当前K线的周期数大于10，买开。
2、AA:HHV(H,BARSSP+1);//上一次，卖平仓（包含平仓信号出现的当根k线）到当前的最高价的最大值。
当根K线出现SP信号，AA返回为空值，如果需要返回当根K线上最高价，模型需要修改为:
AA:IFELSE(BARSSP>=1,HHV(H,BARSSP+1),H);
（1）当根K线出现SP信号，BARSSP返回为空值，不满足BARSSP>=1的条件，则取值为当根K线的最高价H
（2）发出SP信号之后K线BARSSP返回买平仓的K线距离当前K线的周期数，满足BARSSP>=1的条件，则取值为HHV(H,BARSSP+1)，即卖平仓（包含平仓信号出现的当根k线）到当前的最高价的最大值。
3、AA:IFELSE(BARSSP>=1,REF(C,BARSSP),C);//取最近一次卖平仓K线的收盘价
（1）发出SP信号的当根k线BARSSP返回空值,则当根K线不满足BARSSP>=1的条件，AA返回当根k线的收盘价；
（2）发出SP信号之后的k线BARSSP返回卖平仓的K线距离当前K线的周期数，则AA返回REF(C,BARSSP)，即平仓k线的收盘价；
（3）1、2、3三根k线，1 K线为平仓信号的当根k线，则返回当根k线的收盘价，2、3 K线AA返回值为 1 K线的收盘价
```

### BKHIGH

返回数据合约买开仓以来的最高价

```pascal
返回数据合约买开仓以来的最高价
用法：
BKHIGH返回数据合约最近一次模型买开位置到当前的最高价。
1、不同信号执行方式，其返回值分别为：
（1）信号执行方式为K线走完确认信号下单
a.历史信号计算中，BK(BPK)信号之后的K线返回委托以来的数据合约行情的最高价
b.加载运行过程中，BK(BPK)信号当根K线返回的为信号发出时数据合约行情的最新价，BK之后的K线返回委托以来的数据合约行情最高价
（2）信号执行方式选择K线走完复核（例如：在模型中写入CHECKSIG(BK,'A',0,'D',0,0);）
从BK(BPK)信号发出时开始统计数据合约行情的最高价；信号消失，返回上次买开以来的数据合约行情的最高价，信号确认存在，返回当根K线记录的数据合约行情的最高价
注：BK信号发出后，中间出了信号消失，从最后一次信号出现开始统计数据合约最高价
（3）信号执行方式选择不进行信号复核（例如：在模型中写入MULTSIG或MULTSIG_MIN;）
BK(BPK)信号的当根K线返回从信号发出到K线走完时数据合约行情的最高价；BK(BPK)信号之后的K线返回信号发出以来数据合约行情的最高价。
2、主连合约使用换月移仓函数，主力合约切换后，从新的主力合约第一根K线开盘价重新开始统计
3、模组重新初始化后，数据合约和交易合约相同，则BKGIGH返回初始化后的最高价与初始化弹出框中填入的持仓价相比较后较大的数值；数据合约与交易合约不同时，则BKHIGH返回初始化后的最高价与初始化弹出框中填入的数据合约信号价相比较后较大的数值。

例：
C>O,BK;
C>BKPRICE&&C<BKHIGH-5,SP;
AUTOFILTER;//最新价低于买开仓以来的数据合约最高价5个点，止盈平仓。
```

### BKLOW

返回数据合约买开仓以来的最低价

```pascal
返回数据合约买开仓以来的最低价
用法：
BKLOW返回数据合约最近一次模型买开位置到当前的最低价。
1、不同信号执行方式，其返回值分别为：
（1）K线走完确认信号下单
a.历史信号计算中，BK(BPK)信号之后的K线返回委托以来的数据合约行情的最低价
b.加载运行过程中，BK(BPK)信号当根K线返回的为信号发出时数据合约行情的最新价，BK之后的K线返回委托以来的数据合约行情最低价
（2）信号执行方式选择K线走完复核（例如：在模型中写入CHECKSIG(BK,'A',0,'D',0,0);）
从BK(BPK)信号发出时行情时开始统计数据合约行情的最低价；信号消失，返回上次买开以来的数据合约行情的最低价，信号确认存在，返回当根K线记录的数据合约行情的最低价
注：BK信号发出后，中间出了信号消失，从最后一次信号出现开始统计数据合约最低价
（3）信号执行方式选择不进行信号复核（例如：在模型中写入MULTSIG或MULTSIG_MIN;）
BK(BPK)信号的当根K线返回的从信号发出到K线走完时数据合约行情的最低价；BK(BPK)信号之后的K线返回信号发出以来数据合约行情的最低价。
2、主连合约使用换月移仓函数，主力合约切换后，从新的主力合约第一根K线开盘价重新开始统计
3、模组重新初始化后，数据合约和交易合约相同，则BKLOW返回初始化后的最低价与初始化弹出框中填入的持仓价相比较后较小的数值；数据合约与交易合约不同时，则BKLOW返回初始化后的最低价与初始化弹出框中填入的数据合约信号价相比较后较小的数值。

例：
C>O,BK;
C>BKLOW+5,SP;
AUTOFILTER;//最新价高于买开仓以来数据合约的最低价5个点，平仓。
```

### BKPRICE

返回数据合约最近一次买开信号价位

```pascal
BKPRICE 返回数据合约最近一次买开信号价位。

用法：
BKPRICE 返回数据合约最近一次买开信号发出时的行情的最新价。

注：
1、当数据合约和交易合约相同时BKPRICE值和BKPRICE1值相等。
2、当模型存在连续多个开仓信号(加仓)的情况下，该函数返回的是最近一次开仓信号的价格,而不是开仓均价。
3、不同信号执行方式，其返回值分别为：
（1）信号执行方式为不进行信号复核
a.历史回测：BKPRICE返回信号发出时的数据合约行情最新价
b.模组运行：BKPRICE返回信号发出时的数据合约行情最新价
（2）信号执行方式选择K线走完确认信号下单
a.历史回测：BKPRICE返回信号发出时数据合约当根K线的收盘价
b.模组运行：BKPRICE返回信号发出时数据合约当根K线的收盘价
（3）信号执行方式设置为K线走完进行信号复核
a.历史回测：BKPRICE返回信号发出时数据合约当根K线的收盘价
b.模组运行：复核前，返回上一次BK信号当根K线数据合约的行情最新价；复核后，返回本次BK信号当根K线数据合约的行情最新价
4、模组头寸同步后，BKPRICE的值不变，仍然返回上一次买开信号时数据合约行情的最新价。
5、模组重新初始化后，数据合约和交易合约相同，则BKPRICE返回为初始化弹出框中填入的持仓价格；数据合约与交易合约不同时，则BKPRICE返回初始化弹出框中填入的数据合约信号价。
6、加载在主连合约上，使用了换月移仓函数，主力换月后BKPRCIE取值为新的主力合约的第一根K线的开盘价

例:
BKPRICE-CLOSE>60 && BKPRICE>0 && BKVOL>0, SP;//如果买开价位比当前价位高出60,且多头持仓存在，卖平仓。
```

### BKPRICE1

返回交易合约最近一次买开信号价位

```pascal
BKPRICE1 返回交易合约最近一次买开信号价位。

用法：
BKPRICE1：返回交易合约最近一次买开信号发出时的行情的最新价。

注：
1、当数据合约和交易合约相同时BKPRICE值和BKPRICE1值相等。
2、当数据合约和交易合约不同时，不同信号执行方式，其返回值分别为：
（1）信号执行方式为不进行信号复核
a.历史回测：BKPRICE1返回信号发出时的交易合约行情最新价
b.模组运行：BKPRICE1返回信号发出时的交易合约行情最新价
（2）信号执行方式选择K线走完确认信号下单
a.历史回测：BKPRICE1返回信号发出时交易合约当根K线的收盘价
b.模组运行：BKPRICE1返回信号发出时交易合约当根K线的收盘价
（3）信号执行方式设置为K线走完进行信号复核
a.历史回测：BKPRICE1返回信号发出时交易合约当根K线的收盘价
b.模组运行：复核前，返回上一次BK信号当根K线交易合约的行情最新价；复核后，返回本次BK信号当根K线交易合约的行情最新价
3、模组头寸同步后，BKPRICE1的值不变，仍然返回上一次买开信号时交易合约行情的最新价；模组重新初始化后，BKPRICE1返回为初始化弹出框中填入的持仓价格。
4、加载在指数/主连合约上，使用了换月移仓函数，主力换月后BKPRCIE1取值为新的主力合约的第一根K线的开盘价
```

### BKPRICEAV

返回数据合约多头开仓均价

```pascal
BKPRICEAV 返回数据合约多头开仓均价。

用法：
BKPRICEAV 返回数据合约多头开仓均价。

注：
1、一开一平信号过滤模型：
（1）开仓信号后，未出平仓信号时：BKPRICEAV取值和BKPRICE取值相同。
（2）平仓信号后：BKPRICEAV返回值为0。
2、加减仓模型：
（1）持仓不为0时：BKPRICEAV返回数据合约理论持仓的开仓均价。
（2）加减仓模型持仓为0时：BKPRICEAV返回值为0。
3、该函数在模组运行和回测中都读取的是模组理论持仓的开仓均价，非实际持仓开仓均价。
4、模组重新初始化后，数据合约和交易合约相同，则BKPRICEAV计算取初始化弹出框中填入的持仓价格；数据合约与交易合约不同时，则BKPRICEAV计算取初始化弹出框中填入的数据合约信号价。

注：
该函数的计算考虑滑点。

例：
CLOSE-BKPRICEAV>60,SP(BKVOL);//当前价位比多头开仓均价高出60,平掉所有多头持仓
```

### BKPRICEAV1

返回交易合约多头开仓均价

```pascal
BKPRICEAV1 返回交易合约多头开仓均价

用法：
BKPRICEAV1 返回交易合约多头开仓均价

注：
1、当模型存在连续多个开仓信号(加仓)的情况下，该函数返回的是交易合约开仓均价。
2、当数据合约和交易合约相同时BKPRICEAV值和BKPRICEAV1值相等。
3、一开一平信号过滤模型：
（1）开仓信号后，未出平仓信号时：BKPRICEAV1取值和BKPRICE1取值相同。
（2）平仓信号后：BKPRICEAV1返回值为0。
4、加减仓模型：
（1）持仓不为0时：BKPRICEAV1返回交易合约理论持仓的开仓均价。
（2）加减仓模型持仓为0时：BKPRICEAV返回值为0。

注：
该函数的计算考虑滑点。

例：
CLOSE-BKPRICEAV1>60,SP(BKVOL);//当前价位比交易合约多头开仓均价高出60,平掉所有多头持仓
```

### BKVOL

买开信号手数

```pascal
买开信号手数
用法：
BKVOL返回模型当前的多头理论持仓。
1、加载运行：
（1）模组子账户初始化后，BKVOL仍然返回根据信号下单手数计算的理论持仓，不受账户持仓的影响。
（2）模组运行中手动调仓，头寸同步修改持仓，BKVOL返回值不变，仍然返回根据信号下单手数计算的理论持仓。
（3）页面盒子运行中，BKVOL不受资金情况的限制，按照信号显示开仓手数。
2、回测、模组运行中：
（1）如果资金不够开仓，开仓手数为0，BKVOL返回值为0。
（2）BK（BPK）信号出现并且确认固定后，BKVOL的取值增加开仓手数的数值；SP（SPK）信号出现并且确认固定后，BKVOL的取值减少平仓手数的数值。

例：
BKVOL=0&&C>O,BK(1);//多头理论持仓为0并且收盘价大于开盘价时，买开一手
BKVOL>=1&&H>HV(H,5),BK(2); //多头持仓大于等于1，并且当根K线的最高价大于前面5个周期中最高价中最大值时，加仓2手
BKVOL>0&&L<REF(L,5),SP(BKVOL); //多头持仓大于0，并且当根K线的最低价小于5个周期前K线的最低价时，卖平所有多头持仓
```

### BKVOL2

买开信号手数

```pascal
买开信号手数
用法：
BKVOL2返回模型当前的多头持仓。
1、加载运行：
（1）模组子账户初始化后，BKVOL2返回的理论持仓仍然延续，返回模型信号手数，不受账户持仓的影响。
（2）页面盒子和模组加载中，BKVOL2不受资金情况的限制，按照信号显示开仓手数。
（3）模组运行过程中BK（BPK）信号出现并且确认固定后，BKVOL2的取值增加开仓手数的数值；SP（SPK）信号出现并且确认固定后，BKVOL2的取值减少平仓手数的数值。
2、回测：
（1）BKVOL2不受资金情况的限制，按照信号显示开仓手数。
（2）BK（BPK）信号出现并且确认固定后，BKVOL2的取值增加开仓手数的数值；SP（SPK）信号出现并且确认固定后，BKVOL2的取值减少平仓手数的数值。

例：
BKVOL2=0&&C>O,BK(1);//多头持仓为0并且收盘价大于开盘价时，买开一手
BKVOL2>=1&&H>HV(H,5),BK(2); //多头持仓大于等于1，并且当根K线的最高价大于前面5个周期中最高价中最大值时，加仓2手
BKVOL2>0&&L<REF(L,5),SP(BKVOL2); //多头持仓大于0，并且当根K线的最低价小于5个周期前K线的最低价时，卖平所有多头持仓
```

### COUNTSIG

统计 N 周期内，X 信号的数量

```pascal
COUNTSIG(X,N); 统计N周期内，X信号的数量；

用法：
X可以为BK、SK、SP、BP、SPK、BPK、CLOSEOUT、STOP

注：
1、统计周期时，
（1）包含当前k线；
（2）若N为0则从第一个有效值算起；
（3）当N为有效值，但当前的k线数不足N根，从第一根统计到当前周期。
（4）N 为空值时返回值为空值 。
（5）N可以为变量
2、统计信号时：
（1）信号执行方式选择为K线走完确认信号或者K线走完复核（例如：在模型中写入CHECKSIG(SIG,'A',0,'D',0,0);），不包含当根K线上未固定的信号，即返回已经固定的信号个数
（2）信号执行方式选择为不进行信号复核（例如：在模型中写入MULTSIG或MULTSIG_MIN;），包含当根K线上信号发出并且固定后的信号
3、由BPK指令产生的BK信号按BPK信号处理，SPK指令产生的SK信号同理。

例：
N:=BARSLAST(DATE<>REF(DATE,1))+1;
BKN:=COUNTSIG(BK,N);
MA5:=MA(C,5);
BKN=0&&C>MA5,BK;//当日内日未出现过BK信号并且最新价大于5周期均线，则买开仓
```

### ENTRYSIG_PLACE

取指定开仓信号的 K 线位置

```pascal
ENTRYSIG_PLACE(N) 取一次完整交易中第N个开仓信号所在K线的位置。

用法：ENTRYSIG_PLACE(N) 取一次完整交易中第N个开仓信号所在K线的位置。如果没有开仓信号，则该函数返回空值。

注：
1、开仓信号有：BK,SK,BPK,SPK
2、从开仓到持仓为0被视为一次完整交易。
3、一次完整交易中开仓信号个数小于N时，该函数返回空值。
4、K线位置是指当前K线到指定开仓信号所在K线的根数。
5、N为0或空值时，该函数返回空值。
6、参数N不支持为变量。

例：
ENTRYSIG_PLACE(3)=5&&BKVOL>0,SP;//如果第3个开仓信号所在K线距离当前K线有5根K线，并且多头持仓大于0，卖平仓
```

### ENTRYSIG_PRICE

取指定开仓信号的价格

```pascal
ENTRYSIG_PRICE(N) 取一次完整交易中第N个开仓信号的价格。

用法：ENTRYSIG_PRICE(N) 取一次完整交易中第N个开仓信号的价格。如果没有开仓信号，则该函数返回空值。

注：
1、开仓信号有：BK,SK,BPK,SPK
2、从开仓到持仓为0被视为一次完整交易。
3、一次完整交易中开仓信号个数小于N时，该函数返回空值。
4、N为0或空值时，该函数返回空值。
5、参数N不支持为变量。
6、该函数的计算包含滑点
7、收盘价模型：在指定信号的当根K线函数的取值不会发生变化；
   指令价模型：在指定信号的当根K线返回当次交易第N个开仓信号的价格。

例：
ENTRYSIG_PRICE(3)=3000&&BKVOL>0,SP;//如果第3个固定的开仓信号的开仓价位为3000，并且多头持仓大于0，卖平仓
```

### ENTRYSIG_VOL

取指定开仓信号的信号手数

```pascal
ENTRYSIG_VOL(N) 取一次完整交易中第N个开仓信号的信号手数。

用法：ENTRYSIG_VOL(N) 取一次完整交易中第N个开仓信号的信号手数。如果没有开仓信号，则该函数返回空值。

注：
1、开仓信号有：BK,SK,BPK,SPK
2、从开仓到持仓为0被视为一次完整交易。
3、一次完整交易中开仓信号个数小于N时，该函数返回空值。
4、N为0或空值时，该函数返回空值。
5、参数N不支持为变量。
6、收盘价模型：在指定信号的当根K线函数的取值不会发生变化；
   指令价模型：在指定信号的当根K线返回当次交易第N个开仓信号的信号手数。

例：
ENTRYSIG_PRICE(3)=3000&&ENTRYSIG_VOL(3)>2,SP;//如果第3个固定的开仓信号的开仓价位为3000，并且第3个固定的开仓信号的信号手数大于2，卖平仓
```

### EXITSIG_PLACE

取指定平仓信号的 K 线位置

```pascal
EXITSIG_PLACE(N) 取一次完整交易中第N个平仓信号所在K线的位置。

用法：EXITSIG_PLACE(N) 取一次完整交易中第N个平仓信号所在K线的位置。如果没有平仓信号，则该函数返回空值。

注：
1、平仓信号有：BP,SP,CLOSEOUT,STOP
2、从开仓到持仓为0被视为一次完整交易。
3、平仓信号个数小于N时，该函数返回空值。
4、K线位置是指当前K线到指定平仓信号所在K线的根数。
5、N为0或空值时，该函数返回空值。
6、参数N不支持为变量。

例：
EXITSIG_PLACE(3)=5&&BKVOL<=0,BK;//如果第3个平仓信号所在K线距离当前K线有5根K线，并且没有多头持仓，买开仓
```

### EXITSIG_PRICE

取指定平仓信号的价格

```pascal
EXITSIG_PRICE(N) 取一次完整交易中第N个平仓信号的价格。

用法：EXITSIG_PRICE(N) 取一次完整交易中第N个平仓信号的价格。如果没有平仓信号，则该函数返回空值。

注：
1、平仓信号有：BP,SP,CLOSEOUT,STOP
2、从开仓到持仓为0被视为一次完整交易。
3、一次完整交易中平仓信号个数小于N时，该函数返回空值。
4、N为0或空值时，该函数返回0。
5、参数N不支持为变量。
6、该函数的计算包含滑点
7、收盘价模型：在指定信号的当根K线函数的取值不会发生变化；
   指令价模型：在指定信号的当根K线返回当次交易第N个平仓信号的价格。

例：
EXITSIG_PRICE(3)=3000&&BKVOL>0,SP;//如果第3个固定的平仓信号的平仓价位为3000，并且多头持仓大于0，卖平仓
```

### EXITSIG_VOL

取指定平仓信号的信号手数

```pascal
EXITSIG_VOL(N) 取一次完整交易中第N个平仓信号的信号手数。

用法：EXITSIG_VOL(N) 取一次完整交易中第N个平仓信号的信号手数。如果没有平仓信号，则该函数返回空值。

注：
1、平仓信号有：BP,SP,CLOSEOUT,STOP
2、从开仓到持仓为0被视为一次完整交易。
3、一次完整交易中平仓信号个数小于N时，该函数返回空值。
4、N为0或空值时，该函数返回0。
5、参数N不支持为变量。
6、收盘价模型：在指定信号的当根K线函数的取值不会发生变化；
   指令价模型：在指定信号的当根K线返回当次交易第N个平仓信号的信号手数。

例：
EXITSIG_PRICE(3)=3000&&EXITSIG_VOL(3)>2,BK;//如果第3个固定的平仓信号的平仓价位为3000，并且第3个固定的平仓信号的信号手数大于2，买开仓
```

### GROUP

判断分组的组别

```pascal
GROUP('group') 判断分组的组别。

注：
1、参数group为A—I分别返回1-9。
2、与LASTSIGGROUP函数配合使用，可以判断最后一个信号所在的组别。

例：
CROSS(C,MA(C,5)),BK('A',1);//最新价上穿五周期均线，A组做多一手
CROSS(MA(C,5),C),SP('A',BKVOL);//最新价下穿五周期均线，A组平仓
CROSS(C,MA(C,10)),BK('B',2);//最新价上穿十周期均线，B组做多两手
LASTSIG=200&&LASTSIGGROUP=GROUP('B'),SP('B',BKVOL);//上一个信号是B组的BK信号，则B组平仓
```

### GROUPBKVOL

指令分组模型买开信号手数

```pascal
GROUPBKVOL('letter') 取指令分组模型letter组的买开信号手数。

用法：
GROUPBKVOL('A')返回指令分组模型组A的多头模组持仓。
参数可以取从A-I

注：
相应组的买开信号后，GROUPBKVOL('A')增加，即BK('A'),BPK('A'),BK('A',1)后GROUPBKVOL('A')增加，其他组的开仓信号，GROUPBKVOL('A')取值不变
相应组的卖平信号后，GROUPBKVOL('A')取值相应的减少，即SP('A'),SPK('A'),SP('A',1)后，GROUPBKVOL('A')取值减少，其他组的平仓信号后，GROUPBKVOL('A')取值不变
全清信号后，GROUPBKVOL('A')取值减为0

例：
MA1:MA(C,5);
C>MA1,BK('A',1);
C>O,BK('B',1);
GROUPBKVOL('A')>0&&C>REF(H,1),BK('A',1);//A组多头持仓大于0并且最新价大于前一周前最高价，再买开一手
C<MA1,SP('A',GROUPBKVOL('A'));//最新价小于5日均线，卖平所有的A组的多头持仓
C<O,SP('B',GROUPBKVOL('B'));//K线收阴线，卖平所有的B组多头持仓
```

### GROUPSKVOL

指令分组模型卖开信号手数

```pascal
GROUPSKVOL('letter') 取指令分组模型letter组的卖开信号手数。

用法：
GROUPSKVOL('A')返回指令分组模型组A的空头模组持仓。
参数可以取从A-I

注：
相应组的卖开信号后，GROUPSKVOL('A')增加，即SK('A’),SPK('A'),SK('A',1)后GROUPSKVOL('A')增加，其他组的开仓信号，GROUPSKVOL('A')取值不变
相应组的买平信号后，GROUPSKVOL('A')取值减少，即BP('A'),BPK('A'),BP('A',1)后，GROUPSKVOL('A')取值减少，其他组的平仓信号后，GROUPSKVOL('A')取值不变
全清信号后，GROUPBKVOL('A')取值减为0

例：
MA1:MA(C,5);
C<MA1,SK('A',1);
C<O,SK('B',1);
GROUPSKVOL('A')>0&&C<REF(L,1),SK('A',1); //A组空头持仓大于0并且最新价大于前一周前最高价，再卖开一手
C>MA1,BP('A',GROUPSKVOL('A')); //最新价大于5日均线，买平所有的A组的空头持仓
C>O,BP('B',GROUPSKVOL('B')); //K线收阳线，买平所有的B组空头持仓
```

### GROUPBKPRICE

指令分组模型相应组别的最近一次买开信号价位

```pascal
GROUPBKPRICE('letter') 指令分组模型letter组最近一次买开信号价位。

用法：
GROUPBKPRICE('A') 返回A组最近一次买开信号价位。

例：
C>O,BK('A');
BB:GROUPBKPRICE('A');//给BB赋值为A组指令中最近一次买开信号价位。
```

### GROUPSKPRICE

指令分组模型相应组别的最近一次卖开信号价位

```pascal
GROUPSKPRICE('letter')  指令分组模型letter组最近一次卖开信号价位。

用法：
GROUPSKPRICE('A') 返回A组最近一次卖开信号价位。

例：
C<O,SK('B');
SS:GROUPSKPRICE('B');//给SS赋值为B组指令中最近一次卖开信号价位。
```

### ISLASTBK

判断上一个信号是否是 BK

```pascal
ISLASTBK 判断上一个交易信号是否是BK。

用法：
ISLASTBK 上一个交易信号是BK则返回1（Yes），否则返回0（No）
a.信号执行方式选择K线走完确认信号下单及K线走完进行信号复核（例如：在模型中写入CHECKSIG(BK,'A',0,'D',0,3);）
BK信号未确认时，ISLASTBK返回值0；
BK信号确认后，ISLASTBK返回1
b.信号执行方式选择不进行信号复核（例如：在模型中写入MULTSIG或MULTSIG_MIN;），BK信号当根ISLASTBK返回值为1

注：模型中含有BPK条件，且上一个信号为平仓信号时，由BPK指令产生的BK信号，ISLASTBK返回0，ISLASTBPK返回1。

例:
C>O,BK;
ISLASTBK&&C>BKPRICE,SP;
AUTOFILTER;//上一个信号是BK信号，且最新价大于开仓价格，卖平仓
```

### ISLASTSK

判断上一个信号是否是 SK

```pascal
ISLASTSK 判断上一个交易信号是否是SK。

用法：
ISLASTSK 上一个交易信号是SK则返回1（Yes），否则返回0（No）
a.信号执行方式选择K线走完确认信号下单及K线走完进行信号复核（例如：在模型中写入CHECKSIG_(SK,'A',0,'D',0,3);）
SK信号未确认时，ISLASTSK返回值0；
SK信号确认后，ISLASTSK返回1
b.信号执行方式选择不进行信号复核（例如：在模型中写入MULTSIG或MULTSIG_MIN;），SK信号当根ISLASTSK返回值为1

注：模型中含有SPK条件，且上一个信号为平仓信号时，由SPK指令产生的SK信号，ISLASTSK返回0，ISLASTSPK返回1。

例:
C<O,SK;
ISLASTSK&&C<SKPRICE,BP;
AUTOFILTER;//上一个信号是SK信号，且最新价小于开仓价格，买平仓
```

### ISLASTSTOP

判断上一个信号是否是 STOP

```pascal
ISLASTSTOP 判断上一个交易信号是否是STOP。

用法：
ISLASTSTOP 上一个交易信号是STOP则返回1（Yes），否则返回0（No）

注：收盘价模型STOP信号下根K线ISLASTSTOP返回值为1；指令价模型STOP信号当根K线ISLASTSTOP返回值为1。

例:
CROSS(C,MA(C,5)),BK(2);
STOP(0,5);
ISLASTSTOP&&CROSS(C,MA(C,10)),BK(1);//上一个信号是STOP信号，且价格上穿10周期均线，开仓一手
```

### ISLASTBP

判断上一个信号是否是 BP

```pascal
ISLASTBP 判断上一个交易信号是否是BP。

用法：
ISLASTBP 上一个交易信号是BP则返回1（Yes），否则返回0（No）
a.信号执行方式选择K线走完确认信号下单及K线走完进行信号复核（例如：在模型中写入CHECKSIG(BP,'A',0,'D',0,3);）
BP信号未确认时，ISLASTBP返回值0；
BP信号确认后，ISLASTBP返回1
b.信号执行方式选择不进行信号复核（例如：在模型中写入MULTSIG或MULTSIG_MIN;），BP信号当根ISLASTBP返回值为1

例:
C<O,SK(2);
C>O,BP(1);
ISLASTBP,BP(1);//上一个信号是买平仓信号，则减仓一手
```

### ISLASTSP

判断上一个信号是否是 SP

```pascal
ISLASTSP判断上一个交易信号是否是SP。

用法：
ISLASTSP 上一个交易信号是SP则返回1（Yes），否则返回0（No）
a.信号执行方式选择K线走完确认信号下单及K线走完进行信号复核（例如：在模型中写入CHECKSIG(SP,'A',0,'D',0,3);）
SP信号未确认时，ISLASTSP返回值0；
SP信号确认后，ISLASTSP返回1
b.信号执行方式选择不进行信号复核（例如：在模型中写入MULTSIG或MULTSIG_MIN;），SP信号当根ISLASTSP返回值为1

例:
C>O,BK(2);
C<O,SP(1);
ISLASTSP,SP(1);//上一个信号是卖平仓信号，则减仓一手
```

### ISLASTBPK

判断上一个信号是否是 BPK

```pascal
ISLASTBPK判断上一个交易信号是否是BPK。

用法：
ISLASTBPK 上一个交易信号是BPK则返回1（Yes），否则返回0（No）
a.信号执行方式选择K线走完确认信号下单及K线走完进行信号复核（例如：在模型中写入CHECKSIG(BPK,'A',0,'D',0,3);）
BPK信号未确认时，ISLASTBPK返回值0；
BPK信号确认后，ISLASTBPK返回1
b.信号执行方式选择不进行信号复核（例如：在模型中写入MULTSIG或MULTSIG_MIN;），BPK信号当根ISLASTBPK返回值为1

注：模型中含有BPK条件，且上一个信号为平仓信号时，由BPK指令产生的BK信号，ISLASTBK返回0，ISLASTBPK返回1。

例:
C>O,BPK;
ISLASTBPK&&C<O,SPK;
AUTOFILTER;//上一个信号是BPK信号，则反手SPK
```

### ISLASTSPK

判断上一个信号是否是 SPK

```pascal
ISLASTSPK判断上一个交易信号是否是SPK。

用法：
ISLASTSPK 上一个交易信号是SPK则返回1（Yes），否则返回0（No）
a.信号执行方式选择K线走完确认信号下单及K线走完进行信号复核（例如：在模型中写入CHECKSIG(SPK,'A',0,'D',0,3);）
SPK信号未确认时，ISLASTSPK返回值0；
SPK信号确认后，ISLASTSPK返回1
b.信号执行方式选择不进行信号复核（例如：在模型中写入MULTSIG或MULTSIG_MIN;），SPK信号当根ISLASTSPK返回值为1

注：模型中含有SPK条件，且上一个信号为平仓信号时，由SPK指令产生的SK信号，ISLASTSK返回0，ISLASTSPK返回1。

例:
C<O,SPK;
ISLASTSPK&&C>O,BPK;
AUTOFILTER;//上一个信号是SPK信号，则反手BPK
```

### ISLASTCLOSEOUT

判断上一个信号是否是 CLOSEOUT

```pascal
ISLASTCLOSEOUT判断上一个信号是否CLOSEOUT 。

用法：
ISLASTCLOSEOUT 上一个交易信号是CLOSEOUT返回1（Yes），否则返回0（No）
a.信号执行方式选择K线走完确认信号下单及K线走完进行信号复核（例如：在模型中写入CHECKSIG(CLOSEOUT,'A',0,'D',0,3);）
CLOSEOUT信号未确认时，ISLASTCLOSEOUT返回值0；
CLOSEOUT信号确认后，ISLASTCLOSEOUT返回1
b.信号执行方式选择不进行信号复核（例如：在模型中写入MULTSIG或MULTSIG_MIN;），CLOSEOUT信号当根ISLASTCLOSEOUT返回值为1

例:
ISLASTCLOSEOUT&&C>O,BK(1);//上一个信号是清仓信号，并且当根K线是阳线，则买开一手
```

### KLINESIG

判断当根 K 线上最后一个固定的信号

```pascal
KLINESIG 判断当根K线上最后一个固定的信号。

用法：KLINESIG 判断当根K线上最后一个固定的信号。如果最后一根K线上没有信号，或者没有固定的信号，则该函数返回0。

注：
1、该函数只能用于指令价模型
2、信号的返回值：
BK:200;
SK:201;
BP:202;
SP:203;
BPK:204;
SPK:205;
CLOSEOUT:206;
STOP:207;
3、由BPK指令产生的BK信号按BPK信号处理，SPK指令产生的SK信号同理。

例：
KLINESIG=200&&BKVOL>0,SP;//如果最后一个固定的信号是BK信号，并且多头持仓大于0，卖平仓
```

### LASTSIG

判断最近一个信号

```pascal
LASTSIG判断最近一个信号

注：由BPK指令产生的BK信号按BPK信号处理，SPK指令产生的SK信号同理。

例：AA:LASTSIG=BK;//最近一个 稳定的信号为BK信号AA返回值为1，否则返回0.
LASTSIG的不同返回值代表的信号：
BK:200;
SK:201;
BP:202;
SP:203;
BPK:204;
SPK:205;
CLOSEOUT:206;
STOP:207;
```

### LASTSIGGROUP

判断最近一个信号所在的分组

```pascal
LASTSIGGROUP 判断最近一个信号所在的分组。

注：
1、"A"组返回1，"B"组返回2，"C"组返回3，"D"组返回4，"E"组返回5，"F"组返回6，"G"组返回7，"H"组返回8，"I"组返回9。
2、未设置过分组或者分组模型里面的无组别指令，返回0。
3、出信号的当根K线，信号固定后，LASTSIGGROUP返回该信号的分组，信号尚未固定时，LASTSIGGROUP返回上一个固定的信号的分组。

例：
CROSS(C,MA(C,5)),BK('A',1);//最新价上穿五周期均线，A组做多一手
CROSS(MA(C,5),C),SP('A',BKVOL);//最新价下穿五周期均线，A组平仓
CROSS(C,MA(C,10)),BK('B',2);//最新价上穿十周期均线，B组做多两手
LASTSIG=200&&LASTSIGGROUP=2,SP('B',BKVOL);//上一个信号是B组的BK信号，则B组平仓
```

### MAXBKVOL

多头最大持仓手数

```pascal
MAXBKVOL 多头最大持仓手数

用法：
MAXBKVOL 返回一次多头交易过程中最大的持仓手数。一次多头交易指有多头持仓到持仓为0。

注：
1、开仓信号当根K线，MAXBKVOL返回值增加多头开仓数量。
2、平全部多仓信号的当根K线，MAXBKVOL返回0。
3、非一次完整交易中平仓信号当根K线持仓不为0，MAXBKVOL返回值不变。
4、一根K线多信号的模型，平仓信号当根K线返回最新一次完整交易的持仓手数。

例：
CROSS(C,MA(C,5)),BK(1);//价格上穿五周期均线，买开一手
CROSS(C,MA(C,10)),BK(2);//价格上穿十周期均线，加仓两手
MAXBKVOL=3,SP(BKVOL);//多头最大持仓手数为3时，卖平多头持仓
```

### MAXSKVOL

空头最大持仓手数

```pascal
MAXSKVOL 空头最大持仓手数

用法：
MAXSKVOL 返回一次空头交易过程中最大的持仓手数。一次空头交易指有空头持仓到持仓为0

注：
1、开仓信号当根K线，MAXSKVOL返回值增加空头开仓数量。
2、平全部空仓信号的当根K线，MAXSKVOL返回0。
3、非一次完整交易中平仓信号当根K线持仓不为0，MAXSKVOL返回值不变。
4、一根K线多信号的模型，平仓信号当根K线返回最新一次完整交易的持仓手数。

例：
CROSS(MA(C,5),C),SK(1);//价格下穿五周期均线，卖开一手
CROSS(MA(C,10),C),SK(2);//价格下穿十周期均线，加仓两手
MAXSKVOL=3,BP(SKVOL);//空头最大持仓手数为3时，买平空头持仓
```

### REFSIG_PLACE

判断指定信号的 K 线位置

```pascal
REFSIG_PLACE(Sig,N) 判断从当根K线开始倒数第N个固定的Sig信号所在K线的位置。

用法：REFSIG_PLACE(Sig,N) 判断从当根K线开始倒数第N个固定的Sig信号所在K线的位置。如果没有Sig信号，或者没有固定的Sig信号，则该函数返回空值。

注：
1、Sig位置支持的信号有：BK,SK,BP,SP,BPK,SPK,CLOSEOUT,STOP
2、K线位置是指当前K线到指定信号所在K线的根数。
3、如果倒数第N个固定的Sig信号在当根K线上，那么该函数返回0。
4、N为0或空值时，该函数返回空值。
5、参数N支持变量。

例：
REFSIG_PLACE(BK,3)=5&&BKVOL>0,SP;//如果从当根K线开始倒数第3个固定的BK信号所在的距离当前K线有5根K线，并且多头持仓大于0，卖平仓
```

### REFSIG_PRICE

判断指定信号的信号价位

```pascal
REFSIG_PRICE(Sig,N) 返回从当根K线开始倒数第N个固定的Sig信号的信号价位。

用法：REFSIG_PRICE(Sig,N) 判断从当根K线开始倒数第N个固定的Sig信号的信号价位。如果没有Sig信号，或者没有固定的Sig信号，则该函数返回0。

注：
1、Sig位置支持的信号有：BK,SK,BP,SP,BPK,SPK,CLOSEOUT,STOP
2、如果当根K线上有固定的Sig信号，那么该函数计算信号时，包括当根K线的信号。
3、N为0或空值时，该函数返回0。
4、参数N支持变量。

例：
REFSIG_PRICE(BK,3)=3000&&BKVOL>0,SP;//如果从当根K线开始倒数第3个固定的BK信号的开仓价位为3000，并且多头持仓大于0，卖平仓
```

### REFSIG_PRICE1

判断指定信号的委托价格

```pascal
REFSIG_PRICE1(Sig,N) 返回从当根K线开始倒数第N个固定的Sig信号的委托价格。

用法：REFSIG_PRICE1(Sig,N) 判断从当根K线开始倒数第N个固定的Sig信号的委托价格。如果没有Sig信号，或者没有固定的Sig信号，则该函数返回0。

注：
1、
盘中运行：
REFSIG_PRICE1(Sig,N)返回从当根K线开始倒数第N个固定的Sig信号的委托价格。
回测：
1)模型中含有信号控制函数：REFSIG_PRICE1(Sig,N)返回从当根K线开始倒数第N个固定的Sig信号发出时的行情最新价。
2)模型中不含有信号控制函数：REFSIG_PRICE1(Sig,N)返回从当根K线开始倒数第N个固定的Sig信号当根K线的收盘价。
2、Sig位置支持的信号有：BK,SK,BP,SP,BPK,SPK,CLOSEOUT,STOP
3、如果当根K线上有固定的Sig信号，那么该函数计算信号时，包括当根K线的信号。
4、N为0或空值时，该函数返回0。
5、参数N支持变量。

例：
REFSIG_PRICE1(BK,3)=3000&&BKVOL>0,SP;//如果从当根K线开始倒数第3个固定的BK信号的委托价格为3000，并且多头持仓大于0，卖平仓
```

### REFSIG_PRICE2

判断指定信号的成交价格

```pascal
REFSIG_PRICE2(Sig,N) 返回从当根K线开始倒数第N个固定的Sig信号的成交价格。

用法：REFSIG_PRICE2(Sig,N) 判断从当根K线开始倒数第N个固定的Sig信号的成交价格。如果没有Sig信号，或者没有固定的Sig信号，则该函数返回0。

注：
1、
盘中运行：
REFSIG_PRICE2(Sig,N)返回从当根K线开始倒数第N个固定的Sig信号的成交价格。
回测：
1)模型中含有信号控制函数：REFSIG_PRICE2(Sig,N)返回从当根K线开始倒数第N个固定的Sig信号发出时的行情最新价。
2)模型中不含有信号控制函数：REFSIG_PRICE2(Sig,N)返回从当根K线开始倒数第N个固定的Sig信号当根K线的收盘价。
2、Sig位置支持的信号有：BK,SK,BP,SP,BPK,SPK,CLOSEOUT,STOP
3、如果当根K线上有固定的Sig信号，那么该函数计算信号时，包括当根K线的信号。
4、如果信号发出了委托，但是还没有成交，那么该函数返回0。
5、N为0或空值时，该函数返回0。
6、参数N支持变量。

例：
REFSIG_PRICE2(BK,3)=3000&&BKVOL>0,SP;//如果从当根K线开始倒数第3个固定的BK信号的成交价位为3000，并且多头持仓大于0，卖平仓
```

### REFSIG_VOL

判断指定信号的手数

```pascal
REFSIG_VOL(Sig,N) 返回从当根K线开始倒数第N个固定的Sig信号的信号手数(反手指令取开仓手数)。

用法：REFSIG_VOL(Sig,N) 判断从当根K线开始倒数第N个固定的Sig信号的手数。如果没有Sig信号，或者没有固定的Sig信号，则该函数返回0。

注：
1、Sig位置支持的信号有：BK,SK,BP,SP,BPK,SPK,CLOSEOUT,STOP
2、如果倒数第N个固定的Sig信号在当根K线上，那么该函数返回当前信号手数。
4、N为0或空值时，该函数返回0。
5、参数N支持变量。

例：
REFSIG_PLACE(BK,3)=5&&REFSIG_VOL(BK,3)>2,SP(BKVOL);//如果从当根K线开始倒数第3个固定的BK信号所在的距离当前K线有5根K线，并且信号手数大于2，平掉所有持仓
```

### SIGNUM

定位一次交易过程中的信号位置

```pascal
SIGNUM，返回值为当前信号为一次交易过程中的第几个信号

注：
1、一次交易过程指的是首次开仓到持仓为0的交易过程
2、如果信号为反手信号，则该函数返回值为1

例1：
C>O,BK(1);
SIGNUM>3&&C<O,SP(BKVOL);//如果本次交易前面已经出现大于3个信号，K线为阴线，全部平仓
SIGNUM<=3&&C<O,SP(BKVOL/2);//如果本次交易前面已经出现小于等于3个信号，K线为阴线，平仓一半
TRADE_AGAIN(4);
```

### SIGVOL

一次交易中指定信号的下单手数

```pascal
SIGVOL(N),返回一次交易中第N个信号的下单手数。

注：
1、一次交易过程指的是首次开仓到持仓为0的交易过程
2、在一次交易中，当前位置信号不足N个时，该函数返回无效值

例1：
TR:=MAX(MAX((HIGH-LOW),ABS(REF(CLOSE,1)-HIGH)),ABS(REF(CLOSE,1)-LOW));//真实波幅
ATR..MA(TR,26); //求26个周期内真实波幅的简单移动平均
TC..INTPART((MONEYTOT*0.01/(UNIT*ATR)));//根据权益的1%计算下单手数
HH:=HHV(H,20);
LL:=LLV(L,20);
MID:=(HH +LL)/2;
CROSSUP(C,HH),BK(TC);
SIGVOL(1)<12&&CROSSDOWN(C,MID),SP(BKVOL);//如果首次开仓手数小于12手，下穿中轨，全部平仓
SIGVOL(1)>12&&CROSSDOWN(C,MID),SP(BKVOL/2);//如果首次开仓手数大于12手，下穿中轨，平仓一半
CROSSDOWN(C,LL),SP(BKVOL);
TRADE_AGAIN(10);
```

### SKHIGH

返回数据合约卖开仓以来的最高价

```pascal
返回数据合约卖开仓以来的最高价
用法：
SKHIGH返回数据合约最近一次模型卖开位置到当前的最高价。
1、不同信号执行方式，其返回值分别为：
（1）K线走完确认信号下单
   a.历史信号计算中，SK(SPK)信号之后的K线返回委托以来的数据合约行情的最高价
   b.加载运行过程中，SK(SPK)信号当根K线返回的为信号发出时数据合约行情的最新价，SK之后的K线返回委托以来的数据合约行情最高价
（2）信号执行方式选择K线走完复核（例如：在模型中写入CHECKSIG(SK,'A',0,'D',0,0);）
从SK(SPK)信号发出时开始统计数据合约行情的最高价；信号消失，返回上次卖开以来的数据合约行情的最高价，信号确认存在，返回当根K线记录的数据合约行情的最高价
注：SK信号发出后，中间出了信号消失，从最后一次信号出现开始统计数据合约最高价
（3）信号执行方式选择不进行信号复核（例如：在模型中写入MULTSIG或MULTSIG_MIN;）
SK(SPK)信号的当根K线返回的从信号发出到K线走完时数据合约行情的最高价；SK(SPK)信号之后的K线返回信号发出以来数据合约行情的最高价。
2、主连合约使用换月移仓函数，主力合约切换后，从新的主力合约第一根K线开盘价重新开始统计
3、模组重新初始化后，数据合约和交易合约相同，则SKHIGH返回初始化后的最高价与初始化弹出框中填入的持仓价相比较后较大的数值；数据合约与交易合约不同时，则SKHIGH返回初始化后的最高价与初始化弹出框中填入的数据合约信号价相比较后较大的数值。

例：
C<O,SK;
C<SKHIGH-5,BP;
AUTOFILTER;//最新价低于卖开仓以来数据合约的最高价5个点，平仓。
```

### SKLOW

返回数据合约卖开仓以来的最低价

```pascal
返回数据合约卖开仓以来的最低价
用法：
SKLOW返回数据合约最近一次模型卖开位置到当前的最低价。
1、不同信号执行方式，其返回值分别为：
（1）K线走完确认信号下单
   a.历史信号计算中，SK(SPK)信号之后的K线返回委托以来的数据合约行情的最低价
   b.加载运行过程中，SK(SPK)信号当根K线返回的为信号发出时数据合约行情的最新价，SK之后的K线返回委托以来的数据合约行情最低价
（2）信号执行方式选择K线走完复核（例如：在模型中写入CHECKSIG(SK,'A',0,'D',0,0);），从SK(SPK)信号发出时行情时开始统计数据合约行情的最低价；信号消失，返回上次卖开以来的数据合约行情的最低价，信号确认存在，返回当根K线记录的数据合约行情的最低价
注：SK信号发出后，中间出了信号消失，从最后一次信号出现开始统计数据合约最低价
（3）信号执行方式选择不进行信号复核（例如：在模型中写入MULTSIG或MULTSIG_MIN;）
SK(SPK)信号的当根K线返回的从信号发出到K线走完时数据合约行情的最低价；SK(SPK)信号之后的K线返回信号发出以来数据合约行情的最低价
2、主连合约使用换月移仓函数，主力合约切换后，从新的主力合约第一根K线开盘价重新开始统计
3、模组重新初始化后，数据合约和交易合约相同，则SKLOW返回初始化后的最低价与初始化弹出框中填入的持仓价相比较后较小的数值；数据合约与交易合约不同时，则SKLOW返回初始化后的最低价与初始化弹出框中填入的数据合约信号价相比较后较小的数值。

例：
C<O,SK;
C<SKPRICE&&C>SKLOW+5,BP;
AUTOFILTER;//最新价高于卖开仓以来数据合约的最低价5个点，止盈平仓。
```

### SKPRICE

返回数据合约最近一次卖开信号价位

```pascal
SKPRICE 返回数据合约最近一次卖开信号价位。

用法：
SKPRICE 返回数据合约最近一次卖开信号发出时的行情的最新价。

注：
1、当数据合约和交易合约相同时SKPRICE值和SKPRICE1值相等。
2、当模型存在连续多个开仓信号(加仓)的情况下，该函数返回的是最近一次开仓信号的价格,而不是开仓均价。
3、不同信号执行方式，其返回值分别为：
（1）信号执行方式为不进行信号复核
    a.历史回测：SKPRICE返回信号发出时的数据合约行情最新价
    b.模组运行：SKPRICE返回信号发出时的数据合约行情最新价
（2）信号执行方式选择K线走完确认信号下单
    a.历史回测：SKPRICE返回信号发出时数据合约当根K线的收盘价
    b.模组运行：SKPRICE返回信号发出时数据合约当根K线的收盘价
（3）信号执行方式设置为K线走完进行信号复核
    a.历史回测：SKPRICE返回信号发出时数据合约当根K线的收盘价
    b.模组运行：复核前，返回上一次SK信号当根K线数据合约的行情最新价；复核后，返回本次SK信号当根K线数据合约的行情最新价
4、当模组自动初始化时，SKPRICE返回的为上一次卖开信号时数据合约行情的最新价。
5、模组重新初始化后，数据合约和交易合约相同，则SKPRICE返回为初始化弹出框中填入的持仓价格；数据合约与交易合约不同时，则SKPRICE返回初始化弹出框中填入的数据合约信号价。
6、加载在主连合约上，使用了换月移仓函数，主力换月后SKPRCIE取值为新的主力合约的第一根K线的开盘价

例:
CLOSE-SKPRICE>60 && SKPRICE>0 && SKVOL>0, BP;//如果卖开价位比当前价位低出60,且空头持仓存在，买平仓。
```

### SKPRICE1

返回交易合约最近一次卖开信号价位

```pascal
SKPRICE1 返回交易合约最近一次卖开信号价位。

用法：
SKPRICE1：返回交易合约最近一次卖开信号发出时的行情的最新价。

注：
1、当数据合约和交易合约相同时SKPRICE值和SKPRICE1值相等。
2、当数据合约和交易合约不同时，不同信号执行方式，其返回值分别为：
（1）信号执行方式为不进行信号复核
   a.历史回测：SKPRICE1返回信号发出时的交易合约行情最新价
   b.模组运行：SKPRICE1返回信号发出时的交易合约行情最新价
（2）信号执行方式选择K线走完确认信号下单
    a.历史回测：SKPRICE1返回信号发出时交易合约当根K线的收盘价
    b.模组运行：SKPRICE1返回信号发出时交易合约当根K线的收盘价
（3）信号执行方式设置为K线走完进行信号复核
    a.历史回测：SKPRICE1返回信号发出时交易合约当根K线的收盘价
    b.模组运行：复核前，返回上一次SK信号当根K线交易合约的行情最新价；复核后，返回本次SK信号当根K线交易合约的行情最新价
3、当模组自动初始化时，SKPRICE1取最近的SK信号发出时的交易合约行情的最新价；手动初始化时，SKPRICE1取初始化弹出框中填入的持仓价格。
4、加载在指数/主连合约上，使用了换月移仓函数，主力换月后SKPRCIE1取值为新的主力合约的第一根K线的开盘价
```

### SKPRICEAV

返回数据合约空头开仓均价

```pascal
SKPRICEAV 返回数据合约空头开仓均价。

用法：
SKPRICEAV 返回返回数据合约空头开仓均价。

注：
1、一开一平信号过滤模型：
（1）开仓信号后，未出平仓信号时：SKPRICEAV取值和SKPRICE取值相同。
（2）平仓信号后：SKPRICEAV返回值为0。
2、加减仓模型：
（1）持仓不为0时：SKPRICEAV返回数据合约理论持仓的开仓均价。
（2）加减仓模型持仓为0时：SKPRICEAV返回值为0。
3、该函数在模组运行和回测中都读取的是模组理论持仓的开仓均价，非实际持仓开仓均价。
4、模组重新初始化后，数据合约和交易合约相同，则SKPRICEAV计算取初始化弹出框中填入的持仓价格；数据合约与交易合约不同时，则SKPRICEAV计算取初始化弹出框中填入的数据合约信号价。

注：
该函数的计算考虑滑点。

例：
SKPRICEAV-CLOSE>60,BP(SKVOL);//当前价位比空头开仓均价低出60,平掉所有空头持仓
```

### SKPRICEAV1

返回交易合约空头开仓均价

```pascal
SKPRICEAV1 返回交易合约空头开仓均价

用法：
SKPRICEAV1 返回返回交易合约空头开仓均价。

注：
1、当模型存在连续多个开仓信号(加仓)的情况下，该函数返回的是交易合约开仓均价。
2、当数据合约和交易合约相同时SKPRICEAV值和SKPRICEAV1值相等。
3、一开一平信号过滤模型：
（1）开仓信号后，未出平仓信号时：SKPRICEAV1取值和SKPRICE1取值相同。
（2）平仓信号后：SKPRICEAV1返回值为0。
4、加减仓模型：
（1）持仓不为0时：SKPRICEAV1返回交易合约理论持仓的开仓均价。
（2）加减仓模型持仓为0时：SKPRICEAV1返回值为0。

注：
该函数的计算考虑滑点。

例：
SKPRICEAV1-CLOSE>60,BP(SKVOL);//当前价位比交易合约空头开仓均价低出60,平掉所有空头持仓
```

### SKVOL

卖开信号手数

```pascal
卖开信号手数
用法：
SKVOL返回模型当前的空头理论持仓。
1、加载运行：
（1）模组子账户初始化后，SKVOL仍然返回根据信号下单手数计算的理论持仓，不受账户持仓的影响。
（2）模组运行中手动调仓，头寸同步修改持仓，SKVOL返回值不变，仍然返回根据信号下单手数计算的理论持仓。
（3）页面盒子运行中，SKVOL不受资金情况的限制，按照信号显示开仓手数。
2、回测、模组运行中：
（1）如果资金不够开仓，开仓手数为0，SKVOL返回值为0。
（2）SK（SPK）信号出现并且确认固定后，SKVOL的取值增加开仓手数的数值；BP（BPK）信号出现并且确认固定后，SKVOL的取值减少平仓手数的数值。

例：
SKVOL=0&&C<O,SK(1);//空头理论持仓为0并且收盘价小于开盘价时，卖开一手
SKVOL>=1&&L<LV(L,5),SK(2); //空头持仓大于等于1，并且当根K线的最低价小于前面5个周期中最低价中最小值时，加仓2手
SKVOL>0&&H>REF(H,5),BP(SKVOL); //空头持仓大于0，并且当根K线的最高价大于5个周期前K线的最高价时，买平所有空头持仓
```

### SKVOL2

卖开信号手数

```pascal
卖开信号手数
用法：
SKVOL2返回模型当前的空头持仓。
1、加载运行：
（1）模组子账户初始化后，SKVOL2返回的理论持仓仍然延续，返回模型信号手数，不受账户持仓的影响。
（2）页面盒子和模组加载中，SKVOL2不受资金情况的限制，按照信号显示开仓手数。
（3）模组运行过程中SK（SPK）信号出现并且确认固定后，SKVOL2的取值增加开仓手数的数值；BP（BPK）信号出现并且确认固定后，SKVOL2的取值减少平仓手数的数值。
2、回测：
（1）SKVOL2不受资金情况的限制，按照信号显示开仓手数。
（2）SK（SPK）信号出现并且确认固定后，SKVOL2的取值增加开仓手数的数值；BP（BPK）信号出现并且确认固定后，SKVOL2的取值减少平仓手数的数值。

例：
SKVOL2=0&&C<O,SK(1);//空头持仓为0并且收盘价小于开盘价时，卖开一手
SKVOL2>=1&&L>LV(L,5),SK(2); //空头持仓大于等于1，并且当根K线的最低价小于前面5个周期中最低价中最小值时，加仓2手
SKVOL2>0&&H<REF(H,5),BP(SKVOL2); //空头持仓大于0，并且当根K线的最高价大于5个周期前K线的最高价时，买平所有空头持仓
```

## 信号执行函数

### CLOSEKLINE

设置 K 线提前 N 秒走完

```pascal
CLOSEKLINE(TYPE,N) 设置K线提前N秒走完，确认信号下单，K线走完进行复核

用法：
CLOSEKLINE(TYPE,N),TYPE=0,代表以小节结束时间或收盘时间为结束时间的K线提前N秒走完，TYPE=1，代表以收盘时间为结束时间的K线提前N秒走完，TYPE=2，代表每一根K线提前N秒走完。N是时间（秒数）。

注：
1、该函数只能用于收盘价模型。
2、该函数用于模组中,K线提前N秒走完，确认信号下单，K线走完进行复核：
A：如果提前确认信号下单后，不满足信号条件，在模组不关机、不复位历史信号连续运行的情况下，在一根K线开盘后做信号消失处理。
B：休盘前最后N秒满足条件出现信号，在模组不关机连续运行的情况下，会在下根K线开盘立即下单。
3、该函数回测报告中按收盘价计算价格，但含有该函数模型出的信号回测和盘中保持一致。
4、该函数加载到页面盒子中，以收盘时间为结束时间的K线提前N秒确认信号下单，K线走完不进行信号复核。
即：如果提前确认信号下单后，K线走完后不满足条件信号消失，也不进行信号消失处理
5、N不支持变量，且N不能大于K线的总秒数。
6、只有在休市开始时间和k线走完时间重合，此设置才起作用。例如：15分钟周期上，在10:15分k线走完时间和休市开始时间重合，10:15这根k线提前N秒走完。
7、模型中不支持同时写入CLOSEKLINE和CLOSEKLINE_MIN函数。
8、对于夜盘合约，夜盘收盘不是当日收盘，15点收盘才算作当日收盘。夜盘合约只显示夜盘数据时，夜盘收盘算作当日收盘。
9、该函数不支持加载到量能周期和日线以上的周期中使用。

例：
C>HV(H,4),BK;//价格大于前四个周期高点开多仓
C<MA(C,5),SP;//价格小于5周期均线，平多仓
CLOSEKLINE(1,10);//设置以收盘时间为结束时间的K线提前10秒走完。
AUTOFILTER;
```

### CLOSEKLINE_MIN

设置 K 线提前 N 分钟走完

```pascal
CLOSEKLINE_MIN(TYPE,N) 设置K线提前N分钟走完，K线走完进行复核

用法：
CLOSEKLINE_MIN(TYPE,N),TYPE=0,代表以小节结束时间或收盘时间为结束时间的K线提前N分钟走完，K线走完进行复核，TYPE=1，代表以收盘时间为结束时间的K线提前N分钟走完，K线走完进行复核，TYPE=2，代表每一根K线提前N分钟走完，K线走完进行复核。N是时间（分钟数）。

注：
1、该函数只能用于收盘价模型。
2、模型中含有该函数，回测的基础数据为1分钟数据。
3、该函数不支持加载到秒周期、量能周期和日线以上周期中使用。
4、模型中含有该函数，以小节结束时间为提前N分钟确认信号下单，K线走完进行信号复核。
（1）、回测中：以收盘时间为结束时间的K线提前N分钟确认信号下单，K线走完时进行复核，如果不满足条件，在开盘后做信号消失处理。
（2）、模组加载中：
A:以收盘时间为结束时间的K线提前N分钟确认信号下单，K线走完时进行复核，如果不满足条件，在模组不关机连续运行的情况下，在开盘后做信号消失处理。
B:休盘前最后N分钟满足条件出现信号，在模组不关机连续运行的情况下，会在下根K线开盘立即下单。
（3）、该函数不支持加载到页面盒子中使用。
5、N不支持变量，且N不能大于K线的总分钟数。
6、只有在休市开始时间和k线走完时间重合，此设置才起作用。例如：15分钟周期上，在10:15分k线走完时间和休市开始时间重合，10:15这根k线提前N分钟走完。
7、对于夜盘合约，夜盘收盘不是当日收盘，15点收盘才算作当日收盘。夜盘合约只显示夜盘数据时，夜盘收盘算作当日收盘。

例：
C>HV(H,4),BK;//价格大于前四个周期高点开多仓
C<MA(C,5),SP;//价格小于5周期均线，平多仓
CLOSEKLINE_MIN(1,2);//设置以收盘时间为结束时间的K线提前2分钟走完。
AUTOFILTER;
```

### SETALLLOSTSIGPRICETYPE

设置模型中所有信号消失用相同委托方式进行处理

```pascal
SETALLLOSTSIGPRICETYPE(PRICE),设置模型中所有信号消失用相同委托方式进行处理

用法：SETALLLOSTSIGPRICETYPE(PRICE),设置模型中所有信号消失处理的委托方式，PRICE为委托价格。

注：
1、
1、模型中写入该函数后，所有指令都采用同一种委托方式，所有指令包括BK\SK\BP\SP\BPK\SPK\CLOSEOUT\STOP\STOP1。
2、PRICE位置为委托价格，包括以下八种：
（1）NEW_ORDER 最新价
注：委托方式为NEW_ORDER时支持回测，计算信号价格为信号发出时的最新价。
例如，收盘价模型，当前k线出信号，价格取下一根k线开盘价
（2）PASSIVE_ORDER 排队价
（3）ACTIVE_ORDER 对价
（4）TRACING_ORDER 自动连续追
A：首次下单委托价格参数设置->程序化参数->追价设置的价格方式执行。
B：股票合约不支持追价。
（5）CMPETITV_ORDER 超价
A：下单基准按参数设置->程序化参数->超价设置的价格方式执行
（6）LIMIT_ORDER 市价
（7）SIGPRICE_ORDER 触发价
（8）指定价 可以为具体的数值，也可以为表达式
3、模型编写中未使用该函数设置指令委托价格方式，默认按照交易参数中设置的程序化默认下单方式进行委托。
4、SETLOSTSIGPRICETYPE不能和SETALLLOSTSIGPRICETYPE同时使用
5、该函数仅在设置了信号复核，复核时产生了信号消失，对信号消失处理时才起作用
6、该函数只在模组中使用生效

例：
C>O,BK;
C<O,SP;
CHECKSIG(BK,'A',0,'D',0,3);//出信号立即下单，K线走完复核
CHECKSIG(SP,'A',2,'D',0,3);//出信号N分钟确认信号下单，K线走完复核
SETALLLOSTSIGPRICETYPE(LIMIT_ORDER);//所有信号消失用市价发委托进行信号消失处理
AUTOFILTER;
```

### SETALLSIGPRICETYPE

设置模型中所有信号用相同委托方式

```pascal
SETALLSIGPRICETYPE(PRICE,IsCancel),设置模型中所有信号用相同委托方式。

用法：SETALLSIGPRICETYPE(PRICE,IsCancel),设置模型中所有信号的委托方式，PRICE为委托价格，IsCancel为是否启用终止下单。

注：
1、模型中写入该函数后，所有指令都采用同一种委托方式，所有指令包括BK\SK\BP\SP\BPK\SPK\CLOSEOUT\STOP\STOP1。
2、PRICE位置为委托价格，包括以下八种：
（1）NEW_ORDER 最新价
注：委托方式为NEW_ORDER时支持回测，计算信号价格为信号发出时的最新价。
例如，收盘价模型，当前k线出信号，价格取下一根k线开盘价
（2）PASSIVE_ORDER 排队价
（3）ACTIVE_ORDER 对价
（4）TRACING_ORDER 自动连续追
A：首次下单委托价格参数设置->程序化参数->追价设置的价格方式执行。
B：股票合约不支持追价。
（5）CMPETITV_ORDER 超价
A：下单基准按参数设置->程序化参数->超价设置的价格方式执行
（6）LIMIT_ORDER 市价
（7）SIGPRICE_ORDER 触发价
（8）指定价 可以为具体的数值，也可以为表达式，即支持如下的写法：
A:HHV(H,3);//定义A为3个周期内的最高价
SETALLSIGPRICETYPE(A);//模型中的所有信号按照3个周期的最高价委托
3、参数IsCancel写入CANCEL_ORDER表示启用终止下单程序，
  即：根据PRICE1委托后，N秒不成交自动撤单并终止下单。
  参数IsCancel位置不写或写入其他内容，则代表不启用终止下单。
（1）参数N，在参数设置->程序化参数中进行设置。
（2）终止下单不考虑小节休息。
（3）BP、SP、BPK、SPK、CLOSEOUT、STOP、STOP1信号不支持CANCEL_ORDER设置。
4、模型编写中未使用该函数设置指令委托价格方式，默认按照交易参数中设置的程序化默认下单方式进行委托。
5、SETALLSIGPRICETYPE不能和SETSIGPRICETYPE同时使用。
6、该函数只在模组中或者信号预警盒子勾选直接下单不需要手动确认时才生效。

例：
C>HV(H,20),BK;//价格大于前20周期高点买开仓
C<LV(L,20),SK;//价格小于前20周期低点卖开仓
C>HV(H,10),BP;//价格大于前10周期高点平空仓
C<LV(L,10),SP;//价格小于前10周期低点平多仓
SETALLSIGPRICETYPE(ACTIVE_ORDER,CANCEL_ORDER);//该模型中所有信号以对价委托，BK、SK信号N秒不成交自动撤单并终止下单
AUTOFILTER;
```

### SETLOSTSIGPRICETYPE

不同的信号消失设置不同的委托方式

```pascal
SETLOSTSIGPRICETYPE(SIG,PRICE),不同的信号消失设置不同的委托方式。

用法：SETLOSTSIGPRICETYPE(SIG,PRICE),设置SIG指令消失处理的委托方式，PRICE为委托价格。

注：
1、SIG位置为交易指令，包括BK\SK\BP\SP\BPK\SPK\CLOSEOUT指令。
2、PRICE位置为委托方式，包括以下八种：
（1）NEW_ORDER 最新价
注：委托方式为NEW_ORDER时支持回测，计算信号价格为信号发出时的最新价。
例如，收盘价模型，当前k线出信号，价格取下一根k线开盘价
（2）PASSIVE_ORDER 排队价
（3）ACTIVE_ORDER 对价
（4）TRACING_ORDER 自动连续追
A：首次下单委托价格参数设置->程序化参数->追价设置的价格方式执行。
B：股票合约不支持追价。
（5）CMPETITV_ORDER 超价
A：下单基准按参数设置->程序化参数->超价设置的价格方式执行
（6）LIMIT_ORDER 市价
（7）SIGPRICE_ORDER 触发价
（8）指定价 可以为具体的数值，也可以为表达式
3、模型编写中未使用该函数设置指令委托价格方式，默认按照交易参数中设置的程序化默认下单方式进行委托。
4、SETLOSTSIGPRICETYPE不能和SETALLLOSTSIGPRICETYPE同时使用
5、该函数仅在设置了信号复核，复核时产生了信号消失时对信号消失处理时才起作用
6、该函数只在模组中使用生效

例：
C>O,BK;
C<O,SP;
CHECKSIG(BK,'A',0,'D',0,3);//出信号立即下单，K线走完复核
CHECKSIG(SP,'A',2,'D',0,3);//出信号N分钟确认信号下单，K线走完复核
SETLOSTSIGPRICETYPE(BK,LIMIT_ORDER);//买开信号消失用市价发委托进行信号消失处理
SETLOSTSIGPRICETYPE(SP,NEW_ORDER);//卖平信号消失用最新价发委托进行信号消失处理
AUTOFILTER;
```

### SETMODRUNTYPE

设置模组运行类型

```pascal
SETMODRUNTYPE 设置模组运行类型。

用法：
SETMODRUNTYPE(N);设置模组运行类型。参数N可以设置为0,1,2。
参数N为0时，按照模型中编写的信号执行方式出信号并下单。
参数N为1时，按照模型中编写的信号执行方式出信号，由算法交易运行池中的模型来控制下单。
参数N为2时，由算法交易运行池中的模型接管所有信号，控制出信号和下单。

注：
1、模型中没有使用该函数，则按照模型中设置的信号执行方式出信号并下单。
2、如果N为0或者1，模型加载到主图上可以正常显示交易指令。如果N为2，则模型加载到主图无信号。
3、该函数只在模组中生效。

例：
C>O,BK;
C<O,SP;
MULTSIG(0,0,3,0);//信号执行方式为出信号立即下单，不复核。
SETMODRUNTYPE(0);//模组按照出信号立即下单，不复核的信号执行方式出信号并下单。
AUTOFILTER;
```

### SETMOVEOPIPRICE

设置模组换月移仓的委托方式

```pascal
SETMOVEOPIPRICE(PRICE),设置模组换月移仓的委托方式。

用法：SETMOVEOPIPRICE(PRICE)，模组中交易合约如果设置为主力合约（自动移仓），则主力合约切换时以PRICE的委托方式进行移仓。

注：
1、PRICE位置可以填写以下委托方式：
（1）NEW_ORDER 最新价
（2）PASSIVE_ORDER 排队价
（3）ACTIVE_ORDER 对价
（4）TRACING_ORDER 自动连续追价
A:首次下单委托价格参数设置->程序化参数->追价设置的价格方式执行。
（5）CMPETITV_ORDER 超价
A：下单基准按参数设置->程序化参数->超价设置的价格方式执行
（6）LIMIT_ORDER 市价
2、模型中未使用该函数设置换月移仓委托价格方式，主力合约切换时默认按照对价方式进行移仓。
3、该函数只在模组中生效。

例：
C>HV(H,20),BPK;//价格大于前20周期高点平空反手做多
C<LV(L,20),SPK;//价格小于前20周期低点是平多反手做空
TRADE_OTHER('AUTO');//加载到主连合约上，主力换月时自动进行移仓
SETMOVEOPIPRICE(ACTIVE_ORDER);//主力合约切换时，以对价方式进行移仓
AUTOFILTER;
```

### SETSIGPRICETYPE

不同的信号设置不同的委托方式

```pascal
SETSIGPRICETYPE(SIG,PRICE,IsCancel),不同的信号设置不同的委托方式。

用法：SETSIGPRICETYPE(SIG,PRICE1,IsCancel),设置SIG指令的委托方式，PRICE为委托价格，IsCancel为是否启用终止下单。

注：
1、SIG位置为交易指令，包括BK\SK\BP\SP\BPK\SPK\CLOSEOUT\STOP\STOP1所有指令。
2、PRICE位置为委托价格，包括以下八种：
（1）NEW_ORDER 最新价
注：委托方式为NEW_ORDER时支持回测，计算信号价格为信号发出时的最新价。
例如，收盘价模型，当前k线出信号，价格取下一根k线开盘价
（2）PASSIVE_ORDER 排队价
（3）ACTIVE_ORDER 对价
（4）TRACING_ORDER 自动连续追
A：首次下单委托价格参数设置->程序化参数->追价设置的价格方式执行。
B：股票合约不支持追价。
（5）CMPETITV_ORDER 超价
A：下单基准按参数设置->程序化参数->超价设置的价格方式执行
（6）LIMIT_ORDER 市价
（7）SIGPRICE_ORDER 触发价
（8）指定价 可以为具体的数值，也可以为表达式，即支持如下的写法：
A:HHV(H,3);//定义A为3个周期内的最高价
SETSIGPRICETYPE(BK,A);//BK信号按照3个周期的最高价委托
3、参数IsCancel写入CANCEL_ORDER表示启用终止下单程序，
  即：根据PRICE委托后，N秒不成交自动撤单并终止下单。
  参数IsCancel位置不写或写入其他内容，则代表不启用终止下单。
（1）参数N，在参数设置->程序化参数中进行设置。
（2）终止下单不考虑小节休息。
（3）BP、SP、BPK、SPK、CLOSEOUT、STOP、STOP1信号不支持CANCEL_ORDER设置。
4、模型编写中未使用该函数设置指令委托价格方式，默认按照交易参数中设置的程序化默认下单方式进行委托。
5、SETALLSIGPRICETYPE不能和SETSIGPRICETYPE同时使用。
6、该函数只在模组中或者信号预警盒子勾选直接下单不需要手动确认时才生效。

例：
C>HV(H,20),BK;//价格大于前20周期高点买开仓
C<LV(L,20),SK;//价格小于前20周期低点卖开仓
C>HV(H,10),BP;//价格大于前10周期高点平空仓
C<LV(L,10),SP;//价格小于前10周期低点平多仓
SETSIGPRICETYPE(BK,SIGPRICE_ORDER);//买开的委托以触发价委托
SETSIGPRICETYPE(SK,REF(C,1));//卖开的委托以上一周期的收盘价委托
SETSIGPRICETYPE(BP,TRACING_ORDER);//买平的委托以自动连续追价委托
SETSIGPRICETYPE(SP,TRACING_ORDER);//卖平的委托以自动连续追价委托
AUTOFILTER;
```

### T_PLUS

设置开仓手数为默认手数的 N 倍

```pascal
T_PLUS 设置开仓手数为默认手数的N倍

用法：COND,T_PLUS(N) 当条件满足时，一开一平信号过滤模型的开仓手数为默认手数*N倍。

注：
1、该函数只能用于设置一开一平信号过滤模型的手数，不能用于设置加减仓模型的手数。
2、N支持设置为参数，不支持设置为变量。
3、
该函数加载到模组中：满足条件时，下单手数为模组下单手数的N倍
该函数加载到盒子中：满足条件时，下单手数为盒子右键中设置的默认下单手数的N倍。

例：
CROSS(C,MA(C,5)),BK;
CROSS(MA(C,5),C),SP;
CROSS(MA(C,5),MA(C,10)),T_PLUS(2);//开仓条件满足时，五周期均线上穿十周期均线，开仓手数增加为原来的2倍
AUTOFILTER;
```

## 模组头寸函数

### FEE

手续费

```pascal
FEE手续费

用法：FEE返回当前合约的手续费，用于模型中资金、手数相关计算。

注：
1、主图加载、回测中，FEE取值为回测参数中，对手续费的设置
2、模组子账户运行时FEE取值为模组子账户加载时保证金参数中手续费的设置
3、当交易品种手续费为按手数收取，返回值为手续费数值
4、当交易品种手续费按比例收取,返回值为手续费比例，数值为小数

例：
K:=MONEYTOT*0.2/(C*MARGIN*UNIT+FEE); //模组子账户权益的20%可以开仓的手数（此写法适用于按固定手数收取手续费的合约）
```

### INITMONEY

模组初次加载时的起始资金

```pascal
INITMONEY 模组初次加载时的起始资金

用法：INITMONEY 返回模组初次加载时的起始资金。

注：
1、回测时，该函数返回回测参数中设置的初始资金。
2、主图右键加载到模组时，该函数返回回测参数中设置的初始资金。
3、新建模组时，该函数返回保证金参数中设置的模组子账户起始资金。
4、组合测试中该函数返回添加组合成员时设置的初始资金。
5、回测一篮子合约时，该函数返回主图回测参数中设置的初始资金。

例：
K:=INITMONEY*0.2/(C*MARGIN*UNIT+FEE); //模组子账户初始资金的20%可以开仓的手数（此写法适用于按固定手数收取手续费的合约）
```

### LASTOFFSETPROFIT

最近一次交易的平仓盈亏

```pascal
LASTOFFSETPROFIT 最近一次交易的平仓盈亏

用法：LASTOFFSETPROFIT返回当前距当前K线最近一次交易的平仓盈亏，用于风险控制。

注：
1、从开仓到持仓为0被视为一次交易。
2、信号执行方式为‘K线走完确认信号下单’：LASTOFFSETPROFIT根据信号当根K线的收盘价计算平仓盈亏，待下根K线时取值相应变化。
3、信号执行方式为‘XX下单，K线走完复核’：LASTOFFSETPROFIT根据下单当时的行情最新价计算平仓盈亏，复核后待下根K线时取值相应变化。
4、信号执行方式为‘出信号立即下单不复核’：LASTOFFSETPROFIT根据信号确认时的行情最新价计算平仓盈亏。
5、LASTOFFSETPROFIT与日志中记录的平仓盈亏不同，后者根据成交价计算。
6、LASTOFFSETPROFIT的计算不包含手续费。
7、因信号消失产生的盈亏未纳入LASTOFFSETPROFIT的计算。
8、股票T+1交易不支持统计平仓盈亏，该函数返回空值。

例：
LASTOFFSETPROFIT<=-40 && C<BKPRICE-60,CLOSEOUT;//最近一次交易的亏损额大于40并且当前亏损大于60，清仓
```

### MARGIN

保证金

```pascal
MARGIN 保证金

用法：MARGIN返回当前合约的保证金比率，用于模型中资金、手数相关计算。

注：
1、MARGIN返回值为小数
2、主图加载、回测中，MARGIN取值为回测参数中，对保证金的设置
3、模组子账户运行时MARGIN取值为模组子账户加载时保证金参数中保证金的设置

例：
K:=MONEYTOT*0.2/(C*MARGIN*UNIT+FEE); //模组子账户权益的20%可以开仓的手数（此写法适用于按固定手数收取手续费的合约）
```

### MONEY

模组子账户可用资金

```pascal
MONEY 模组子账户可用资金

用法：MONEY返回模组子账户可用资金，用于仓位、手数等计算。

计算方法：
1、模组子账户中MONEY的初始值为保证金参数中设置的起始资金。
2、历史回测中MONEY的初始值为回测参数中设置的初始资金。
3、开仓信号当根k线的MONEY值：开仓前可用资金-持仓保证金-手续费，其中持仓保证金=开仓价格*保证金比例*交易单位*手数
4、开仓后未平仓的k线的MONEY值=开仓信号前k线的MONEY值+浮动盈亏PROFIT
5、平仓信号当根k线的MONEY值：平仓前可用资金+平仓盈亏+平仓释放的保证金-手续费，其中平仓释放的保证金=开仓价格*保证金比例*交易单位*手数

注：
1、信号执行方式为，‘K线走完确认下单’或‘XX下单，K线走完复核’：
  a.开仓信号当根K线，MONEY返回值为上根K线的可用资金-开仓保证金-手续费。
  b.平仓信号当根K线，MONEY返回值为上根K线的可用资金+平仓盈亏+持仓释放的保证金-手续费。
2、信号执行方式选择，‘出信号下单，不进行复核’：
  a.开仓信号当根K线，MONEY返回值为当根k线开仓之前的可用资金-开仓保证金-手续费。
  b.平仓信号当根K线，MONEY返回值为当根K线平仓之前的可用资金+平仓盈亏+平仓释放的保证金-手续费。
3、信号执行方式为‘K线走完确认信号下单’时，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位-手续费。
4、信号执行方式为‘出信号立即下单，不复核’时，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位-手续费。
5、模组子账户初始化后，MONEY返回值为初始化框中可用资金
6、模组监控K线图，十字光标所在K线左侧查价框中显示的资金数值等于MONEY函数返回值

例：
K:=MONEY*0.2/(C*MARGIN*UNIT+FEE); //模组子账户可用资金的20%可以开仓的手数（此写法适用于按固定手数收取手续费的合约）
```

### MONEYRATIO

模组子账户资金使用率

```pascal
MONEYRATIO 模组子账户资金使用率

用法：MONEYRATIO返回当前的模组子账户的资金使用率，模型进行资金管理控制仓位时使用。

计算方法：资金使用率=动态的持仓保证金/权益。

注：
1、该函数返回值为小数。
2、开仓信号当根k线持仓保证金：
  a.信号执行方式为‘XX下单，K线走完复核’：持仓保证金=当根K线的收盘价*交易单位*持仓手数*保证金比例。
  b.信号执行方式为‘出信号立即下单，不复核’：持仓保证金=最新价*交易单位*持仓手数*保证金比例。
  c.信号执行方式为‘K线走完确认信号下单’：持仓保证金=当根K线的收盘价*交易单位*持仓手数*保证金比例。在出开仓信号之后的K线返回相应的值
3、开仓后平仓前K线持仓保证金=当根K线的收盘价*交易单位*持仓手数*保证金比例。开仓后未平仓的k线的保证金和开仓信号当根k线的保证金一样，保持不变，当日如果存在未被平掉的持仓并持仓过夜，第二日未平仓k线的保证金不会按照前一日结算价计算。
4、平仓信号，当平仓后无持仓时，MONEYRATIO在出平仓信号之后的k线上返回0

例：
A&&MONEYRATIO<0.3,BK;//A条件满足并资金使用率不超过30%时，买开仓
```

### MONEYREAL

模组子账户实际权益

```pascal
MONEYREAL 模组子账户实际权益

用法：MONEYREAL返回当前模组子账户实际权益，显示为模组的实际资金曲线

计算方法：MONEYREAL=模组子账户初始权益值+平仓盈亏+浮动盈亏-手续费成本

注：
1、模组子账户中初始权益值：
  a.新建的模组，MONEYREAL返回值与MONEYTOT返回值一致
  b.打开已有的模组时，模组子账户的初始权益值为上一次退出模组时的模组子账户实际权益
2、平仓盈亏和手续费从模组子账户加载时刻开始累计计算
3、历史回测中MONEYREAL返回值与MONEYTOT返回值一致，产生实际交易时，MONEYREAL的返回值才开始变化

例：
K:=MONEYREAL*0.2/(C*MARGIN*UNIT+FEE); //模组子账户实际权益的20%可以开仓的手数（此写法适用于按固定手数收取手续费的合约）
```

### MONEYTOT

模组子账户权益

```pascal
MONEYTOT 模组子账户权益

用法：MONEYTOT返回当前模组子账户权益，模型进行仓位控制、下单手数等资金管理时使用

计算方法：MONEYTOT=模组子账户可用资金+持仓保证金

注：
1、模组子账户中MONEYTOT的初始值为保证金参数中设置的起始资金。
2、历史回测中MONEYTOT的初始值为回测参数中设置的初始资金。
3、模组子账户初始化时：
  a.当前信号为开仓信号，MONEYTOT返回值为初始化框中模组子账户可用资金；
  b.当前信号为平仓信号，则MONEYTOT返回初始化框中模组子账户可用资金+持仓保证金。
4、开仓信号当根k线：MONEYTOT=模组子账户可用资金+持仓保证金
5、开仓后平仓前：MONEYTOT返回当前模组子账户可用资金+持仓保证金
6、平仓信号当根k线：持仓为0时，MONEYTOT=模组可用资金；持仓不为0时，MONEYTOT=模组可用资金+持仓占用的保证金。
注：
模组持仓列表可用资金为包含了浮动盈亏的可用资金（= 当前权益 - 持仓占用的保证金）。

例：
K:=MONEYTOT*0.2/(C*MARGIN*UNIT+FEE); //模组子账户权益的20%可以开仓的手数（此写法适用于按固定手数收取手续费的合约）
```

### MYVOL

取下单手数

```pascal
MYVOL 取下单手数

用法：取下单手数，多用于在加减仓模型加载多个合约的时候的手数计算。

注：
1、模组加载：
主图右键加载到模组：返回主图回测参数设置中设置的手数
新建模组：返回交易参数中设置的手数
2、页面盒子：
主图右键加载到盒子：历史信号MYVOL返回主图回测参数中设置的手数，盘中新生成的K线返回默认下单手数
新建盒子：返回默认下单手数
3、主图回测：返回回测参数中设置的手数

例：
//加载参数中下单手数设置为3时，下面编写BK的下单手数为6；
C>O,BK(2*MYVOL);
C<O,SP(BKVOL);
```

### OFFSETPROFIT

模组子账户的平仓盈亏

```pascal
OFFSETPROFIT 模组子账户的平仓盈亏

用法：OFFSETPROFIT返回当前模组子账户的平仓盈亏，用于风险控制。

注：
1、模组子账户初始化后，OFFSETPROFIT清零重新计算，从模组子账户加载时刻开始计算平仓盈亏。
2、信号执行方式为‘K线走完确认信号下单’：OFFSETPROFIT根据信号当根K线的收盘价计算平仓盈亏，待下根K线时取值相应变化。
3、信号执行方式为‘XX下单，K线走完复核’：OFFSETPROFIT根据下单时行情的最新价计算平仓盈亏，复核后待下根K线时取值相应变化。
4、信号执行方式为‘出信号立即下单不复核’：OFFSETPROFIT根据信号确认时的行情最新价计算平仓盈亏。
5、OFFSETPROFIT与日志中记录的平仓盈亏不同，后者根据成交价计算。
6、OFFSETPROFIT的计算不包含手续费。
7、因信号消失产生的盈亏未纳入OFFSETPROFIT的计算
8、股票T+1交易不支持统计平仓盈亏，该函数返回空值。

例：
OFFSETPROFIT<-5000&&C>O,BK;//平仓盈亏大于-5000，并且当前K线为阳线时，买开
```

### OFFSETPROFIT1

累计平仓盈亏

```pascal
OFFSETPROFIT1 累计平仓盈亏

用法：OFFSETPROFIT1返回加载的全部K线的累计平仓盈亏。

注：
1、模组子账户初始化后，OFFSETPROFIT1不会清零，延续之前的信号计算累计平仓盈亏。
2、信号执行方式为‘K线走完确认信号下单’：OFFSETPROFIT1根据信号当根K线的收盘价计算平仓盈亏，待下根K线时取值相应变化。
3、信号执行方式为‘XX下单，K线走完复核’：OFFSETPROFIT1根据下单时行情最新价计算平仓盈亏，复核后待下根K线时取值相应变化。
4、信号执行方式为‘出信号立即下单不复核’：OFFSETPROFIT1根据信号确认时的行情最新价计算平仓盈亏。
5、OFFSETPROFIT1与日志中记录的平仓盈亏不同，后者根据成交价计算。
6、OFFSETPROFIT1的计算不包含手续费。
7、因信号消失产生的盈亏未纳入OFFSETPROFIT1的计算。
8、股票T+1交易不支持统计平仓盈亏，该函数返回空值。

例：
OFFSETPROFIT1<=-100,CLOSEOUT;//累计亏损大于100，清仓
```

### PROFIT

模组子账户逐笔浮盈

```pascal
PROFIT 模组子账户逐笔浮盈

用法：PROFIT返回当前的模组子账户逐笔浮动盈亏，用于交易策略风险控制。

计算方法：
多头：PROFIT=（最新价-开仓价格）*手数*交易单位
空头：PROFIT=（开仓价格-最新价）*手数*交易单位

注：
1、模组子账户初始化多头持仓后，PROFIT返回值为（最新价-开仓价格）*手数*交易单位，空头返回值为（开仓价格-最新价）*手数*交易单位。
2、开仓信号当根K线，信号确认后，多头持仓PROFIT返回（最新价-开仓价格）*手数*交易单位，空头持仓PROFIT返回（开仓价格-最新价）*手数*交易单位。
3、开仓后平仓前多头持仓PROFIT返回值为（最新价-开仓价格）*手数*交易单位，空头持仓返回值为（开仓价格-最新价）*手数*交易单位。
4、持仓为0，PROFIT返回值为0。
5、模组子账户中开仓价格的算法：
  a.信号执行方式为‘K线走完确认信号下单’开仓价格为开仓信号当根K线的收盘价
  b.信号执行方式为‘XXX下单，K线走完复核’开仓价格为开仓信号指令价
  c.信号执行方式为‘XXX下单，不进行信号复核’开仓价格为开仓信号指令价
6、加减仓模型加仓后，开仓价格按照‘5’中不同信号执行方式取值后再进行平均。
7、加减仓模型减仓按先开先平原则，平最先开的仓位，PROFIT计算公式中，用现有持仓的开仓价格计算，手数减少。

例：
PROFIT<-2000,SP;//亏损2000元止损
```

### SETDEALPERCENT

按模组子账户的理论资金比例下单

```pascal
SETDEALPERCENT 按模组子账户的理论资金比例下单

用法：SETDEALPERCENT(fPercent)表示每次按模组子账户理论资金的fPercent比例下单。

计算公式：fPercent比例可下单手数=（前期可用资金+平仓释放的保证金+平仓盈亏）*fPercent/（最新价*保证金比例*交易单位）。

注：
1、fPercent取值范围1-100，并且支持变量。
2、SETDEALPERCENT计算出的下单手数非整数时，遵循自动向下取整的规则；如果手数小于1，不进行开仓操作。
3、SETDEALPERCENT只作用于开仓指令，不作用于平仓指令。含有该函数的一开一平信号过滤模型，平仓信号默认全平。
4、加减仓模型中如果写了该函数，则开仓按照该函数设置的资金比例下单，默认下单手数及信号后写入的手数均无效；平仓信号按照信号后写入的手数进行下单
5、模组子账户用保证金参数中设置的初始资金、保证金计算下单手数
6、历史回测用回测参数中设置的初始资金、保证金计算下单手数
7.SETDEALPERCENT函数不能与STOCKT0函数连用

例：
SETDEALPERCENT(20); //每次按理论资金比例的20%下单
```

### TAVWINLOSS

判断平均盈亏额

```pascal
TAVWINLOSS 判断平均盈亏额

注：
1、平均盈亏额=总盈亏/交易次数
2、从开仓到持仓为0被视为一次交易。
3、收盘价模型，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位。
指令价模型，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位。
4、TAVWINLOSS的计算不包含手续费。
5、因信号消失产生的盈亏、交易次数未纳入TAVWINLOSS的计算。

例：
MA5:MA(C,5);
MA10:MA(C,10);
CROSSUP(MA5,MA10),BK;
CROSSDOWN(MA5,MA10),SP;
IDLE(TAVWINLOSS<100);//平均盈亏额小于100限制开仓
AUTOFILTER;
```

### TAVWIN

判断平均盈利额

```pascal
TAVWIN 判断平均盈利额

注：
1、平均盈利额=总盈利/总盈利次数
2、从开仓到持仓为0被视为一次交易。
3、收盘价模型，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位。
指令价模型，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位。
4、TAVWIN的计算不包含手续费。
5、因信号消失产生的盈亏、交易次数未纳入TAVWIN的计算。

例：
MA5:MA(C,5);
MA10:MA(C,10);
CROSSUP(MA5,MA10),BK;
CROSSDOWN(MA5,MA10),SP;
IDLE(TAVWIN<700);//平均盈利额小于700限制开仓
AUTOFILTER;
```

### TAVLOSS

判断平均亏损额

```pascal
TAVLOSS 判断平均亏损额

注：
1、平均亏损额=总亏损/总亏损次数
2、从开仓到持仓为0被视为一次交易。
3、收盘价模型，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位。
指令价模型，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位。
4、TAVLOSS的计算不包含手续费。
5、因信号消失产生的盈亏、交易次数未纳入TAVLOSS的计算。

例：
MA5:MA(C,5);
MA10:MA(C,10);
CROSSUP(MA5,MA10),BK;
CROSSDOWN(MA5,MA10),SP;
IDLE(TAVLOSS>550);//平均亏损额大于550限制开仓
AUTOFILTER;
```

### TMAXWIN

判断单次盈利最大额

```pascal
TMAXWIN 判断单次盈利最大额

注：
1、该函数返回交易以来，盈利最大的一次交易的盈利额
2、从开仓到持仓为0被视为一次交易。
3、收盘价模型，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位。
指令价模型，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位。
4、TMAXWIN的计算不包含手续费。
5、因信号消失产生的盈亏未纳入TMAXWIN的计算。

例：
MA5:MA(C,5);
MA10:MA(C,10);
CROSSUP(MA5,MA10),BK;
CROSSDOWN(MA5,MA10),SP;
IDLE(TMAXWIN<1000);//单次最大盈利额小于1000限制开仓
AUTOFILTER;
```

### TMAXLOSS

判断单次亏损最大额

```pascal
TMAXLOSS 判断单次亏损最大额

注：
1、该函数返回交易以来，亏损最大的一次交易的亏损额
2、从开仓到持仓为0被视为一次交易。
3、收盘价模型，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位。
指令价模型，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位。
4、TMAXLOSS的计算不包含手续费。
5、因信号消失产生的盈亏未纳入TMAXLOSS的计算。

例：
MA5:MA(C,5);
MA10:MA(C,10);
CROSSUP(MA5,MA10),BK;
CROSSDOWN(MA5,MA10),SP;
IDLE(TMAXLOSS>1000);//单次最大亏损额大于1000限制开仓
AUTOFILTER;
```

### TMAXSEQLOSS

判断连续亏损交易的最大次数

```pascal
TMAXSEQLOSS 判断连续亏损交易的最大次数。

注：
1、该函数返回当前位置之前，连续亏损交易的最大次数。
2、从开仓到持仓为0被视为一次交易。
3、收盘价模型，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位。
指令价模型，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位。
4、TMAXSEQLOSS的计算不包含手续费。
5、因信号消失产生的盈亏、交易次数未纳入TMAXSEQLOSS的计算。

例：
CROSS(C,MA(C,5)),BK(2);//最新价上穿五周期均线，开仓两手
CROSS(MA(C,5),C),SP(1);//最新价下穿五周期均线，卖平1手
TSEQLOSS>60||TMAXSEQLOSS>3,SP(BKVOL);//最大连续亏损额大于60时或最大连续亏损次数大于3次时，平掉全部多头持仓
```

### TMAXSEQWIN

判断连续赢利交易的最大次数

```pascal
TMAXSEQWIN 判断连续赢利交易的最大次数。

注：
1、该函数返回当前位置之前，连续赢利交易的最大次数。
2、从开仓到持仓为0被视为一次交易。
3、收盘价模型，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位。
指令价模型，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位。
4、TMAXSEQWIN的计算不包含手续费。
5、因信号消失产生的盈亏、交易次数未纳入TMAXSEQWIN的计算。

例：
CROSS(C,MA(C,5)),BK(2);//最新价上穿五周期均线，开仓两手
CROSS(MA(C,5),C),SP(1);//最新价下穿五周期均线，卖平1手
TSEQWIN>20||TMAXSEQWIN>3,BK(2);//最大连续赢利额大于20时或最大连续赢利次数大于3次时，加仓2手
```

### TNUMSEQLOSS

判断持续亏损的次数

```pascal
TNUMSEQLOSS 判断持续亏损的次数。

注：
1、从开仓到持仓为0被视为一次交易。
2、收盘价模型，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位。
指令价模型，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位。
3、TNUMSEQLOSS的计算不包含手续费。
4、当根k线上是反手信号，反手信号开仓时，该函数返回上一次信号发出时的持续亏损次数（即此次反手信号的平仓部分的盈亏不计算在内）
5、因信号消失产生的盈亏、交易次数未纳入TNUMSEQLOSS的计算。

例：
CROSS(C,MA(C,5)),BK(2);//最新价上穿五周期均线，开仓两手
CROSS(MA(C,5),C),SP(1);//最新价下穿五周期均线，卖平1手
TNUMSEQLOSS>2,SP(BKVOL);//连续亏损的次数大于2时，平掉全部多头持仓
```

### TNUMSEQWIN

判断持续赢利的次数

```pascal
TNUMSEQWIN 判断持续赢利的次数。

注：
1、从开仓到持仓为0被视为一次交易。
2、收盘价模型，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位。
指令价模型，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位。
3、TNUMSEQWIN的计算不包含手续费。
4、当根k线上是反手信号，反手信号开仓时，该函数返回上一次信号发出时的持续赢利次数（即此次反手信号的平仓部分的盈亏不计算在内）
5、因信号消失产生的盈亏、交易次数未纳入TNUMSEQWIN的计算。

例：
CROSS(C,MA(C,5)),BK(2);//最新价上穿五周期均线，开仓两手
CROSS(MA(C,5),C),SP(BKVOL);//最新价下穿五周期均线，卖平多头持仓
TNUMSEQWIN>=2,BK(1);//连续赢利的次数大于等于2次时，加仓一手
```

### TODAYDEUCETIMES

判断当日平出次数

```pascal
TODAYDEUCETIMES 判断当日平出次数。

注：
1、该函数返回当日平出的次数。
2、当日是以交易日计算的，不是自然日。
3、从开仓到持仓为0被视为一次交易。
4、收盘价模型，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位。
指令价模型，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位。
5、TODAYDEUCETIMES的计算不包含手续费。
6、因信号消失产生的盈亏、交易次数未纳入TODAYDEUCETIMES的计算。

例：
TODAYDEUCETIMES<3&&CROSS(C,MA(C,5)),BK(1);//当日平出次数小于三次且最新价上穿五周期均线，开仓一手
CROSS(MA(C,5),C),SP(BKVOL);//最新价下穿五周期均线，卖平多头持仓
```

### TODAYLOSSTIMES

判断当日亏损次数

```pascal
TODAYLOSSTIMES 判断当日亏损次数。

注：
1、该函数返回当日亏损的次数。
2、当日是以交易日计算的，不是自然日。
3、从开仓到持仓为0被视为一次交易。
4、收盘价模型，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位。
指令价模型，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位。
5、TODAYLOSSTIMES的计算不包含手续费。
6、因信号消失产生的盈亏、交易次数未纳入TODAYLOSSTIMES的计算。

例：
TODAYLOSSTIMES<3&&CROSS(C,MA(C,5)),BK(1);//当日亏损次数小于三次且最新价上穿五周期均线，开仓一手
CROSS(MA(C,5),C),SP(BKVOL);//最新价下穿五周期均线，卖平多头持仓
```

### TODAYWINTIMES

判断当日赢利次数

```pascal
TODAYWINTIMES 判断当日赢利次数。

注：
1、该函数返回当日赢利的次数。
2、当日是以交易日计算的，不是自然日。
3、从开仓到持仓为0被视为一次交易。
4、收盘价模型，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位。
指令价模型，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位。
5、TODAYWINTIMES的计算不包含手续费。
6、因信号消失产生的盈亏、交易次数未纳入TODAYWINTIMES的计算。

例：
CROSS(C,MA(C,5)),BK(1);//最新价上穿五周期均线，开仓一手
TODAYWINTIMES=3,BK(2);//当日赢利3次时，加仓2手
CROSS(MA(C,5),C),SP(BKVOL);//最新价下穿五周期均线，卖平多头持仓
```

### TPROFIT_REF

取得前第 N 次交易的盈亏额

```pascal
TPROFIT_REF(N) 取得前第N次交易的盈亏额。

注：
1、该函数返回当前位置之前第N次交易的盈亏额，如果赢利该函数返回正数，亏损返回负数。
2、从开仓到持仓为0被视为一次交易。
3、N支持写为变量或者参数。
4、收盘价模型，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位。
指令价模型，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位。
5、TPROFIT_REF的计算不包含手续费
6、按交易合约计算

例：
CROSS(C,MA(C,5)),BK(1);//最新价上穿五周期均线，开仓一手
TPROFIT_REF(1)>0&&TPROFIT_REF(2)>0&&TPROFIT_REF(1)>TPROFIT_REF(2),BK(2);//最近连续两笔交易都是赢利的，且赢利额是增长的，加仓2手
CROSS(MA(C,5),C),SP(BKVOL);//最新价下穿五周期均线，卖平多头持仓
```

### TRADE_REF

判断前 N 次交易是否赢利

```pascal
TRADE_REF(N) 判断前N次交易是否赢利。

注：
1、该函数返回当前位置之前的第N次交易是否赢利，如果赢利返回1，亏损返回0。
2、从开仓到持仓为0被视为一次交易。
3、N支持写为变量或者参数。
4、收盘价模型，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位。
指令价模型，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位。
5、TRADE_REF的计算不包含手续费
6、按交易合约计算

例：
CROSS(C,MA(C,5)),BK(1);//最新价上穿五周期均线，开仓一手
TRADE_REF(1)=1&&TRADE_REF(2)=1&&TRADE_REF(3)=1,BK(2);//最近连续三笔交易都是赢利的，加仓2手
CROSS(MA(C,5),C),SP(BKVOL);//最新价下穿五周期均线，卖平多头持仓
```

### TSEQLOSS

判断最大连续亏损额

```pascal
TSEQLOSS 判断最大连续亏损额。

注：
1、该函数返回当前位置之前，连续亏损额的最大值。
2、从开仓到持仓为0被视为一次交易。
3、收盘价模型，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位。
指令价模型，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位。
4、TSEQLOSS的计算不包含手续费。
5、因信号消失产生的盈亏未纳入TSEQLOSS的计算。

例：
CROSS(C,MA(C,5)),BK(2);//最新价上穿五周期均线，开仓两手
CROSS(MA(C,5),C),SP(BKVOL);//最新价下穿五周期均线，卖平全部持仓
TSEQLOSS<-5000,SK(2);//最大连续亏损额达到5000时，反向开仓2手
```

### TSEQWIN

判断最大连续赢利额

```pascal
TSEQWIN 判断最大连续赢利额。

注：
1、该函数返回当前位置之前，连续赢利额的最大值。
2、从开仓到持仓为0被视为一次交易。
3、收盘价模型，平仓盈亏=（平仓信号当根K线的收盘价-开仓价格）*手数*交易单位。
指令价模型，平仓盈亏=（平仓信号的指令价-开仓价格）*手数*交易单位。
4、TSEQWIN的计算不包含手续费。
5、因信号消失产生的盈亏未纳入TSEQWIN的计算。

例：
CROSS(C,MA(C,5)),BK(2);//最新价上穿五周期均线，开仓两手
CROSS(MA(C,5),C),SP(1);//最新价下穿五周期均线，卖平1手
TSEQWIN>20,BK(2);//最大连续赢利额大于20时，加仓2手
```

### UNITLIMIT

取交易合约的限制拥有持仓数

```pascal
UNITLIMIT 取交易合约的限制拥有持仓数

用法：UNITLIMIT自动取该合约交易所规定的限制拥有持仓数，避免违规。

注：
取不到时返回100000（如指数合约）

例:
(BKVOL+1)<=UNITLIMIT&&C>O,BK(1);//多头持仓再增加一手仍然小于交易合约的限制拥有的持仓数，并且满足收盘价大于开盘价的开仓条件时，买开一手。
```

### VOLMARGIN

模组子账户持仓保证金

```pascal
VOLMARGIN 模组子账户持仓保证金

用法：VOLMARGIN计算当前模组子账户的持仓保证金，用于资金管理。

计算公式：VOLMARGIN=价格*交易单位*手数*保证金比例

注：
1、该保证金为动态的保证金，随价格变化而变化
2、模组子账户中手动调仓会影响VOLMARGIN的返回值
3、开仓信号当根k线VOLMARGIN=开仓价*交易单位*手数*保证金比例，根据不同信号执行方式，开仓价为：
信号执行方式为‘k线走完确认信号下单’开仓为当根K线的收盘价
信号执行方式为‘XXX下单，K线走完进行信号复核’，开仓价为信号发出时行情的最新价
信号执行方式为‘出信号立即下单，不进行复核’，开仓价为信号发出时行情的最新价
4、平仓信号当根k线和无持仓k线，VOLMARGIN返回值为0。
```

## 账户头寸函数

### ACCOUNTMONEY

返回交易账户中的可用资金

```pascal
返回交易账户中的可用资金。
用法：
ACCOUNTMONEY 在盒子中返回交易账户中的可用资金。
注：
1、不支持回测与模组运行，只适用于盒子。
2、只能用于单账号。
3、返回值为整数。
```

### ACCOUNTMONEYTOT

返回交易账户中的权益

```pascal
返回交易账户中的权益。
用法：
ACCOUNTMONEYTOT 在盒子中返回交易账户中的权益。
注：
1、不支持回测与模组运行，只适用于盒子。
2、只能用于单账号。
3、返回值为整数。
```

### BUYPOSITION

取交易账户中的多头持仓

```pascal
取交易账户中的多头持仓。
用法：
BUYPOSITION 在盒子中取交易账户中的多头持仓。
注：
1、不支持回测与模组运行，只适用于盒子。
2、只能用于单账号。
3、返回值为整数。
```

### BUYREMAINPOSITION

取交易账户中的多头可用持仓

```pascal
取交易账户中的多头可用持仓。
用法：
BUYREMAINPOSITION 在盒子中取交易账户中的多头可用持仓。
注：
1、不支持回测与模组运行，只适用于盒子。
2、只能用于单账号。
3、返回值为整数。
```

### SELLPOSITION

取交易账户中的空头持仓

```pascal
取交易账户中的空头持仓。
用法：
SELLPOSITION 在盒子中取交易账户中的空头持仓。
注：
1、不支持回测与模组运行，只适用于盒子。
2、只能用于单账号。
3、返回值为整数。
```

### SELLREMAINPOSITION

取交易账户中的空头可用持仓

```pascal
取交易账户中的空头可用持仓。
用法：
SELLREMAINPOSITION 在盒子中取交易账户中的空头可用持仓。
注：
1、不支持回测与模组运行，只适用于盒子。
2、只能用于单账号。
3、返回值为整数。
```

## 策略优化函数

### CHECKSIG

设置信号确认与复核的指令价方式（TICK 逐笔回测，可设置回测精度）

```pascal
CHECKSIG 设置信号确认与复核的指令价方式（TICK逐笔回测，可设置回测精度）

用法：
CHECKSIG(SIG,MODE1,TIME1,MODE2,TIME2,INTERVAL);
1、当INTERVAL不为0时，INTERVAL数据时间间隔，每隔INTERVAL秒计算一次信号，SIG为信号,MODE1为信号确认方式,TIME1信号确认时间乘数,MODE2信号复核方式,TIME2信号复核时间乘数。
（例：INTERVAL为10，豆粕合约开盘第一根K线21：00：09为第一次计算模型，21：00：19为第二次计算模型...）
2、当INTERVAL为0时，每笔TICK计算一次信号，SIG为信号,MODE1为信号确认方式,TIME1信号确认时间,MODE2信号复核方式,TIME2信号复核时间。
3、通过调整INTERVAL参数，模型可设置不同数据快照频率进行回测。

注：
1、写了这个函数以后，模型会按照指令价方式运行。
2、SIG位置为交易指令，包括BK\SK\BP\SP\BPK\SPK\CLOSEOUT所有指令。
3、MODE1位置为信号确认方式，有A和B两种：
A：MODE1为'A'时
  1）当INTERVAL不为0时，出信号后第TIME1个数据时间间隔确认信号下单
  2）当INTERVAL为0时，出信号TIME1秒后确认信号下单
B：MODE1为'B'时
  1）当INTERVAL不为0时，K线走完前TIME1个时间间隔确认信号下单
  2）当INTERVAL为0时，K线走完前TIME1秒确认信号下单
  3）TIME1=0为K线走完确认信号下单
4、MODE2位置为信号复核方式，有C，D，E和F四种：
C：MODE2为'C'时
  1）当INTERVAL不为0时，出信号后第TIME2个数据时间间隔进行信号复核
  2）当INTERVAL为0时，出信号TIME2秒后进行信号复核，TIME2=0为不复核
D：MODE2为'D'时
  1）当INTERVAL不为0时，K线走完前TIME2个时间间隔进行信号复核
  2）当INTERVAL为0时，K线走完前TIME2秒进行信号复核
  3）TIME2=0为K线走完复核
E：每一个以小节(包括：商品合约10:15-10:30休盘、11:30-13:30休市、21:00-23:00(或23:30或1:00或2:30)夜盘小节；股指合约11:30-13:00休市)为结束时间的K线提前复核，其他非小节时间结束的K线为K线走完复核。
  1）当INTERVAL不为0时，提前TIME2个时间间隔进行信号复核
  2）当INTERVAL为0时，提前TIME2秒进行信号复核
  3）TIME2=0为K线走完复核
F：每天以收盘时间为结束时间的K线提前复核，其他不以收盘时间为结束时间的K线为K线走完复核
  1）当INTERVAL不为0时，提前TIME2个时间间隔进行信号复核
  2）当INTERVAL为0时，提前TIME2秒进行信号复核
  3）TIME2=0为K线走完复核
5、INTERVAL代表数据时间间隔
  1）支持0、3、5、10四个值，不支持变量。
  2）3、5、10分别代表用每隔3秒、5秒、10秒，计算一次模型
  3）参数为3、5、10 ，回测速度可提升3-10倍，回测精度稍差
  4）参数为0的时 为每笔TICK计算一次模型
  5）一个模型中只能写入一个INTERVAL值
6、模型中写入该函数，一根K线只能有一个信号。
7、CHECKSIG、MULTSIG、MULTSIG_MIN、CHECKSIG_MIN函数不能同时出现在一个模型中
8、该函数只允许在模组中使用，不支持加载到盒子。
9、未使用该函数的指令，默认的信号执行方式为K线走完确认信号下单。
10、TIME1，TIME2非0时，该函数不支持加载到日线以上的周期中使用。
例如：量能周期出信号TIME1个数据时间间隔下单， K线走完前TIME2个数据时间间隔复核之类的都不支持
11、该函数不支持加载到量能周期使用。
12、如果用该函数设置了信号复核，复核时产生了信号消失，会进行信号消失处理。信号消失的处理方式：
还没有成交时的信号消失处理-撤单
BK、SK信号消失处理-平仓
BPK、SPK信号消失处理-平仓+恢复建仓
BP、SP信号消失处理-恢复建仓

例：
C>O,BK;
C<O,SP;
CHECKSIG(BK,'A',5,'D',0,3);//设置BK信号，出信号后第5个数据时间间隔确认下单（例如21:00:02满足条件，出现信号后第5次计算信号，即21:00：17时确认信号下单），K线走完复核。每隔3秒计算一次信号。
CHECKSIG(SP,'A',0,'C',10,3);//设置SP信号，根据数据时间间隔计算出信号后立即下单（例如21:00:02满足条件，出现信号后立即下单），下单后第10个数据时间间隔复核（例如21:00：17时确认信号下单，则确认下单后第10次计算模型，即21:00:47进行信号复核）。每隔3秒计算一次信号。
AUTOFILTER;
```

### CHECKSIG_MIN

设置信号确认与复核的指令价方式（逐分钟回测）

```pascal
CHECKSIG_MIN 设置信号确认与复核的指令价方式（逐分钟回测）

用法：
CHECKSIG_MIN(SIG,MODE1,TIME1,MODE2,TIME2);SIG为信号,MODE1为信号确认方式,TIME1信号确认时间,MODE2信号复核方式,TIME2信号复核时间。

注：
1、写了这个函数以后，模型会按照指令价方式运行。
2、使用该函数时，基础数据为1分钟数据。(TIME1 TIME2不支持小数)
3、该函数不支持加载在15分钟以下周期使用
4、SIG位置为交易指令，包括BK\SK\BP\SP\BPK\SPK\CLOSEOUT所有指令。
5、MODE1位置为信号确认方式，有A和B两种：
A：出信号TIME1分钟确认信号下单。TIME1>0为出信号TIME1分钟确认信号下单，TIME1=0为出信号立即下单。
B：K线走完前TIME1分钟确认信号下单。TIME1>0为K线走完前TIME1分钟确认信号下单(不支持加载在日线以上周期)，TIME1=0为K线走完确认信号下单
6、MODE2位置为信号复核方式，有C，D，E和F四种：
C：下单后TIME2分钟进行信号复核。TIME2>0为下单后TIME2分钟进行信号复核，TIME2=0为不复核。
D：K线走完前TIME2分钟进行信号复核。TIME2>0为K线走完前TIME2分钟进行信号复核(不支持加载在日线以上周期)，TIME2=0为K线走完复核。
E：每一个以小节(包括：商品合约10:15-10:30休盘、11:30-13:30休市、21:00-23:00(或23:30或1:00或2:30)夜盘小节；股指合约11:30-13:00休市)为结束时间的K线提前复核。TIME2>0为每一个以小节为结束时间的K线提前TIME2分钟进行信号复核(不支持加载在日线以上周期)，TIME2=0为K线走完复核。其他非小节时间结束的K线为K线走完复核。
F：以收盘时间为结束时间的K线为提前TIME2分钟复核。TIME2>0为以收盘时间为结束时间的K线提前TIME2分钟进行信号复核(不支持加载在日线以上周期)，TIME2=0为K线走完复核。其他非收盘时间结束的K线为K线走完复核。
7、模型中写入该函数，一根K线只能有一个信号。
8、MULTSIG、MULTSIG_MIN、CHECKSIG和CHECKSIG_MIN函数不能同时出现在一个模型中
9、该函数只允许在模组中使用，不支持加载到盒子。
10、未使用该函数的指令，默认的信号执行方式为K线走完确认信号下单。
11、参数TIME1、TIME2非0时，该函数不支持加载到日线以上的周期中使用。
12、如果用该函数设置了信号复核，复核时产生了信号消失，会进行信号消失处理。信号消失的处理方式：
还没有成交时的信号消失处理-撤单
BK、SK信号消失处理-平仓
BPK、SPK信号消失处理-平仓+恢复建仓
BP、SP信号消失处理-恢复建仓

几种典型的信号复核确认方式对应的写法举例：
CHECKSIG_MIN(SIG,'A',0,'D',0);//出信号立即下单，K线走完复核
CHECKSIG_MIN(SIG,'A',N,'D',0);//出信号N分钟确认信号下单，K线走完复核
CHECKSIG_MIN(SIG,'A',N,'C',0);//出信号N分钟确认信号下单，不进行复核
CHECKSIG_MIN(SIG,'B',N,'D',0);//K线走完前N分钟确认信号下单，K线走完复核
CHECKSIG_MIN(SIG,'B',N,'C',0);//K线走完前N分钟确认信号下单，不复核
CHECKSIG_MIN(SIG,'B',0,'C',N);//K线走完确认信号下单
CHECKSIG_MIN(SIG,'B',0,'D',0);//K线走完确认信号下单
CHECKSIG_MIN(SIG,'A',0,'C',0);//出信号立即下单，不复核
CHECKSIG_MIN(SIG,'A',0,'F',10);//出信号立即下单，收盘前最后一根K线提前10分钟进行复核。

例：
C>O,BK;
C<O,SP;
CHECKSIG_MIN(BK,'A',5,'D',0);//设置BK信号，出信号5分钟后确认下单，K线走完复核。
CHECKSIG_MIN(SP,'A',0,'C',10);//设置SP信号，出信号立即下单，下单后10分钟复核。
AUTOFILTER;
```

### IDLE

限制开仓信号发出委托

```pascal
IDLE(COND) 限制开仓信号发出委托

用法：IDLE(COND)，当开仓信号发出时，如果COND条件成立，该信号不委托。IDLE函数对平仓信号不起作用，有持仓时即使满足COND也可以平仓。

注：
1.模组加载运行：
（1）该函数不影响模型出现信号，满足开仓条件，图中仍然会出现信号；
（2）COND条件满足后，只对开仓信号起作用，开仓信号发出时，如果COND条件成立，该信号不委托；平仓信号发出时，如果子账户持仓>0，根据平仓信号正常进行委托
（3）COND条件满足后，理论持仓、理论资金的计算不受该函数的影响，仍然根据信号正常执行进行计算
（4）COND条件满足后，可以进行头寸同步、手动调仓、补仓的操作
2、回测：
（1）该函数不影响模型出现信号，满足开仓条件，图中仍然会出现信号；
（2）模型中含有IDLE函数，信号仍然根据理论持仓、理论资金进行计算
（3）模型中含有IDLE函数，回测报告根据子账户持仓、子账户资金进行计算
3、该函数支持与反手指令同时使用
4、该函数与反手指令同时使用CODE条件中不支持含有平仓盈亏相关的函数（例如连续亏损、盈利次数以及可用资金）
5、该函数不支持加载到套利合约使用
6、该函数只允许在模组中使用，不支持加载到盒子

例:
MA10:MA(C,20);
MA30:MA(C,30);
GG:=HHV(MONEYTOT,0);//第一个有效值开始权益的最大值
C>MA30,BK;
C<MA30,SK;
C>MA10,BP;
C<MA10,SP;
IDLE(MONEYTOT<GG*0.95&&MONEYTOT>GG*0.92||MONEYTOT<GG*0.85);//权益回撤一定幅度停止交易
AUTOFILTER;
```

### MULTSIG

设置一根 k 线多信号的指令价方式（TICK 逐笔回测，可设置回测精度）

```pascal
MULTSIG(Sec1,Sec2,N,INTERVAL) 设置一根k线多信号的指令价方式（TICK逐笔回测，可设置回测精度）

用法：
MULTSIG(Sec1,Sec2,N,INTERVAL)
1、当INTERVAL不为0时，INTERVAL为数据时间间隔,每隔INTERVAL秒计算一次信号，开仓信号在出信号后的第Sec1个数据时间间隔时下单不复核,平仓信号在出信号后的第Sec2个数据时间间隔下单不复核，一根K线上最大的信号个数为N。
（例：INTERVAL为10，豆粕合约开盘第一根K线21：00：09为第一次计算模型，21：00：19为第二次计算模型...）
2、当INTERVAL为0时，每笔TICK计算一次信号，开仓信号Sec1秒后下单不复核,平仓信号Sec2秒后下单不复核，一根K线上最大的信号个数为N。
（例：Sec1为0，则为开仓信号出信号立即下单，不复核；如果Sec1为1，则为开仓信号出信号1秒后下单，不复核）
3、通过调整INTERVAL参数，模型可设置不同数据快照频率进行回测。

注：
1、写了这个函数以后，模型会按照指令价方式运行。
2、Sec1设置的信号为：BK/SK；Sec2设置的信号为：BP/SP/BPK/SPK/CLOSEOUT
3、含有该函数的模型，满足条件出信号下单后此信号固定，不随之后行情是否满足条件而变化
4、INTERVAL代表数据时间间隔
  1）支持0、3、5、10四个值，不支持变量。
  2）参数为3、5、10分别代表用每隔3秒、5秒、10秒，计算一次模型
  3）参数为3、5、10 ，回测速度可提升3-10倍，回测精度稍差
  4）参数为0的时候 为每笔TICK计算一次模型
  5）一个模型中只能写入一个INTERVAL值
5、出信号后如果未到Sec个数据时间间隔K线已经走完，则提前确认信号下单。
6、该函数不支持加载到页面盒子中使用。
7、该函数支持一根K线上多个信号，最大的信号个数为N。N取值范围为1-60，超过这个范围，N值按照60计算
8、CHECKSIG、MULTSIG、MULTSIG_MIN和CHECKSIG_MIN函数不能同时出现在一个模型中。
9、模型中不含有该函数，信号执行方式默认为K线走完确认信号下单
10、N支持写为变量。
11、该函数不支持量能周期

例：
C>REF(H,1),BK;//价格大于上一根k线最高价，开多仓
C<BKPRICE-3*MINPRICE,SP;//亏损3点止损
MULTSIG(2,0,4,10);//设置信号复核确认方式为开仓信号，出信号后第2个时间间隔下单不复核（例如09:00:09出现信号，09:00:29仍旧满足条件则确认信号并下单）。根据时间间隔计算出现平仓信号立即下单不复核（例如09:00:39出现平仓信号，则立即下单不复核）。一根K线上最大信号个数为4。每隔10秒计算一次信号。
AUTOFILTER;
```

### MULTSIG_MIN

设置一根 k 线多信号的指令价方式（逐分钟回测）

```pascal
设置一根k线多信号的指令价方式（逐分钟回测）

用法：
MULTSIG_MIN(min1,min2,N) 设置一根k线多信号的指令价方式（逐分钟回测），开仓信号出信号min1分钟下单不复核,平仓信号出信号min2分钟下单不复核，一根K线上最大的信号个数为N。

注：
1、写了这个函数以后，模型会按照指令价方式运行。
2、使用该函数时，基础数据为1分钟数据。
3、该函数不支持加载在15分钟以下周期使用
4、min1设置的信号为：BK/SK；min2设置的信号为：BP/SP/BPK/SPK/CLOSEOUT
5、含有该函数的模型，满足条件后min分钟出信号立即下单，并且此信号固定，不随之后行情是否满足条件而变化。其中，min=0，出信号立即下单不复核；min>0 出信号min分钟下单不复核。
6、出信号后如果未到min分钟K线已经走完，则提前确认信号下单。
7、该函数不支持加载到页面盒子中使用。
8、该函数支持一根K线上多个信号，最大的信号个数为N。N取值范围为1-60，超过这个范围，N值按照60计算
9、CHECKSIG、MULTSIG、MULTSIG_MIN和CHECKSIG_MIN函数不能同时出现在一个模型中。
10、模型中含有该函数，效果测试中模型信号价位为模型满足条件时候行情的最新价。
11、模型中不含有该函数，信号执行方式默认为K线走完确认信号下单。
12、N支持写为变量。

例：
C>REF(H,1),BK;//价格大于上一根k线最高价，开多仓
C<BKPRICE-3*MINPRICE,SP;//亏损3点止损
MULTSIG_MIN(3,0,3);//设置信号复核确认方式为开仓信号，出信号后3分钟下单，不复核；平仓信号出信号立即下单，不复核。一根K线上最大信号个数为3。
AUTOFILTER;
```

### PANZHENG

判断是否为盘整

```pascal
PANZHENG 判断当前行情是否为盘整

用法：返回1:表示盘整，返回0:表示不是盘整。

注：
这个函数的目的是用于判断当根k线是否盘整状态，是否适合做开仓操作，从而优化趋势模型，避免在盘整阶段频繁交易。
这个函数不适合用于判断一段行情，也就是说不适合用来开发突破模型。

例：
MA1:MA(CLOSE,5);
MA2:MA(CLOSE,10);
CROSS(MA1,MA2)&&PANZHENG=0,BK;//盘整行情不开新仓，减少模型在盘整阶段的资金回撤
CROSS(MA2,MA1),SP;
AUTOFILTER;
```

### PANZHONG_MIN

设置信号确认与复核的指令价方式（股票合约逐分钟回测）

```pascal
PANZHONG_MIN 设置信号确认与复核的指令价方式（股票合约逐分钟回测）

用法：
PANZHONG_MIN(M);M为信号确认时间,分钟回测出信号M分钟下单不复核。

注：
1、写了这个函数以后，模型会按照指令价方式运行。
2、使用该函数时，基础数据为1分钟数据。
3、该函数只支持加载在股票合约15分钟及其以上、日线及其以下周期使用
4、M为信号确认时间，M>0为出信号M分钟确认信号下单，M=0为出信号立即下单
5、M不支持变量

例：
MA5:MA(C,5);
MA10:MA(C,10);
CROSSUP(MA5,MA10),BK;
CROSSDOWN(MA5,MA10),SP;
AUTOFILTER;
PANZHONG_MIN(0);
```

### TRADE_OTHER

指定交易合约

```pascal
TRADE_OTHER('CODE') 指定CODE合约为交易合约，CODE为合约代码。

注：
1、
回测时：信号价格取值为该函数定义的交易合约的信号价格。
模组加载时：数据合约为加载模组时选择的数据合约，交易合约为该函数指定的合约。不写入该函数时，交易和数据合约一致。
2、该函数写为TRADE_OTHER('AUTO')时，可以加载到指数、主连、沪深300、上证50、中证500合约，实现自动换月移仓。建议加载到指数合约使用，主连合约切换主力合约的接缝会有跳空，破坏合约趋势，可能导致出现不应该出现的信号
3、该函数写为TRADE_OTHER('XX主连')时，可以加载到商品指数上，实现换月移仓。
4、
（1）CODE位置写为'AUTO'或写为'XX主连'时，如果加载在指数合约上，主连数据开始时间在指定信号计算时间之内，从主连数据开始时间开始计算信号（如果需要从指数合约的数据开始时间进行计算，请补充主连合约历史数据）；
（2）CODE位置为具体合约时，具体合约数据开始时间在指定信号计算时间之内，从具体合约数据开始时间开始计算信号
5、数据合约和交易合约的数据不对齐时，会计算信号，交易合约的相关价格取交易合约最后一根K线的收盘价。
6、
（1）CODE位置写为'AUTO'时：
支持加载在沪深300，上证50，中证500，申请对应的IF、IH、IC主连合约，交易对应的主力合约。
如果加载在主连合约上，该函数可以和CHECKSIG,MULTSIG、CHECKSIG_MIN、MULTSIG_MIN，CLOSEKLINE_MIN函数连用；
如果加载在指数、沪深300、上证50、中证500合约上，该函数可以和CLOSEKLINE_MIN,CHECKSIG_MIN,MULTSIG_MIN函数连用；不支持和CHECKSIG,MULTSIG函数连用
（2）CODE位置为具体合约时：该函数可以和CLOSEKLINE_MIN,CHECKSIG_MIN,MULTSIG_MIN函数连用；不支持和CHECKSIG,MULTSIG函数连用。
（3）CODE位置写为'XX主连'时：支持加载在商品指数上，申请对应的XX主连合约，交易对应的主力合约。
7、
（1）CODE位置写为'AUTO'时：
该函数可以加载到指数、主连上，不可以加载到其他具体合约上。
不支持加载到恒指当月、H股指当月、A50当月上。
（2）CODE位置为具体合约时：该函数可以加载到到所有合约上。
（3）CODE位置写为'XX主连'时：只支持加载在商品指数上。
8、该函数必须在有信号的模型中使用。
9、TRADE_OTHER函数不支持加载到副图中。
10、
（1）CODE位置写为'AUTO'时：
如果加载在主连合约上，该函数支持加载在TICK周期和秒周期使用；不支持加载到日线以上周期使用；
如果加载在指数、沪深300、上证50、中证500合约上，该函数不支持加载到TICK周期，量能周期，秒周期上使用；不支持加载到日线以上周期使用。
（2）CODE位置为具体合约时：该函数不支持加载到TICK周期，量能周期，秒周期上使用。
（3）CODE位置为'XX主连'时，加载在商品指数，该函数不支持加载到TICK周期，量能周期，秒周期上使用；不支持加载到日线以上周期使用。
11、CODE位置不支持写入文华码。
12、该函数不支持加载到页面盒子中使用。

例：
CROSS(C,MA(C,5)),BK;//最新价上穿5周期均线做多
CROSS(MA(C,5),C),SP;//最新价下穿5周期均线平多
TRADE_OTHER('IF1411');//指定交易合约为股指1411
AUTOFILTER;
```

### TRADE_SMOOTHING

消除隔日跳空函数

```pascal
TRADE_SMOOTHING 消除隔日跳空函数

用法：
模型中含有TRADE_SMOOTHING函数，主图K线为消除跳空后计算得到的K线，模型根据消除跳空后K线取值计算

注：
1、该函数只支持加载在分钟或小时周期使用
2、该函数只能加载在具体合约上使用，不支持加载在指数、主连等虚拟合约上使用
3、该函数支持加载在国内期货品种上使用
3、该函数不可以与TRADE_OTHER一起使用
4、该函数不支持加载到盒子中使用
5、模型中含有该函数，会叠加蓝色K线，蓝色K线为未消除跳空的真实K线数据
6、消除跳空机制说明：
（1）该函数只消除两个交易日之间的跳空
（2）合约上市首日数据为该合约真实数据，之后数据为进行消除跳空处理后拟合数据；
（3）模型含有该函数，K线图数据与盘口数据不一致

例1
MA5:MA(C,5);
MA10:MA(C,10);
CROSSUP(MA5,MA10),BPK;
CROSSDOWN(MA5,MA10),SPK;
TRADE_SMOOTHING;//消除跳空后的K线的均线满足上穿、下穿条件后执行信号
AUTOFILTER;
```

## 加密输出函数

### SETEXPIREDATE

设置加密模型的使用有效期的到期时间

```pascal
SETEXPIREDATE 设置加密模型的使用有效期的到期时间。

用法：SETEXPIREDATE('yyyymmdd'); 设置加密模型的使用有效期的到期时间为yyyymmdd。

注：
1、写入该函数的模型加密输出后，只有在写入的日期前是有效的。
2、参数位置写入的日期格式必须为八位数，即必须为yyyymmdd的形式。
3、如果不写入该函数，默认没有到期日期，一直有效。

例：
C>REF(H,1),BK;//价格大于上一根k线最高价，开多仓
C<BKPRICE-3*MINPRICE,SP;//亏损3点止损
MULTSIG(0,0,3,0);//设置信号复核确认方式为出信号立即下单，不复核。一根K线上最大信号个数为3
SETEXPIREDATE('20141001');//该加密模型的使用有效期的到期时间为2014年10月1日
AUTOFILTER;
```

### SETQUOTACCOUNT

设置模型加密输出使用者的文华行情账号

```pascal
SETQUOTACCOUNT 设置模型加密输出使用者的文华行情账号。

用法：SETQUOTACCOUNT('ACCOUNT1'); 设置该模型加密输出给文华行情账号为ACCOUNT1的使用者。

注：
1、写入该函数的模型加密输出后，需要登录该函数指定的行情账号才可以使用。
2、如果不写入该函数，则任何账号登录后都可以使用加密输出的模型。
3、该函数支持加密输出给对多个行情账号使用，即支持SETQUOTACCOUNT('ACCOUNT1', 'ACCOUNT2');这样的写法，最大支持50个参数
4、模型中支持同时写入SETTRADEACCOUNT和SETQUOTACCOUNT函数，即支持同时设置授权的行情账号和资金账号。

例：
C>REF(H,1),BK;//价格大于上一根k线最高价，开多仓
C<BKPRICE-3*MINPRICE,SP;//亏损3点止损
MULTSIG(0,0,3,0);//设置信号复核确认方式为出信号立即下单，不复核。一根K线上最大信号个数为3
SETQUOTACCOUNT('ACCOUNT1');//将该模型加密输出给文华行情账号为ACCOUNT1的使用者。
AUTOFILTER;
```

### SETTRADEACCOUNT

设置模型加密输出使用者的文华资金账号

```pascal
SETTRADEACCOUNT 设置模型加密输出使用者的文华资金账号。

用法：SETTRADEACCOUNT('ACCOUNT1'); 设置该模型加密输出给文华资金账号为ACCOUNT1的使用者。

注：
1、写入该函数的模型加密输出后，需要登录该函数指定的资金账号才可以使用。
2、如果不写入该函数，则任何账号登录后都可以使用加密输出的模型。
3、该函数支持加密输出给对多个资金账号使用，即支持SETTRADEACCOUNT('ACCOUNT1', 'ACCOUNT2');这样的写法，最大支持50个参数
4、模型中支持同时写入SETTRADEACCOUNT和SETQUOTACCOUNT函数，即支持同时设置授权的行情账号和资金账号。

例：
C>REF(H,1),BK;//价格大于上一根k线最高价，开多仓
C<BKPRICE-3*MINPRICE,SP;//亏损3点止损
MULTSIG(0,0,3,0);//设置信号复核确认方式为出信号立即下单，不复核。一根K线上最大信号个数为3
SETTRADEACCOUNT('ACCOUNT1');//将该模型加密输出给文华资金账号为ACCOUNT1的使用者。
AUTOFILTER;
```

## 基本面函数

### DRAWVALID

连接基本数据的有效值画折线

```pascal
DRAWVALID 连接基本数据的有效值画折线

用法：
DRAWVALID(DATA);连接DATA中的有效值画折线
注：无效值指的是空值，该函数连接K线图中各个非空值的点

例1：DRAWVALID(GETBASEINFO(1));//连接K线图中中国大豆产量的数值

例2：DRAWVALID(IFELSE(C>O,H,NULL));//连接K线图中所有阳线的最高价
```

### GETBASEINFO

返回基本面数据的具体数值

```pascal
GETBASEINFO 返回基本面数据的具体数值

用法：
GETBASEINFO(CLASS); 取基本面数据中具体某一个分类CLASS的数值。可在编写平台插入菜单下--插入基本面数据 中直接选择具体的分类。例如：在插入基本面数据窗口选择中国大豆产量(1),CLASS就为1,取得就是中国大豆产量的具体数值
注：
1、CLASS只能为基本面数据中某一个分类所代表的数值
2、如果当根K线时间内有数据发出，返回该分类的具体数值；如果没有数据发出，返回空值

例：
GETBASEINFO(1);//返回中国大豆产量的具体数值
```

### GETEVENT

判断是否发生突发事件并显示图标

```pascal
GETEVENT 判断是否发生突发事件并显示图标

用法：
GETEVENT(CLASS, SHOW);判断是否发生了CLASS的突发事件，并显示图标。有事件时该函数返回1，无事件时该函数返回0。可在编写平台插入菜单下--插入突发事件 中直接选择突发事件。例如：选择铜厂商减产（469）,CLASS位置就为469,即：在铜厂商减产的位置显示图标
注：
1、CLASS只能为突发事件中某一个分类代表的数值
2、SHOW如果为0，则不显示图标；如果为非0的数值，则为显示图标
2、SHOW不支持变量

例1：GETEVENT(381,1),NODRAW;//在铜产区地震的位置画图标，不显示画线
```

## 股票除权函数

### DIVIDEND

返回之前第 N 次派息的每股派息数量

```pascal
DIVIDEND(N) 返回之前第N次派息的每股派息数量。

用法：
1、该函数返回值为之前第N次派息（不包含最近一次派息）的每股派息数量
2、该函数返回值为每股派息数量，需要在发布的派息金额的基础上除以股数。
（例如：每10股，红利5.15元，则每股派息数量为5.15/10=0.515）

注：
1、当N为0时，返回最近一次的每股派息数量。
2、当N为有效值，但本地数据范围内不足N次派息时，返回无效值；
3、若N为无效值时，返回无效值；
4、N可以为变量
5、该函数只支持加载在日线及日线以下周期使用
```

### DIVIDENDBARS

返回从之前第 N 个派息日到当前的周期数

```pascal
DIVIDENDBARS(N) 返回从之前第N个派息日到当前的周期数。

用法：
返回从之前第N个派息日（不包含最近一次派息日）到当前的周期数；若当前K线为之前的N个派息日，返回值为0

注：
1、当N为0时，返回从最近的一个派息日到当前的周期数。
2、当N为有效值，但本地数据范围内不足N次派息时，返回无效值；
3、若N为无效值时，返回无效值；
4、N可以为变量
5、该函数只支持加载在日线及日线以下周期使用
```

### ISRECORDDAY

判断当根 K 线是否为股权登记日

```pascal
ISRECORDDAY  判断当根K线是否为股权登记日

用法：ISRECORDDAY  判断当根K线是否为股权登记日，根K线是股权登记日返回是1（Yes），否则返回0（No）。

注：
1、该函数需要加载在股票日线及以下周期
2、非股票合约上返回值为空值。
3、日以上周期周期返回值为0
4、跨合约/跨周期被引用指标中返回值为0
```

### STOCKDIVD

设置股票复权

```pascal
STOCKDIVD()  设置股票复权

用法：
STOCKDIVD(0);表示设置向前复权；STOCKDIVD(1);表示设置向后复权

注：
1、该函数只适用于股票合约
2、该函数不支持TICK周期和量能周期
3、同一K线图不能同时加载不同参数的STOCKDIVD模型
4、该函数是只对K线价格（H、O、L、C）、成交量和成交额的复权处理。

例：
MA5:MA(C,5);
MA10:MA(C,10);
CROSSUP(MA5,MA10),BK;
CROSSDOWN(MA5,MA10),SP;
STOCKDIVD(0);//设置股票向前复权
AUTOFILTER;
```

### SPLIT

返回之前第 N 次除权(送股或配股)的除权比例

```pascal
SPLIT(N) 返回之前第N次除权(送股或配股)的除权比例，表示除权后股价的下跌比例。

用法：
1、该函数返回值为之前第N次除权(送股或配股)的除权比例（不包含最近一次除权）
2、如果只有派发红利没有送股或者配股信息，则不计算除权比例

计算方法：
除权比例=除权参考价/股权登记日的收盘价；
除权参考价=(股权登记日收盘价+配股价*配股率-派息率)/(1+送股率+配股率)；

例：股权登记日收盘价为7.98 除权信息为：每10股配股1.5股 配股价5.6元
除权参考价=(7.98+5.6*1.5/10)/(1+1.5/10)=7.6696
除权比例=7.6696/7.98=0.9611

注：
1、当N为0时，返回最近一次的除权比例。
2、当N为有效值，但本地数据范围内不足N次除权时，返回无效值；
3、若N为无效值时，返回无效值；
4、N可以为变量
5、该函数只支持加载在日线及日线以下周期使用
```

### SPLITBARS

返回从之前第 N 个除权日到当前的周期数

```pascal
SPLITBARS(N) 返回从之前第N个除权日到当前的周期数。

用法：
1、返回从之前第N个除权日（不包含最近一次除权日）到当前的周期数；
2、若当前K线为之前的N个除权日，返回值为0；
3、如果只有派发红利没有送股或者配股信息，则不计算到当前的周期数。

注：
1、当N为0时，返回从最近的一个除权日到当前的周期数。
2、当N为有效值，但本地数据范围内不足N个除权日时，返回无效值；
3、若N为无效值时，返回无效值；
4、N可以为变量
5、该函数只支持加载在日线及日线以下周期使用
```

## 公式选股

### SELECT

公式选股

```pascal
SELECT 公式选股

用法：
COND,SELECT;
用SELECT进行公式选股，选出最后一根K线满足条件的合约。COND为选股条件

如有多个选股条件，例如：
COND1,SELECT;
COND2,SELECT;
则选出最后一根K线满足COND1条件或COND2条件的合约

例：
C>HV(C,10),SELECT;//选出收盘价高于前10个周期收盘价的最高值的股票
```

### SORTINDEX

股票市场排序函数

```pascal
SORTINDEX 股票市场排序函数

用法：SORTINDEX('年市盈率',MarketID,Type) 股票市场排序函数。
''中为排序的值，如'年市盈率'
MarketID 为对应的市场类别号
Type为排列顺序，0为从小到大升序排列，1为从大到小降序排列。

注：
1、该函数只能用于公式选股和公式预警，不支持选股回测。
2、可进行用于排序的字段
'最新'
'成交量'
'涨跌'
'涨幅%'
'成交额'
'资金流向'
'震幅%'
'量比'
'委比%'
'换手%'
'季市盈率'
'年市盈率'
'市净率'
'总市值'
'年每股收益'
'季每股收益'
'每股资产'
'投资收益'
'主营利润'
'净利润'
'总股本'
'流通股本'
'流通%'
'年收益%'
'季收益%'
'负债%'
'每份净值'
'净值增长'
'每份收益'
'净收益率'
'基金收益'
'基金净值'
'日强弱度'
'月强弱度'
'指数贡献'
3、市场类别号
1  A股
2  B股
3  中小板
4  创业板
5  上证A股
6  深证A股
7  沪深300
8  中证500
9  上证50
10  基金
11  债券
12  回购

例1：
NUM:SORTINDEX('换手%',1,1);//返回按换手率在A股市场从大到小降序排列的序号
例2：
NUM1:SORTINDEX('年市盈率',1,0);//返回按年市盈率在A股市场从小到大升序排列的名次
例3：
CLOSE>OPEN && SORTINDEX('年市盈率',1,1)<20,SELECT;//
```

## 股票 T+0 函数

### LIMITVOL

取股票 T+0 底仓额度

```pascal
LIMITVOL  返回股票T+0底仓额度

用法：LIMITVOL 返回股票设置的T+0底仓额度

注：
1、该函数返回设置的股票T+0底仓额度
2、该函数必须同STOCKT0一起使用
3、模组加载：
主图右键加载到模组：返回主图回测参数设置中股票T+0底仓额度
新建模组：返回子账户参数中设置的T+0底仓额度
4、主图回测：返回主图回测参数设置中股票T+0底仓额度
```

### STOCKT0

设置股票 T+0 交易

```pascal
STOCKT0 设置股票T+0交易

用法：
STOCKT0，用于股票T+0交易，需要设置底仓额度，根据底仓额度来进行股票卖出和买入。每天只支持进行一次完整交易。

注：
1、写了这个函数以后，模型会支持股票T+0交易。
2、该函数只支持加载在股票合约上使用
3、该函数只支持加载在股票T+0运行模组中使用，不支持加载在其他模组中
4、写入该函数的T+0交易，每天只支持进行一次完整交易。一次完整交易指底仓额度减少后，恢复到底仓额度。
5、模组中加入该函数，一次卖出数量不能超过设置的底仓额度
6、信号执行情况
1）写入该函数的模型中支持SK，BP，CLOSEOUT和STOP信号，也支持SPK,BPK分别相当于SK,BP。不支持BK和SP信号
2）SK信号为卖出股票，即减少底仓限额。BP信号为买入股票。写入该函数，第一个信号必须是SK信号
3）当资金不够买入股票时，后续信号终止，不再计算信号
7、当股票T+0遇到登记日，将卖出的股票全部买入还原回初始持仓。后续可以继续重新开始出信号。
8、模型中含有该函数
1）回测时：
a、根据回测参数中设置的T+0底仓额度来进行股票卖出和买入。
2）实盘中：
a、新建模组时，根据设置的T+0底仓额度来进行股票的卖出和买入。
b、可通过模组菜单下一键还仓功能，买子账户空头持仓，即清子账户持仓恢复底仓额度。

例：
MA5:MA(C,5);//定义5周期均线
MA10:MA(C,10);//定义10周期均线
CROSSDOWN(MA10,MA5),SK;//5周期均线下穿10周期均线，卖出
CROSSUP(MA5,MA10),BP;//5周期均线上穿10周期均线，买入
AUTOFILTER;
STOCKT0;//股票T+0交易
AUTOFINANCING;
```
